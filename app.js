// GLOOBER APP LOGIC
// Version: 1.0.2 - Mobile optimized with language toggle
// NON MODIFICARE QUESTO FILE - Modifica solo destinations-db.js per aggiungere destinazioni

// =============================================
// TRADUZIONI UI
// =============================================
const translations = {
    it: {
        tagline: "Slide your travel vibes",
        habitatLabel: "HABITAT",
        rangeLabel: "RANGE", 
        vibesLabel: "VIBES",
        sea: "MARE",
        city: "CITTÀ",
        mountain: "MONTAGNA",
        comfort: "COMFORT",
        curious: "CURIOUS",
        bloom: "BLOOM",
        movida: "MOVIDA",
        zen: "ZEN",
        gourmet: "GOURMET",
        wild: "WILD",
        design: "DESIGN",
        romantic: "ROMANTIC",
        culture: "CULTURE",
        glamour: "GLAMOUR",
        gloobIt: "Gloob it!",
        gloobing: "Gloobing...",
        yourJourney: "Il tuo viaggio",
        bookNow: "Prenota",
        tryAgain: "Regloob"
    },
    en: {
        tagline: "Slide your travel vibes",
        habitatLabel: "HABITAT",
        rangeLabel: "RANGE",
        vibesLabel: "VIBES",
        sea: "SEA",
        city: "CITY",
        mountain: "MOUNTAIN",
        comfort: "COMFORT",
        curious: "CURIOUS",
        bloom: "BLOOM",
        movida: "PARTY",
        zen: "ZEN",
        gourmet: "GOURMET",
        wild: "WILD",
        design: "DESIGN",
        romantic: "ROMANTIC",
        culture: "CULTURE",
        glamour: "GLAMOUR",
        gloobIt: "Gloob it!",
        gloobing: "Gloobing...",
        yourJourney: "Your journey",
        bookNow: "Book now",
        tryAgain: "Regloob"
    },
    zh: {
        tagline: "滑动你的旅行心情",
        habitatLabel: "栖息地",
        rangeLabel: "距离",
        vibesLabel: "氛围",
        sea: "海边",
        city: "城市",
        mountain: "山区",
        comfort: "舒适",
        curious: "好奇",
        bloom: "绽放",
        movida: "派对",
        zen: "禅意",
        gourmet: "美食",
        wild: "狂野",
        design: "设计",
        romantic: "浪漫",
        culture: "文化",
        glamour: "魅力",
        gloobIt: "开始探索！",
        gloobing: "探索中...",
        yourJourney: "你的旅程",
        bookNow: "预订",
        tryAgain: "重新探索"
    },
    es: {
        tagline: "Desliza tus vibras viajeras",
        habitatLabel: "HÁBITAT",
        rangeLabel: "ALCANCE",
        vibesLabel: "VIBRAS",
        sea: "MAR",
        city: "CIUDAD",
        mountain: "MONTAÑA",
        comfort: "COMFORT",
        curious: "CURIOSO",
        bloom: "FLORECER",
        movida: "MOVIDA",
        zen: "ZEN",
        gourmet: "GOURMET",
        wild: "SALVAJE",
        design: "DISEÑO",
        romantic: "ROMÁNTICO",
        culture: "CULTURA",
        glamour: "GLAMOUR",
        gloobIt: "¡Gloob it!",
        gloobing: "Gloobeando...",
        yourJourney: "Tu viaje",
        bookNow: "Reserva",
        tryAgain: "Regloob"
    },
    hi: {
        tagline: "अपनी ट्रैवल वाइब्स स्लाइड करें",
        habitatLabel: "निवास",
        rangeLabel: "सीमा",
        vibesLabel: "वाइब्स",
        sea: "समुद्र",
        city: "शहर",
        mountain: "पहाड़",
        comfort: "आराम",
        curious: "जिज्ञासु", 
        bloom: "खिलना",
        movida: "पार्टी",
        zen: "शांति",
        gourmet: "स्वादिष्ट",
        wild: "जंगली",
        design: "डिज़ाइन",
        romantic: "रोमांटिक",
        culture: "संस्कृति",
        glamour: "ग्लैमर",
        gloobIt: "चलो चलें!",
        gloobing: "खोज रहे हैं...",
        yourJourney: "आपकी यात्रा",
        bookNow: "बुक करें",
        tryAgain: "फिर से"
    },
    ar: {
        tagline: "حرك أجواء سفرك",
        habitatLabel: "الموطن",
        rangeLabel: "المدى",
        vibesLabel: "الأجواء",
        sea: "بحر",
        city: "مدينة",
        mountain: "جبال",
        comfort: "راحة",
        curious: "فضولي",
        bloom: "ازدهار",
        movida: "حفلة",
        zen: "هدوء",
        gourmet: "طعام فاخر",
        wild: "بري",
        design: "تصميم",
        romantic: "رومانسي",
        culture: "ثقافة",
        glamour: "سحر",
        gloobIt: "هيا بنا!",
        gloobing: "جاري البحث...",
        yourJourney: "رحلتك",
        bookNow: "احجز",
        tryAgain: "جرب مرة أخرى"
    },
    fr: {
        tagline: "Glisse tes vibes de voyage",
        habitatLabel: "HABITAT",
        rangeLabel: "PORTÉE",
        vibesLabel: "VIBES",
        sea: "MER",
        city: "VILLE",
        mountain: "MONTAGNE",
        comfort: "CONFORT",
        curious: "CURIEUX",
        bloom: "ÉCLOSION",
        movida: "FÊTE",
        zen: "ZEN",
        gourmet: "GOURMET",
        wild: "SAUVAGE",
        design: "DESIGN",
        romantic: "ROMANTIQUE",
        culture: "CULTURE",
        glamour: "GLAMOUR",
        gloobIt: "Gloob it!",
        gloobing: "Gloobing...",
        yourJourney: "Ton voyage",
        bookNow: "Réserver",
        tryAgain: "Regloob"
    },
    pt: {
        tagline: "Deslize suas vibes de viagem",
        habitatLabel: "HABITAT",
        rangeLabel: "ALCANCE",
        vibesLabel: "VIBES",
        sea: "MAR",
        city: "CIDADE",
        mountain: "MONTANHA",
        comfort: "CONFORTO",
        curious: "CURIOSO",
        bloom: "FLORESCER",
        movida: "FESTA",
        zen: "ZEN",
        gourmet: "GOURMET",
        wild: "SELVAGEM",
        design: "DESIGN",
        romantic: "ROMÂNTICO",
        culture: "CULTURA",
        glamour: "GLAMOUR",
        gloobIt: "Gloob it!",
        gloobing: "Gloobing...",
        yourJourney: "Sua viagem",
        bookNow: "Reserve",
        tryAgain: "Regloob"
    },
    ru: {
        tagline: "Слайди свои трэвел вайбы",
        habitatLabel: "СРЕДА",
        rangeLabel: "ДАЛЬНОСТЬ",
        vibesLabel: "ВАЙБС",
        sea: "МОРЕ",
        city: "ГОРОД",
        mountain: "ГОРЫ",
        comfort: "КОМФОРТ",
        curious: "ЛЮБОПЫТСТВО",
        bloom: "РАСЦВЕТ",
        movida: "ВЕЧЕРИНКА",
        zen: "ДЗЕН",
        gourmet: "ГУРМЭ",
        wild: "ДИКИЙ",
        design: "ДИЗАЙН",
        romantic: "РОМАНТИКА",
        culture: "КУЛЬТУРА",
        glamour: "ГЛАМУР",
        gloobIt: "Поехали!",
        gloobing: "Поиск...",
        yourJourney: "Твое путешествие",
        bookNow: "Забронировать",
        tryAgain: "Еще раз"
    }
};

// =============================================
// CITAZIONI DI VIAGGIO
// =============================================
const travelQuotes = {
    it: [
        { text: "Il vero viaggio di scoperta non consiste nel cercare nuove terre, ma nell'avere nuovi occhi.", author: "Marcel Proust" },
        { text: "Si viaggia non per cambiare luogo, ma idea.", author: "Hippolyte Taine" },
        { text: "Il mondo è un libro e chi non viaggia ne legge solo una pagina.", author: "Sant'Agostino" },
        { text: "Viaggiare è vivere.", author: "Hans Christian Andersen" },
        { text: "Non si viaggia per fuggire dalla vita, ma perché la vita non ci sfugga.", author: "Anonimo" }
    ],
    en: [
        { text: "The real voyage of discovery consists not in seeking new landscapes, but in having new eyes.", author: "Marcel Proust" },
        { text: "We travel not to escape life, but for life not to escape us.", author: "Anonymous" },
        { text: "The world is a book and those who do not travel read only one page.", author: "Saint Augustine" },
        { text: "To travel is to live.", author: "Hans Christian Andersen" },
        { text: "Travel makes one modest. You see what a tiny place you occupy in the world.", author: "Gustave Flaubert" }
    ],
    es: [
        { text: "Viajar es un ejercicio con consecuencias fatales para los prejuicios.", author: "Mark Twain" },
        { text: "El mundo es un libro y aquellos que no viajan leen sólo una página.", author: "San Agustín" },
        { text: "Viajar es vivir.", author: "Hans Christian Andersen" }
    ],
    zh: [
        { text: "真正的发现之旅不在于寻找新的风景，而在于拥有新的眼光。", author: "马塞尔·普鲁斯特" },
        { text: "世界是一本书，不旅行的人只读了一页。", author: "圣奥古斯丁" },
        { text: "旅行就是生活。", author: "安徒生" }
    ],
    fr: [
        { text: "Le véritable voyage de découverte ne consiste pas à chercher de nouveaux paysages, mais à avoir de nouveaux yeux.", author: "Marcel Proust" },
        { text: "On voyage pour changer, non de lieu, mais d'idées.", author: "Hippolyte Taine" },
        { text: "Le monde est un livre et ceux qui ne voyagent pas n'en lisent qu'une page.", author: "Saint Augustin" }
    ],
    pt: [
        { text: "A verdadeira viagem de descoberta não consiste em procurar novas paisagens, mas em ter novos olhos.", author: "Marcel Proust" },
        { text: "O mundo é um livro e aqueles que não viajam leem apenas uma página.", author: "Santo Agostinho" },
        { text: "Viajar é viver.", author: "Hans Christian Andersen" }
    ],
    ru: [
        { text: "Настоящее путешествие-открытие состоит не в поиске новых пейзажей, а в обретении новых глаз.", author: "Марсель Пруст" },
        { text: "Мир - это книга, и те, кто не путешествует, читают только одну страницу.", author: "Святой Августин" },
        { text: "Путешествовать - значит жить.", author: "Ханс Кристиан Андерсен" }
    ],
    hi: [
        { text: "वास्तविक खोज की यात्रा नए परिदृश्यों की तलाश में नहीं, बल्कि नई आंखों के होने में है।", author: "मार्सेल प्रूस्त" },
        { text: "दुनिया एक किताब है और जो यात्रा नहीं करते वे केवल एक पृष्ठ पढ़ते हैं।", author: "संत ऑगस्टीन" }
    ],
    ar: [
        { text: "الرحلة الحقيقية للاكتشاف لا تتمثل في البحث عن مناظر طبيعية جديدة، بل في امتلاك عيون جديدة.", author: "مارسيل بروست" },
        { text: "العالم كتاب، ومن لا يسافر يقرأ صفحة واحدة فقط.", author: "القديس أوغسطين" }
    ]
};

// =============================================
// VARIABILI GLOBALI
// =============================================
let currentLang = 'it';
let locationValue = 50;
let distanceValue = 50;
let moodX = 50;
let moodY = 50;
let isDraggingLocation = false;
let isDraggingDistance = false;
let isDragging = false;
let userLat = null;
let userLon = null;

// =============================================
// INIZIALIZZAZIONE
// =============================================
window.onload = function() {
    // Setup language toggle NEW!
    setupLanguageToggle();
    
    // Setup language buttons
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const langSelector = document.getElementById('lang-selector');
            if (!langSelector.classList.contains('open') && btn === document.querySelector('.lang-btn')) {
                // Se è il primo bottone e il menu è chiuso, aprilo
                e.stopPropagation();
            } else {
                // Altrimenti cambia lingua
                changeLanguage(btn.dataset.lang);
            }
        });
    });
    
    // Detect browser language
    const browserLang = navigator.language.substring(0, 2);
    if (translations[browserLang]) {
        changeLanguage(browserLang);
    }
    
    // Get user location (for future features)
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(position => {
            userLat = position.coords.latitude;
            userLon = position.coords.longitude;
        });
    }
};

// =============================================
// LANGUAGE TOGGLE SYSTEM - NEW!
// =============================================
function setupLanguageToggle() {
    const langSelector = document.getElementById('lang-selector');
    const firstLang = document.querySelector('.lang-btn');
    
    // Click sulla prima bandiera apre/chiude il menu
    firstLang.addEventListener('click', (e) => {
        if (!langSelector.classList.contains('open')) {
            e.stopPropagation();
            langSelector.classList.add('open');
        }
    });
    
    // Click fuori chiude il menu
    document.addEventListener('click', (e) => {
        if (!langSelector.contains(e.target)) {
            langSelector.classList.remove('open');
        }
    });
    
    // Touch events per mobile
    document.addEventListener('touchstart', (e) => {
        if (!langSelector.contains(e.target)) {
            langSelector.classList.remove('open');
        }
    });
}

// =============================================
// GESTIONE LINGUE
// =============================================
function changeLanguage(lang) {
    currentLang = lang;
    
    // Aggiorna bandiera attiva
    const allBtns = document.querySelectorAll('.lang-btn');
    const activeBtn = document.querySelector(`.lang-btn[data-lang="${lang}"]`);
    const firstBtn = document.querySelector('.lang-btn');
    
    // Rimuovi active da tutti
    allBtns.forEach(btn => btn.classList.remove('active'));
    
    // Aggiungi active alla lingua selezionata
    activeBtn.classList.add('active');
    
    // Se non è già la prima, scambia le posizioni
    if (activeBtn !== firstBtn) {
        const activeLang = activeBtn.dataset.lang;
        const activeTitle = activeBtn.getAttribute('title');
        const activeEmoji = activeBtn.textContent;
        
        const firstLang = firstBtn.dataset.lang;
        const firstTitle = firstBtn.getAttribute('title');
        const firstEmoji = firstBtn.textContent;
        
        // Scambia i contenuti
        activeBtn.dataset.lang = firstLang;
        activeBtn.setAttribute('title', firstTitle);
        activeBtn.textContent = firstEmoji;
        
        firstBtn.dataset.lang = activeLang;
        firstBtn.setAttribute('title', activeTitle);
        firstBtn.textContent = activeEmoji;
        
        // Mantieni active sul primo bottone
        firstBtn.classList.add('active');
        activeBtn.classList.remove('active');
    }
    
    // Chiudi il menu
    document.getElementById('lang-selector').classList.remove('open');
    
    // Aggiorna i testi
    document.querySelectorAll('[data-translate]').forEach(el => {
        const key = el.dataset.translate;
        if (translations[lang][key]) {
            el.textContent = translations[lang][key];
        }
    });
    
    // RTL per arabo
    document.dir = lang === 'ar' ? 'rtl' : 'ltr';
}

// Funzione helper per ottenere testo tradotto
function getTranslatedText(obj, lang = currentLang) {
    // Se esiste la traduzione nella lingua corrente, usala
    if (obj[lang]) return obj[lang];
    // Altrimenti usa inglese come fallback
    if (obj.en) return obj.en;
    // Ultimo fallback: italiano
    if (obj.it) return obj.it;
    // Se non c'è niente, ritorna stringa vuota
    return '';
}

// =============================================
// GESTIONE SLIDER LOCATION - FIXED!
// =============================================
function startLocationDrag(event) {
    isDraggingLocation = true;
    dragLocation(event);
}

function dragLocation(event) {
    if (!isDraggingLocation) return;
    
    event.preventDefault();
    const slider = event.currentTarget;
    const rect = slider.getBoundingClientRect();
    
    let x;
    if (event.type.includes('touch')) {
        x = event.touches[0].clientX - rect.left;
    } else {
        x = event.clientX - rect.left;
    }
    
    const percentage = (x / rect.width) * 100;
    // FIXED: Limita il movimento per non far uscire il pallino
    locationValue = Math.max(5, Math.min(95, percentage));
    
    const dot = document.getElementById('location-dot');
    dot.style.left = locationValue + '%';
    
    // Mostra le etichette con fade in
    const labels = document.getElementById('location-labels');
    labels.classList.add('active');
    
    // Gestisci visibilità label centrale
    updateLabelVisibility('location', locationValue);
}

function stopLocationDrag() {
    isDraggingLocation = false;
}

// =============================================
// GESTIONE SLIDER DISTANCE - FIXED!
// =============================================
function startDistanceDrag(event) {
    isDraggingDistance = true;
    dragDistance(event);
}

function dragDistance(event) {
    if (!isDraggingDistance) return;
    
    event.preventDefault();
    const slider = event.currentTarget;
    const rect = slider.getBoundingClientRect();
    
    let x;
    if (event.type.includes('touch')) {
        x = event.touches[0].clientX - rect.left;
    } else {
        x = event.clientX - rect.left;
    }
    
    const percentage = (x / rect.width) * 100;
    // FIXED: Limita il movimento per non far uscire il pallino
    distanceValue = Math.max(5, Math.min(95, percentage));
    
    const dot = document.getElementById('distance-dot');
    dot.style.left = distanceValue + '%';
    
    // Mostra le etichette con fade in
    const labels = document.getElementById('distance-labels');
    labels.classList.add('active');
    
    // Gestisci visibilità label centrale
    updateLabelVisibility('distance', distanceValue);
}

function stopDistanceDrag() {
    isDraggingDistance = false;
}

// =============================================
// GESTIONE MOOD SELECTOR - FIXED!
// =============================================
function startDragging(event) {
    event.preventDefault();
    isDragging = true;
    dragGlobe(event);
}

function dragGlobe(event) {
    if (!isDragging) return;
    
    event.preventDefault();
    
    const selector = document.getElementById('mood-selector');
    const rect = selector.getBoundingClientRect();
    
    let x, y;
    if (event.type.includes('touch')) {
        x = event.touches[0].clientX - rect.left;
        y = event.touches[0].clientY - rect.top;
    } else {
        x = event.clientX - rect.left;
        y = event.clientY - rect.top;
    }
    
    // Converti in percentuale
    moodX = (x / rect.width) * 100;
    moodY = (y / rect.height) * 100;
    
    // FIXED: Limita ai bordi considerando la dimensione del pallino
    moodX = Math.max(7, Math.min(93, moodX));
    moodY = Math.max(14, Math.min(86, moodY));
    
    // Muovi il globo
    const globe = document.getElementById('mood-globe');
    globe.style.left = moodX + '%';
    globe.style.top = moodY + '%';
    
    // Mostra etichette mood in base alla posizione
    updateMoodLabels(moodX, moodY);
}

function stopDragging() {
    isDragging = false;
}

// =============================================
// FUNZIONI UI HELPER
// =============================================
function updateLabelVisibility(type, value) {
    const labels = document.getElementById(`${type}-labels`);
    const spans = labels.querySelectorAll('span');
    
    // Rimuovi tutte le classi visible
    spans.forEach(span => span.classList.remove('visible'));
    
    // Mostra etichette in base alla posizione
    if (value < 25) {
        // Zona sinistra - mostra solo prima etichetta
        spans[0].classList.add('visible');
    } else if (value > 75) {
        // Zona destra - mostra solo ultima etichetta
        spans[2].classList.add('visible');
    } else if (value > 40 && value < 60) {
        // Zona centrale - mostra solo etichetta centrale
        const centerLabel = labels.querySelector('.label-center');
        if (centerLabel) centerLabel.classList.add('visible');
    } else if (value <= 40) {
        // Transizione sinistra-centro
        spans[0].classList.add('visible');
        const centerLabel = labels.querySelector('.label-center');
        if (centerLabel) centerLabel.classList.add('visible');
    } else {
        // Transizione centro-destra
        spans[2].classList.add('visible');
        const centerLabel = labels.querySelector('.label-center');
        if (centerLabel) centerLabel.classList.add('visible');
    }
}

function updateMoodLabels(x, y) {
    const labels = document.querySelectorAll('.mood-label');
    
    // Reset tutte
    labels.forEach(label => label.classList.remove('visible'));
    
    // Calcola quale zona siamo
    const threshold = 30; // distanza per mostrare etichetta
    
    labels.forEach(label => {
        let labelX = 50, labelY = 50;
        
        if (label.classList.contains('top')) labelY = 10;
        if (label.classList.contains('bottom')) labelY = 90;
        if (label.classList.contains('left')) labelX = 10;
        if (label.classList.contains('right')) labelX = 90;
        if (label.classList.contains('top-left')) { labelX = 20; labelY = 20; }
        if (label.classList.contains('top-right')) { labelX = 80; labelY = 20; }
        if (label.classList.contains('bottom-left')) { labelX = 20; labelY = 80; }
        if (label.classList.contains('bottom-right')) { labelX = 80; labelY = 80; }
        
        const distance = Math.sqrt(Math.pow(x - labelX, 2) + Math.pow(y - labelY, 2));
        
        if (distance < threshold) {
            label.classList.add('visible');
        }
    });
}

// =============================================
// FUNZIONE PRINCIPALE - GLOOB IT!
// =============================================
function gloobIt() {
    // Nascondi slider, mostra loading
    document.getElementById('slider-step').classList.add('hidden');
    document.getElementById('loading-step').classList.remove('hidden');
    
    setTimeout(() => {
        document.getElementById('loading-step').classList.add('hidden');
        document.getElementById('result-step').classList.remove('hidden');
        showResults();
    }, 2000);
}

// =============================================
// MOSTRA RISULTATI
// =============================================
function showResults() {
    // Determina categoria location
    let locationType;
    if (locationValue < 33) locationType = 'sea';
    else if (locationValue < 66) locationType = 'city';
    else locationType = 'mountain';
    
    // Determina categoria distanza
    let distanceType;
    if (distanceValue < 33) distanceType = 'comfort';
    else if (distanceValue < 66) distanceType = 'curious';
    else distanceType = 'bloom';
    
    // Determina mood basato su posizione X,Y
    let moodType;
    if (moodY < 33) { // Top zone
        if (moodX < 33) moodType = 'design';
        else if (moodX < 66) moodType = 'movida';
        else moodType = 'glamour';
    } else if (moodY < 66) { // Middle zone
        if (moodX < 50) moodType = 'gourmet';
        else moodType = 'wild';
    } else { // Bottom zone
        if (moodX < 33) moodType = 'culture';
        else if (moodX < 66) moodType = 'zen';
        else moodType = 'romantic';
    }
    
    // Costruisci chiave
    const key = `${locationType}-${moodType}-${distanceType}`;
    
    console.log('Searching for:', key); // Debug
    
    // Cerca destinazione esatta
    let possibleDestinations = DESTINATIONS_DB[key];
    
    // Se non trova combinazione esatta, cerca alternative intelligenti
    if (!possibleDestinations || possibleDestinations.length === 0) {
        // Prima prova con stesso location e mood, ma diverso distance
        for (let dist of ['comfort', 'curious', 'bloom']) {
            const altKey = `${locationType}-${moodType}-${dist}`;
            if (DESTINATIONS_DB[altKey] && DESTINATIONS_DB[altKey].length > 0) {
                possibleDestinations = DESTINATIONS_DB[altKey];
                console.log('Found alternative:', altKey);
                break;
            }
        }
    }
    
    // Se ancora non trova, prova con stesso location
    if (!possibleDestinations || possibleDestinations.length === 0) {
        for (let key in DESTINATIONS_DB) {
            if (key.startsWith(locationType + '-')) {
                possibleDestinations = DESTINATIONS_DB[key];
                console.log('Found location match:', key);
                break;
            }
        }
    }
    
    // Solo se proprio non trova niente con quella location, usa fallback
    if (!possibleDestinations || possibleDestinations.length === 0) {
        console.log('Using emergency fallback');
        possibleDestinations = DESTINATIONS_DB["city-culture-curious"] || [];
    }
    
    // Scegli random
    const destination = possibleDestinations[Math.floor(Math.random() * possibleDestinations.length)];
    
    if (!destination) {
        // Destinazione di emergenza
        showEmergencyDestination();
        return;
    }
    
    // Mostra destinazione
    document.getElementById('destination-name').textContent = destination.name;
    document.getElementById('destination-country').textContent = destination.country;
    
    // Usa la funzione helper per ottenere testi tradotti
    document.getElementById('destination-tagline').textContent = getTranslatedText(destination.tagline);
    document.getElementById('narrative-text').textContent = getTranslatedText(destination.narrative);
    
    // Mostra immagine
    const image = document.getElementById('destination-image');
    if (destination.image) {
        image.src = destination.image;
        image.style.display = 'block';
    } else {
        image.style.display = 'none';
    }
    
    // Mostra citazione random
    const quotes = travelQuotes[currentLang] || travelQuotes.en || travelQuotes.it;
    const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
    document.getElementById('travel-quote').textContent = randomQuote.text;
    document.getElementById('quote-author').textContent = randomQuote.author;
}

// =============================================
// DESTINAZIONE DI EMERGENZA
// =============================================
function showEmergencyDestination() {
    document.getElementById('destination-name').textContent = "Mystery Destination";
    document.getElementById('destination-country').textContent = "Somewhere Amazing";
    document.getElementById('destination-tagline').textContent = "Every journey begins with a single step";
    document.getElementById('narrative-text').textContent = "L'avventura ti aspetta. Ogni viaggio è una storia da scrivere, ogni destinazione un capitolo nuovo. Parti con il cuore aperto e tornerai con l'anima più ricca.";
    
    // Nascondi immagine per mystery destination
    document.getElementById('destination-image').style.display = 'none';
    
    // Citazione di default
    const quotes = travelQuotes[currentLang] || travelQuotes.en || travelQuotes.it;
    const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
    document.getElementById('travel-quote').textContent = randomQuote.text;
    document.getElementById('quote-author').textContent = randomQuote.author;
}

// =============================================
// PRENOTA VIAGGIO
// =============================================
function bookTrip() {
    // Per ora usa il link generico
    // In futuro implementeremo la logica per passare la destinazione a Trip.com
    window.open('https://trip.tpk.lu/DCFSQxzu', '_blank');
}
