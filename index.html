<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gloober - Zero Stress Travel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #0f766e, #065f46, #064e3b);
            min-height: 100vh;
        }

        .globe-container {
            position: relative;
            width: min(280px, 40vw);
            height: min(280px, 40vw);
            margin: 0 auto;
        }
        
        .globe {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: linear-gradient(135deg, #60a5fa, #3b82f6, #2563eb);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            border: 3px solid rgba(255, 255, 255, 0.2);
            transition: transform 1s ease-out;
        }
        
        .spinning { animation: spin 3s ease-out; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(900deg); } }
        
        .continent {
            position: absolute;
            background: linear-gradient(135deg, #10b981, #059669);
            border-radius: 4px;
            opacity: 0.9;
        }
        
        .europa { top: 25%; left: 30%; width: 10%; height: 7%; transform: rotate(12deg); }
        .africa { top: 35%; left: 27%; width: 14%; height: 23%; transform: rotate(6deg); }
        .asia { top: 21%; right: 21%; width: 18%; height: 12%; transform: rotate(-12deg); }
        .america { top: 16%; left: 11%; width: 16%; height: 20%; transform: rotate(45deg); }
        .oceania { bottom: 25%; right: 25%; width: 11%; height: 6%; }
        
        .glass-card { 
            background: rgba(255, 255, 255, 0.1); 
            backdrop-filter: blur(16px); 
            border: 1px solid rgba(255, 255, 255, 0.2); 
        }

        .custom-dropdown {
            position: relative;
        }
        
        .dropdown-btn {
            width: 100%;
            padding: 12px 16px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .dropdown-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(6, 95, 70, 0.95);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            margin-top: 4px;
            z-index: 50;
            max-height: 200px;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .dropdown-item {
            padding: 12px 16px;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .dropdown-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(4px);
        }
        
        .dropdown-item:last-child {
            border-bottom: none;
        }

        .budget-toggle {
            display: inline-flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 16px;
            width: 100%;
        }
        
        .budget-toggle button {
            flex: 1;
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            background: transparent;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .budget-toggle button.active {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: black;
            font-weight: bold;
        }

        .lang-selector {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 8px;
        }
        
        .lang-btn {
            width: 32px;
            height: 24px;
            border-radius: 4px;
            cursor: pointer;
            opacity: 0.6;
            transition: all 0.2s;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .lang-btn:hover {
            opacity: 1;
            transform: scale(1.1);
        }
        
        .lang-btn.active {
            opacity: 1;
            box-shadow: 0 0 0 2px white;
        }

        .vibes-slider {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 0 auto;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            background: radial-gradient(circle at center, rgba(255,255,255,0.1), rgba(16,185,129,0.05));
            cursor: pointer;
            overflow: visible;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        .vibes-center {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }

        .vibes-dot {
            position: absolute;
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            border: 3px solid white;
            border-radius: 50%;
            cursor: grab;
            transition: all 0.2s;
            transform: translate(-50%, -50%);
            box-shadow: 0 4px 16px rgba(251, 191, 36, 0.6);
            z-index: 10;
            left: 50%;
            top: 50%;
        }

        .vibes-dot:hover {
            transform: translate(-50%, -50%) scale(1.1);
            box-shadow: 0 6px 20px rgba(251, 191, 36, 0.8);
        }

        .vibes-dot:active {
            cursor: grabbing;
        }

        .vibes-label {
            position: absolute;
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            white-space: nowrap;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
        }

        .book-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            color: white;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .book-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        }

        .destination-hint {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
            pointer-events: none;
            z-index: 20;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.5);
            color: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            text-align: center;
            display: none;
        }

        .hidden { display: none; }

        @media (max-width: 768px) {
            .lang-selector {
                top: 10px;
                left: 10px;
            }
            
            .globe-container {
                width: 200px;
                height: 200px;
            }

            .vibes-slider {
                width: 150px;
                height: 150px;
            }

            .vibes-label {
                font-size: 11px;
            }
        }
    </style>
</head>
<body class="text-white min-h-screen">
    
    <div id="app">
        <!-- Loading -->
        <div id="loading" class="min-h-screen flex items-center justify-center">
            <div class="text-center">
                <div class="text-6xl mb-4">üåç</div>
                <h1 class="text-4xl font-bold">Gloober</h1>
                <p class="text-xl">Zero stress travel</p>
            </div>
        </div>

        <!-- Form -->
        <div id="form-step" class="hidden container mx-auto px-4 py-8 relative">
            
            <!-- Language Selector -->
            <div class="lang-selector">
                <div class="lang-btn active" data-lang="it" onclick="setLanguage('it')">üáÆüáπ</div>
                <div class="lang-btn" data-lang="en" onclick="setLanguage('en')">üá¨üáß</div>
                <div class="lang-btn" data-lang="fr" onclick="setLanguage('fr')">üá´üá∑</div>
                <div class="lang-btn" data-lang="de" onclick="setLanguage('de')">üá©üá™</div>
                <div class="lang-btn" data-lang="es" onclick="setLanguage('es')">üá™üá∏</div>
            </div>

            <div class="text-center mb-8">
                <h1 class="text-4xl md:text-6xl font-bold mb-4 bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent">
                    Gloober
                </h1>
                <p class="text-lg md:text-xl text-gray-300">Zero stress travel ‚úàÔ∏è</p>
            </div>

            <div class="grid lg:grid-cols-2 gap-8 md:gap-12 items-center max-w-6xl mx-auto">
                <div class="glass-card rounded-2xl p-6">
                    
                    <!-- Error Message -->
                    <div id="error-message" class="error-message"></div>
                    
                    <!-- Budget & Currency -->
                    <div class="grid grid-cols-3 gap-4 mb-6">
                        <div class="col-span-2">
                            <label class="block text-sm font-medium mb-2">üí∞ <span data-translate="budget">Budget totale</span></label>
                            <input type="number" id="budget" value="1000" min="0" max="50000" step="100" 
                                   class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white text-xl font-bold focus:ring-2 focus:ring-yellow-400 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">üí± <span data-translate="currency">Valuta</span></label>
                            <select id="currency" class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white focus:ring-2 focus:ring-yellow-400 outline-none">
                                <option value="CHF">CHF</option>
                                <option value="EUR">‚Ç¨ EUR</option>
                                <option value="USD">$ USD</option>
                                <option value="GBP">¬£ GBP</option>
                            </select>
                        </div>
                    </div>

                    <!-- People -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2">üë• <span data-translate="people">Persone</span></label>
                        <select id="people" class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white focus:ring-2 focus:ring-yellow-400 outline-none">
                            <option value="1">1 <span data-translate="person">persona</span></option>
                            <option value="2" selected>2 <span data-translate="people">persone</span></option>
                            <option value="3">3 <span data-translate="people">persone</span></option>
                            <option value="4">4 <span data-translate="people">persone</span></option>
                            <option value="5">5 <span data-translate="people">persone</span></option>
                            <option value="6">6+ <span data-translate="people">persone</span></option>
                        </select>
                    </div>

                    <!-- When Departure -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2">üìÖ <span data-translate="when-departure">Quando parti?</span></label>
                        <div class="custom-dropdown">
                            <div id="departure-dropdown" class="dropdown-btn" onclick="toggleDepartureDropdown()">
                                <span id="departure-text"><span data-translate="today">OGGI</span></span>
                                <span>‚ñº</span>
                            </div>
                            <div id="departure-menu" class="dropdown-menu hidden"></div>
                        </div>
                    </div>

                    <!-- Duration -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2">‚è±Ô∏è <span data-translate="how-long">Per quanto tempo?</span></label>
                        <div class="custom-dropdown">
                            <div id="duration-dropdown" class="dropdown-btn" onclick="toggleDurationDropdown()">
                                <span id="duration-text"><span data-translate="two-days">Due giorni</span></span>
                                <span>‚ñº</span>
                            </div>
                            <div id="duration-menu" class="dropdown-menu hidden">
                                <div class="dropdown-item" onclick="selectDuration('2-days', '2')">
                                    <span>üåü</span>
                                    <span data-translate="two-days">Due giorni</span>
                                </div>
                                <div class="dropdown-item" onclick="selectDuration('3-days', '3')">
                                    <span>‚ú®</span>
                                    <span data-translate="three-days">Tre giorni</span>
                                </div>
                                <div class="dropdown-item" onclick="selectDuration('4-days', '4')">
                                    <span>üéØ</span>
                                    <span data-translate="four-days">Quattro giorni</span>
                                </div>
                                <div class="dropdown-item" onclick="selectDuration('5-days', '5')">
                                    <span>üé™</span>
                                    <span data-translate="five-days">Cinque giorni</span>
                                </div>
                                <div class="dropdown-item" onclick="selectDuration('week', '7')">
                                    <span>üìÖ</span>
                                    <span data-translate="one-week">Una settimana</span>
                                </div>
                                <div class="dropdown-item" onclick="selectDuration('10-days', '10')">
                                    <span>üå¥</span>
                                    <span data-translate="ten-days">Dieci giorni</span>
                                </div>
                                <div class="dropdown-item" onclick="selectDuration('2-weeks', '14')">
                                    <span>üèñÔ∏è</span>
                                    <span data-translate="two-weeks">Due settimane</span>
                                </div>
                                <div class="dropdown-item" onclick="selectDuration('3-weeks', '21')">
                                    <span>üó∫Ô∏è</span>
                                    <span data-translate="three-weeks">Tre settimane</span>
                                </div>
                                <div class="dropdown-item" onclick="selectDuration('month', '30')">
                                    <span>üåç</span>
                                    <span data-translate="one-month">Un mese</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Vibes Slider -->
                    <div class="mb-8" style="margin-top: 20px;">
                        <label class="block text-sm font-medium mb-4 text-center text-lg">‚ú® <span>Gloob Vibes</span></label>
                        <div style="position: relative; width: 280px; margin: 0 auto;">
                            <div class="vibes-label" style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%);">üéí <span data-translate="adventure">AVVENTURA</span></div>
                            <div class="vibes-label" style="position: absolute; bottom: -25px; left: 50%; transform: translateX(-50%);">üòå <span data-translate="relax">RELAX</span></div>
                            <div class="vibes-label" style="position: absolute; left: -45px; top: 50%; transform: translateY(-50%);">üèñÔ∏è <span data-translate="sea">MARE</span></div>
                            <div class="vibes-label" style="position: absolute; right: -65px; top: 50%; transform: translateY(-50%);">üèîÔ∏è <span data-translate="mountain">MONTAGNA</span></div>
                            
                            <div class="vibes-slider" id="vibes-slider" style="margin: 40px auto;">
                                <div class="vibes-center"></div>
                                <div class="vibes-dot" id="vibes-dot"></div>
                            </div>
                        </div>
                    </div>

                    <button id="gloob-btn" class="w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-black font-bold py-4 px-8 rounded-xl text-xl hover:from-yellow-300 hover:to-orange-400 transition-all">
                        üåç JUST GLOOB IT!
                    </button>
                </div>

                <div class="flex items-center justify-center">
                    <div class="globe-container">
                        <div id="globe" class="globe">
                            <div class="continent europa"></div>
                            <div class="continent africa"></div>
                            <div class="continent asia"></div>
                            <div class="continent america"></div>
                            <div class="continent oceania"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Spinning -->
        <div id="spin-step" class="hidden min-h-screen flex items-center justify-center">
            <div class="text-center">
                <div class="globe-container mb-6">
                    <div id="spinning-globe" class="globe spinning">
                        <div class="continent europa"></div>
                        <div class="continent africa"></div>
                        <div class="continent asia"></div>
                        <div class="continent america"></div>
                        <div class="continent oceania"></div>
                    </div>
                </div>
                <h2 class="text-4xl font-bold mb-2">Gloobing...</h2>
                <p class="text-lg text-gray-300" id="search-text">Finding your perfect match...</p>
            </div>
        </div>

        <!-- Result -->
        <div id="result-step" class="hidden container mx-auto px-4 py-8">
            <div class="max-w-4xl mx-auto">
                <div id="result-content"></div>
                <div class="text-center mt-6">
                    <button id="regloob-btn" class="bg-gradient-to-r from-yellow-400 to-orange-500 text-black font-bold py-3 px-6 rounded-xl hover:from-yellow-300 hover:to-orange-400 transition-colors">
                        üé≤ <span data-translate="regloob">Re-Gloob!</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // App configuration and state
        const APP_CONFIG = {
            GEMINI_API_KEY: 'YOUR_API_KEY_HERE',
            GEMINI_API_URL: 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent',
            DEMO_MODE: true
        };

        const appState = {
            selectedCurrency: 'CHF',
            selectedLanguage: 'it',
            budgetType: 'flight-hotel', // Always Essential
            accommodationType: 'hotel',
            vibesPosition: { x: 50, y: 50 },
            currentResult: null,
            departureCity: null,
            departureAirport: null,
            selectedDepartureDate: new Date(),
            selectedDuration: 2,
            userLocation: null
        };

        // Data
        const currencyRates = {
            EUR: 1,
            CHF: 0.95,
            USD: 1.08,
            GBP: 0.86
        };

        // EasyJet airports
        const easyJetAirports = [
            { city: 'Milano', code: 'MXP', name: 'Milano Malpensa', country: 'Italia', lat: 45.6301, lon: 8.7231 },
            { city: 'Milano', code: 'LIN', name: 'Milano Linate', country: 'Italia', lat: 45.4484, lon: 9.2788 },
            { city: 'Roma', code: 'FCO', name: 'Roma Fiumicino', country: 'Italia', lat: 41.8003, lon: 12.2389 },
            { city: 'Venezia', code: 'VCE', name: 'Venezia Marco Polo', country: 'Italia', lat: 45.5053, lon: 12.3519 },
            { city: 'Napoli', code: 'NAP', name: 'Napoli', country: 'Italia', lat: 40.8830, lon: 14.2866 },
            { city: 'Ginevra', code: 'GVA', name: 'Ginevra', country: 'Svizzera', lat: 46.2382, lon: 6.1090 },
            { city: 'Basilea', code: 'BSL', name: 'Basilea', country: 'Svizzera', lat: 47.5896, lon: 7.5299 },
            { city: 'Zurigo', code: 'ZRH', name: 'Zurigo', country: 'Svizzera', lat: 47.4647, lon: 8.5492 }
        ];

        const translations = {
            it: {
                'departure-city': 'Da quale citt√† prendi il volo?',
                'budget': 'Budget totale',
                'currency': 'Valuta',
                'people': 'Persone',
                'person': 'persona',
                'when-departure': 'Quando parti?',
                'how-long': 'Per quanto tempo?',
                'today': 'OGGI',
                'tomorrow': 'DOMANI',
                'two-days': 'Due giorni',
                'three-days': 'Tre giorni',
                'four-days': 'Quattro giorni',
                'five-days': 'Cinque giorni',
                'one-week': 'Una settimana',
                'ten-days': 'Dieci giorni',
                'two-weeks': 'Due settimane',
                'three-weeks': 'Tre settimane',
                'one-month': 'Un mese',
                'all-inclusive': 'Full Gloob Experience',
                'flight-hotel': 'Essential Gloob',
                'adventure': 'AVVENTURA',
                'relax': 'RELAX',
                'sea': 'MARE',
                'mountain': 'MONTAGNA',
                'regloob': 'Re-Gloob!',
                'error-departure': 'Per favore inserisci la citt√† di partenza!',
                'book-flight': 'PRENOTA VOLO',
                'book-hotel': 'PRENOTA HOTEL',
                'book-bnb': 'PRENOTA B&B'
            },
            en: {
                'departure-city': 'Which city are you flying from?',
                'budget': 'Total budget',
                'currency': 'Currency',
                'people': 'People',
                'person': 'person',
                'when-departure': 'When do you depart?',
                'how-long': 'For how long?',
                'today': 'TODAY',
                'tomorrow': 'TOMORROW',
                'two-days': 'Two days',
                'three-days': 'Three days',
                'four-days': 'Four days',
                'five-days': 'Five days',
                'one-week': 'One week',
                'ten-days': 'Ten days',
                'two-weeks': 'Two weeks',
                'three-weeks': 'Three weeks',
                'one-month': 'One month',
                'all-inclusive': 'Full Gloob Experience',
                'flight-hotel': 'Essential Gloob',
                'adventure': 'ADVENTURE',
                'relax': 'RELAX',
                'sea': 'SEA',
                'mountain': 'MOUNTAIN',
                'regloob': 'Re-Gloob!',
                'error-departure': 'Please enter departure city!',
                'book-flight': 'BOOK FLIGHT',
                'book-hotel': 'BOOK HOTEL',
                'book-bnb': 'BOOK B&B'
            }
        };

        // Initialize app
        function init() {
            // Try to get user location
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        appState.userLocation = {
                            lat: position.coords.latitude,
                            lon: position.coords.longitude
                        };
                        const nearest = findNearestAirport(appState.userLocation.lat, appState.userLocation.lon);
                        appState.departureAirport = nearest.code;
                        appState.departureCity = nearest.city;
                    },
                    (error) => {
                        console.log('Location not available');
                    }
                );
            }

            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('form-step').classList.remove('hidden');
                setupEventListeners();
                setupVibesSlider();
            }, 800);
        }

        // Find nearest airport
        function findNearestAirport(lat, lon) {
            let nearest = easyJetAirports[0];
            let minDistance = Number.MAX_VALUE;

            easyJetAirports.forEach(airport => {
                const distance = calculateDistance(lat, lon, airport.lat, airport.lon);
                if (distance < minDistance) {
                    minDistance = distance;
                    nearest = airport;
                }
            });

            return nearest;
        }

        // Calculate distance between two points
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Earth radius in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('gloob-btn').addEventListener('click', startGloob);
            document.getElementById('regloob-btn').addEventListener('click', () => showStep('form'));
            document.getElementById('currency').addEventListener('change', (e) => {
                appState.selectedCurrency = e.target.value;
            });
        }

        // Language functions
        function setLanguage(lang) {
            appState.selectedLanguage = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });
            
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                if (translations[lang] && translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });
        }

        // Toggle functions
        function toggleBudgetType(type) {
            appState.budgetType = type;
            document.getElementById('budget-type-flight-hotel').classList.toggle('active', type === 'flight-hotel');
            document.getElementById('budget-type-complete').classList.toggle('active', type === 'complete');
        }

        function toggleAccommodationType(type) {
            appState.accommodationType = type;
            document.getElementById('accommodation-hotel').classList.toggle('active', type === 'hotel');
            document.getElementById('accommodation-bnb').classList.toggle('active', type === 'bnb');
        }

        // Date dropdown functions
        function toggleDepartureDropdown() {
            const menu = document.getElementById('departure-menu');
            if (menu.classList.contains('hidden')) {
                generateDepartureDates();
                menu.classList.remove('hidden');
                document.getElementById('duration-menu').classList.add('hidden');
            } else {
                menu.classList.add('hidden');
            }
        }

        function toggleDurationDropdown() {
            const menu = document.getElementById('duration-menu');
            menu.classList.toggle('hidden');
            document.getElementById('departure-menu').classList.add('hidden');
        }

        function generateDepartureDates() {
            const menu = document.getElementById('departure-menu');
            if (!menu) return;
            
            const dates = [];
            const today = new Date();
            
            // Add today and tomorrow
            dates.push({
                value: today,
                label: translations[appState.selectedLanguage].today || 'OGGI',
                emoji: '‚òÄÔ∏è'
            });
            
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            dates.push({
                value: tomorrow,
                label: translations[appState.selectedLanguage].tomorrow || 'DOMANI',
                emoji: 'üåÖ'
            });
            
            // Add next 90 days
            const monthNames = ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 
                               'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre'];
            const dayNames = ['Dom', 'Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab'];
            
            for (let i = 2; i < 90; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() + i);
                
                dates.push({
                    value: date,
                    label: `${dayNames[date.getDay()]} ${date.getDate()} ${monthNames[date.getMonth()]}`,
                    emoji: 'üìÖ'
                });
            }
            
            // Generate HTML
            menu.innerHTML = dates.map(date => {
                const dateStr = date.value.toISOString().split('T')[0];
                return `
                    <div class="dropdown-item" onclick="selectDepartureDate('${dateStr}', '${date.label}')">
                        <span>${date.emoji}</span>
                        <span>${date.label}</span>
                    </div>
                `;
            }).join('');
        }

        function selectDepartureDate(dateStr, label) {
            appState.selectedDepartureDate = new Date(dateStr);
            document.getElementById('departure-text').textContent = label;
            document.getElementById('departure-menu').classList.add('hidden');
        }

        function selectDuration(type, days) {
            appState.selectedDuration = parseInt(days);
            const labels = {
                '2-days': 'Due giorni',
                '3-days': 'Tre giorni',
                '4-days': 'Quattro giorni',
                '5-days': 'Cinque giorni',
                'week': 'Una settimana',
                '10-days': 'Dieci giorni',
                '2-weeks': 'Due settimane',
                '3-weeks': 'Tre settimane',
                'month': 'Un mese'
            };
            document.getElementById('duration-text').textContent = labels[type];
            document.getElementById('duration-menu').classList.add('hidden');
        }

        // Airport autocomplete
        function setupAirportAutocomplete() {
            const input = document.getElementById('departure-city');
            const suggestions = document.getElementById('airport-suggestions');
            
            if (!input || !suggestions) return;
            
            input.addEventListener('input', (e) => {
                const value = e.target.value.toLowerCase();
                if (value.length < 2) {
                    suggestions.classList.add('hidden');
                    return;
                }
                
                const matches = airports.filter(airport => 
                    airport.city.toLowerCase().includes(value) ||
                    airport.name.toLowerCase().includes(value) ||
                    airport.code.toLowerCase().includes(value)
                );
                
                if (matches.length > 0) {
                    suggestions.innerHTML = matches.map(airport => `
                        <div class="px-4 py-3 hover:bg-gray-700 cursor-pointer transition-colors" 
                             onclick="selectAirport('${airport.city}', '${airport.code}')">
                            <div class="font-medium">${airport.city} - ${airport.name}</div>
                            <div class="text-sm text-gray-400">${airport.code} ‚Ä¢ ${airport.country}</div>
                        </div>
                    `).join('');
                    suggestions.classList.remove('hidden');
                } else {
                    suggestions.classList.add('hidden');
                }
            });
        }

        function selectAirport(city, code) {
            document.getElementById('departure-city').value = city;
            document.getElementById('airport-suggestions').classList.add('hidden');
            appState.departureCity = city;
            appState.departureAirport = code;
        }

        // Vibes slider
        function setupVibesSlider() {
            const slider = document.getElementById('vibes-slider');
            const dot = document.getElementById('vibes-dot');
            
            if (!slider || !dot) return;
            
            let isDragging = false;
            
            function updatePosition(clientX, clientY) {
                const sliderRect = slider.getBoundingClientRect();
                const x = Math.max(0, Math.min(100, ((clientX - sliderRect.left) / sliderRect.width) * 100));
                const y = Math.max(0, Math.min(100, ((clientY - sliderRect.top) / sliderRect.height) * 100));
                
                dot.style.left = x + '%';
                dot.style.top = y + '%';
                
                appState.vibesPosition.x = Math.round(x);
                appState.vibesPosition.y = Math.round(y);
            }
            
            dot.addEventListener('mousedown', () => { isDragging = true; });
            document.addEventListener('mouseup', () => { isDragging = false; });
            document.addEventListener('mousemove', (e) => {
                if (isDragging) updatePosition(e.clientX, e.clientY);
            });
            
            slider.addEventListener('click', (e) => {
                if (!isDragging) updatePosition(e.clientX, e.clientY);
            });
        }

        // Show step
        function showStep(step) {
            ['form', 'spin', 'result'].forEach(s => {
                document.getElementById(s + '-step').classList.add('hidden');
            });
            document.getElementById(step + '-step').classList.remove('hidden');
        }

        // Start Gloob
        async function startGloob() {
            // If no location and no airport selected, show airport selection
            if (!appState.departureAirport) {
                showAirportSelection();
                return;
            }
            
            showStep('spin');
            
            // Simulate loading
            setTimeout(() => {
                const result = generateMockResult();
                displayResult(result);
                showStep('result');
            }, 2000);
        }

        // Show airport selection modal
        function showAirportSelection() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-md mx-4 text-gray-800">
                    <h3 class="text-xl font-bold mb-4">‚úàÔ∏è Da dove vuoi partire?</h3>
                    <div class="space-y-2">
                        ${easyJetAirports.map(airport => `
                            <button onclick="selectDepartureAirport('${airport.code}', '${airport.city}')" 
                                    class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 transition-colors">
                                <div class="font-medium">${airport.city}</div>
                                <div class="text-sm text-gray-600">${airport.name} (${airport.code})</div>
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Select departure airport from modal
        function selectDepartureAirport(code, city) {
            appState.departureAirport = code;
            appState.departureCity = city;
            document.querySelector('.fixed').remove(); // Remove modal
            startGloob(); // Continue with gloob
        }

        // Show error
        function showError(key) {
            const errorEl = document.getElementById('error-message');
            if (errorEl) {
                errorEl.textContent = translations[appState.selectedLanguage][key] || 'Errore!';
                errorEl.style.display = 'block';
                setTimeout(() => { errorEl.style.display = 'none'; }, 3000);
            }
        }

        // Generate mock result
        function generateMockResult() {
            const destinations = [
                { name: 'Barcellona', country: 'Spagna', emoji: 'üèñÔ∏è', 
                  tagline: 'Weekend catalano tra Gaud√¨ e tapas, dove l\'arte incontra il mare', code: 'BCN' },
                { name: 'Lisbona', country: 'Portogallo', emoji: 'üöã', 
                  tagline: 'Due giorni tra tram gialli e past√©is de nata, dove il fado incontra l\'oceano', code: 'LIS' },
                { name: 'Amsterdam', country: 'Olanda', emoji: 'üö≤', 
                  tagline: 'Pedalando tra canali e tulipani, dove la libert√† ha il profumo di stroopwafel', code: 'AMS' },
                { name: 'Praga', country: 'Repubblica Ceca', emoji: 'üè∞', 
                  tagline: 'Fiaba boema tra birra e castelli, dove ogni ponte racconta una leggenda', code: 'PRG' },
                { name: 'Budapest', country: 'Ungheria', emoji: '‚ô®Ô∏è', 
                  tagline: 'Terme e paprika sul Danubio blu, dove l\'Est incontra l\'Ovest', code: 'BUD' }
            ];
            
            const dest = destinations[Math.floor(Math.random() * destinations.length)];
            const budget = parseInt(document.getElementById('budget').value) || 1000;
            const people = parseInt(document.getElementById('people').value) || 2;
            const budgetPerPerson = Math.round(budget / people);
            
            // Calculate costs per person
            const transportPerPerson = Math.round(budgetPerPerson * 0.35);
            const accommodationPerPerson = Math.round(budgetPerPerson * 0.65);
            
            // Total costs for all people
            const transportTotal = transportPerPerson * people;
            const accommodationTotal = accommodationPerPerson * people;
            
            return {
                destination: dest.name,
                country: dest.country,
                emoji: dest.emoji,
                tagline: dest.tagline,
                quote: { text: 'Il vero viaggio di scoperta non consiste nel cercare nuove terre, ma nell\'avere nuovi occhi', author: 'Marcel Proust' },
                distance: '850 km',
                duration: `${appState.selectedDuration} giorni`,
                dates: `${appState.selectedDepartureDate.toLocaleDateString('it-IT')} - ${new Date(appState.selectedDepartureDate.getTime() + appState.selectedDuration * 24 * 60 * 60 * 1000).toLocaleDateString('it-IT')}`,
                transport: {
                    details: 'Volo diretto EasyJet',
                    airports: { from: appState.departureAirport || 'MXP', to: dest.code },
                    duration: '2h 30min',
                    cost: transportTotal,
                    link: 'https://www.easyjet.com'
                },
                accommodation: {
                    name: 'Hotel Gloober Centro 3‚òÖ',
                    type: 'Hotel 3 stelle',
                    cost: accommodationTotal,
                    photo: 'https://images.unsplash.com/photo-1566073771259-6a8506099945?w=400&h=200&fit=crop',
                    link: 'https://www.booking.com'
                },
                dailyProgram: generateDailyProgram(dest.name, appState.selectedDuration),
                costs: {
                    transport: transportTotal,
                    accommodation: accommodationTotal,
                    meals: 0, // Essential package
                    activities: 0, // Essential package
                    total: budget,
                    currency: appState.selectedCurrency
                }
            };
        }

        // Generate daily program
        function generateDailyProgram(destination, days) {
            const programs = [];
            
            for (let i = 1; i <= days; i++) {
                if (i === 1) {
                    programs.push({
                        day: i,
                        title: 'Giorno 1 - Arrivo',
                        activities: [
                            `08:00 - Volo da ${appState.departureCity || 'Milano'} (incluso)`,
                            '10:30 - Arrivo e transfer in centro',
                            '12:00 - Check-in hotel (incluso)',
                            '13:00 - Pranzo libero',
                            '15:00 - Esplorazione centro storico',
                            '20:00 - Cena libera'
                        ]
                    });
                } else if (i === days) {
                    programs.push({
                        day: i,
                        title: `Giorno ${i} - Partenza`,
                        activities: [
                            '09:00 - Colazione in hotel (inclusa)',
                            '10:00 - Check-out',
                            '11:00 - Tempo libero per shopping',
                            '15:00 - Transfer all\'aeroporto',
                            `18:00 - Volo di ritorno per ${appState.departureCity || 'Milano'} (incluso)`
                        ]
                    });
                } else {
                    programs.push({
                        day: i,
                        title: `Giorno ${i} - Esplorazione`,
                        activities: [
                            '09:00 - Colazione in hotel (inclusa)',
                            '10:00 - Visita attrazione principale',
                            '13:00 - Pranzo libero',
                            '15:00 - Attivit√† pomeridiana',
                            '19:00 - Aperitivo',
                            '20:30 - Cena libera'
                        ]
                    });
                }
            }
            
            return programs;
        }

        // Display result
        function displayResult(result) {
            const people = parseInt(document.getElementById('people').value);
            const symbol = getCurrencySymbol(result.costs.currency);
            
            document.getElementById('result-content').innerHTML = `
                <div class="glass-card rounded-2xl p-6 text-center mb-6">
                    <div class="text-6xl mb-4">${result.emoji}</div>
                    <h2 class="text-3xl font-bold text-yellow-400 mb-2">${result.destination}</h2>
                    <p class="text-xl text-gray-300 mb-2">${result.country}</p>
                    <p class="text-sm text-gray-400 mb-3">${result.distance} ‚Ä¢ ${result.duration} ‚Ä¢ ${result.dates}</p>
                    <p class="mt-3 text-lg text-gray-100 italic font-light">"${result.tagline}"</p>
                    <blockquote class="mt-4 pt-4 border-t border-white/20">
                        <p class="text-gray-200 italic">"${result.quote.text}"</p>
                        <p class="text-sm text-gray-400 mt-2">‚Äî ${result.quote.author}</p>
                    </blockquote>
                </div>

                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-white rounded-2xl p-6 text-gray-800">
                        <h3 class="text-xl font-bold mb-3">‚úàÔ∏è Volo</h3>
                        <p class="font-medium mb-1">${result.transport.details}</p>
                        <p class="text-sm text-gray-600 mb-2">${result.transport.airports.from} ‚Üí ${result.transport.airports.to}</p>
                        <p class="text-sm text-gray-600 mb-3">Durata: ${result.transport.duration}</p>
                        <p class="text-2xl font-bold text-green-600 mb-4">${symbol}${result.transport.cost}</p>
                        <a href="${result.transport.link}" target="_blank" class="book-btn w-full">
                            ‚úàÔ∏è PRENOTA VOLO
                        </a>
                    </div>
                    
                    <div class="bg-white rounded-2xl p-6 text-gray-800">
                        <div class="rounded-lg mb-4 h-32 bg-cover bg-center" style="background-image: url('${result.accommodation.photo}')"></div>
                        <h3 class="text-xl font-bold mb-3">üè® Alloggio</h3>
                        <p class="font-medium mb-2">${result.accommodation.name}</p>
                        <p class="text-sm text-gray-600 mb-3">${result.accommodation.type}</p>
                        <p class="text-2xl font-bold text-green-600 mb-4">${symbol}${result.accommodation.cost}</p>
                        <a href="${result.accommodation.link}" target="_blank" class="book-btn w-full">
                            üè® PRENOTA HOTEL
                        </a>
                    </div>
                </div>

                <div class="glass-card rounded-2xl p-6 mb-6">
                    <h3 class="text-2xl font-bold mb-4 text-yellow-400">üìÖ Il tuo programma Gloob</h3>
                    <div class="text-center mb-4">
                        <button onclick="toggleProgram()" class="bg-yellow-500/20 hover:bg-yellow-500/30 text-yellow-200 px-4 py-2 rounded-lg transition-colors">
                            <span id="program-toggle-text">Mostra programma dettagliato</span> ‚ñº
                        </button>
                    </div>
                    <div id="daily-program" class="hidden">
                        ${result.dailyProgram.map(day => `
                            <div class="mb-6 text-left bg-white/5 rounded-lg p-4">
                                <h4 class="text-lg font-bold mb-3 text-yellow-300">${day.title}</h4>
                                <ul class="space-y-2">
                                    ${day.activities.map(activity => `
                                        <li class="flex items-start gap-2">
                                            <span class="text-yellow-400 mt-0.5">‚Ä¢</span>
                                            <span class="text-gray-100">${activity}</span>
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div class="glass-card rounded-2xl p-6 text-center">
                    <h3 class="text-xl font-bold mb-4">üí∞ Riepilogo costi (${people} ${people === 1 ? 'persona' : 'persone'})</h3>
                    <div class="space-y-2 text-left max-w-md mx-auto">
                        <div class="flex justify-between">
                            <span>‚úàÔ∏è Volo:</span>
                            <span class="font-bold">${symbol}${result.costs.transport}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>üè® Alloggio:</span>
                            <span class="font-bold">${symbol}${result.costs.accommodation}</span>
                        </div>
                        <div class="border-t border-white/30 pt-2 flex justify-between text-lg">
                            <span>TOTALE:</span>
                            <span class="font-bold text-yellow-400">${symbol}${result.costs.total}</span>
                        </div>
                    </div>
                    <p class="text-sm text-gray-300 mt-4 italic">
                        üí° Essential Gloob: il budget copre solo volo e hotel. 
                        Pasti e attivit√† sono a tuo carico!
                    </p>
                </div>
            `;
        }

        // Toggle program
        function toggleProgram() {
            const program = document.getElementById('daily-program');
            const toggleText = document.getElementById('program-toggle-text');
            
            if (program && program.classList.contains('hidden')) {
                program.classList.remove('hidden');
                if (toggleText) toggleText.textContent = 'Nascondi programma';
            } else if (program) {
                program.classList.add('hidden');
                if (toggleText) toggleText.textContent = 'Mostra programma dettagliato';
            }
        }

        // Currency helpers
        function getCurrencySymbol(currency) {
            const symbols = { EUR: '‚Ç¨', CHF: 'CHF ', USD: '$', GBP: '¬£' };
            return symbols[currency] || '‚Ç¨';
        }

        // Make functions globally accessible
        window.setLanguage = setLanguage;
        window.toggleBudgetType = toggleBudgetType;
        window.toggleAccommodationType = toggleAccommodationType;
        window.toggleProgram = toggleProgram;
        window.selectAirport = selectAirport;
        window.toggleDepartureDropdown = toggleDepartureDropdown;
        window.toggleDurationDropdown = toggleDurationDropdown;
        window.selectDepartureDate = selectDepartureDate;
        window.selectDuration = selectDuration;

        // Start the app
        init();
    </script>

</body>
</html>
