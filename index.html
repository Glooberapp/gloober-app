<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gloober - Zero Stress Travel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #0f766e, #065f46, #064e3b);
            min-height: 100vh;
        }

        .globe-container {
            position: relative;
            width: min(280px, 40vw);
            height: min(280px, 40vw);
            margin: 0 auto;
        }
        
        .globe {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: linear-gradient(135deg, #60a5fa, #3b82f6, #2563eb);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            border: 3px solid rgba(255, 255, 255, 0.2);
            transition: transform 1s ease-out;
        }
        
        .spinning { animation: spin 3s ease-out; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(900deg); } }
        
        .continent {
            position: absolute;
            background: linear-gradient(135deg, #10b981, #059669);
            border-radius: 4px;
            opacity: 0.9;
        }
        
        .europa { top: 25%; left: 30%; width: 10%; height: 7%; transform: rotate(12deg); }
        .africa { top: 35%; left: 27%; width: 14%; height: 23%; transform: rotate(6deg); }
        .asia { top: 21%; right: 21%; width: 18%; height: 12%; transform: rotate(-12deg); }
        .america { top: 16%; left: 11%; width: 16%; height: 20%; transform: rotate(45deg); }
        .oceania { bottom: 25%; right: 25%; width: 11%; height: 6%; }
        
        .glass-card { 
            background: rgba(255, 255, 255, 0.1); 
            backdrop-filter: blur(16px); 
            border: 1px solid rgba(255, 255, 255, 0.2); 
        }

        .custom-dropdown {
            position: relative;
        }
        
        .dropdown-btn {
            width: 100%;
            padding: 12px 16px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .dropdown-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(6, 95, 70, 0.95);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            margin-top: 4px;
            z-index: 50;
            max-height: 200px;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .dropdown-item {
            padding: 12px 16px;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .dropdown-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(4px);
        }
        
        .dropdown-item:last-child {
            border-bottom: none;
        }

        .budget-toggle {
            display: inline-flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 16px;
            width: 100%;
        }
        
        .budget-toggle button {
            flex: 1;
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            background: transparent;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .budget-toggle button.active {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: black;
            font-weight: bold;
        }

        /* LANGUAGE SELECTOR */
        .lang-selector {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 8px;
        }
        
        .lang-btn {
            width: 32px;
            height: 24px;
            border-radius: 4px;
            cursor: pointer;
            opacity: 0.6;
            transition: all 0.2s;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .lang-btn:hover {
            opacity: 1;
            transform: scale(1.1);
        }
        
        .lang-btn.active {
            opacity: 1;
            box-shadow: 0 0 0 2px white;
        }

        /* VIBES SLIDER */
        .vibes-slider {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 0 auto;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            background: radial-gradient(circle at center, rgba(255,255,255,0.1), rgba(16,185,129,0.05));
            cursor: pointer;
            overflow: visible;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        .vibes-center {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }

        .vibes-dot {
            position: absolute;
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            border: 3px solid white;
            border-radius: 50%;
            cursor: grab;
            transition: all 0.2s;
            transform: translate(-50%, -50%);
            box-shadow: 0 4px 16px rgba(251, 191, 36, 0.6);
            z-index: 10;
            left: 50%;
            top: 50%;
        }

        .vibes-dot:hover {
            transform: translate(-50%, -50%) scale(1.1);
            box-shadow: 0 6px 20px rgba(251, 191, 36, 0.8);
        }

        .vibes-dot:active {
            cursor: grabbing;
        }

        .vibes-label {
            position: absolute;
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            white-space: nowrap;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
        }

        .book-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            color: white;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        .book-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        }

        .destination-hint {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
            pointer-events: none;
            z-index: 20;
        }

        .hidden { display: none; }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .lang-selector {
                top: 10px;
                left: 10px;
            }
            
            .globe-container {
                width: 200px;
                height: 200px;
            }

            .vibes-slider {
                width: 150px;
                height: 150px;
            }

            .vibes-label {
                font-size: 11px;
            }
        }
    </style>
</head>
<body class="text-white min-h-screen">
    
    <div id="app">
        <!-- Loading -->
        <div id="loading" class="min-h-screen flex items-center justify-center">
            <div class="text-center">
                <div class="text-6xl mb-4">üåç</div>
                <h1 class="text-4xl font-bold">Gloober</h1>
                <p class="text-xl">Zero stress travel</p>
            </div>
        </div>

        <!-- Form -->
        <div id="form-step" class="hidden container mx-auto px-4 py-8 relative">
            
            <!-- LANGUAGE SELECTOR -->
            <div class="lang-selector">
                <div class="lang-btn active" data-lang="it" onclick="setLanguage('it')">üáÆüáπ</div>
                <div class="lang-btn" data-lang="en" onclick="setLanguage('en')">üá¨üáß</div>
                <div class="lang-btn" data-lang="fr" onclick="setLanguage('fr')">üá´üá∑</div>
                <div class="lang-btn" data-lang="de" onclick="setLanguage('de')">üá©üá™</div>
                <div class="lang-btn" data-lang="es" onclick="setLanguage('es')">üá™üá∏</div>
            </div>

            <div class="text-center mb-8">
                <h1 class="text-4xl md:text-6xl font-bold mb-4 bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent">
                    Gloober
                </h1>
                <p class="text-lg md:text-xl text-gray-300">Zero stress travel ‚úàÔ∏è</p>
            </div>

            <div class="grid lg:grid-cols-2 gap-8 md:gap-12 items-center max-w-6xl mx-auto">
                <div class="glass-card rounded-2xl p-6">
                    
                    <!-- BUDGET & VALUTA -->
                    <div class="grid grid-cols-3 gap-4 mb-6">
                        <div class="col-span-2">
                            <label class="block text-sm font-medium mb-2">üí∞ <span data-translate="budget">Budget totale</span></label>
                            <input type="number" id="budget" value="1000" min="0" max="50000" step="100" 
                                   class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white text-xl font-bold focus:ring-2 focus:ring-yellow-400 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">üí± <span data-translate="currency">Valuta</span></label>
                            <select id="currency" class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white focus:ring-2 focus:ring-yellow-400 outline-none">
                                <option value="CHF">CHF</option>
                                <option value="EUR">‚Ç¨ EUR</option>
                                <option value="USD">$ USD</option>
                                <option value="GBP">¬£ GBP</option>
                            </select>
                        </div>
                    </div>

                    <!-- PERSONE -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2">üë• <span data-translate="people">Persone</span></label>
                        <select id="people" class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white focus:ring-2 focus:ring-yellow-400 outline-none">
                            <option value="1">1 <span data-translate="person">persona</span></option>
                            <option value="2" selected>2 <span data-translate="people">persone</span></option>
                            <option value="3">3 <span data-translate="people">persone</span></option>
                            <option value="4">4 <span data-translate="people">persone</span></option>
                            <option value="5">5 <span data-translate="people">persone</span></option>
                            <option value="6">6+ <span data-translate="people">persone</span></option>
                        </select>
                    </div>

                    <!-- TIPO GLOOB -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-3">üåç <span data-translate="gloob-type">Tipo di Gloob</span></label>
                        
                        <!-- Prima riga: Pacchetto -->
                        <div class="budget-toggle mb-3">
                            <button id="budget-type-flight-hotel" class="active" onclick="toggleBudgetType('flight-hotel')">
                                ‚úàÔ∏èüè® <span data-translate="flight-hotel">Viaggio + Hotel</span>
                            </button>
                            <button id="budget-type-complete" onclick="toggleBudgetType('complete')">
                                üéØ <span data-translate="all-inclusive">Viaggio + Hotel + Pasti ed extra</span>
                            </button>
                        </div>
                        
                        <!-- Seconda riga: Alloggio -->
                        <div class="budget-toggle">
                            <button id="accommodation-hotel" class="active" onclick="toggleAccommodationType('hotel')">
                                üè® Hotel
                            </button>
                            <button id="accommodation-bnb" onclick="toggleAccommodationType('bnb')">
                                üè† B&B
                            </button>
                        </div>
                    </div>

                    <!-- DURATA -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2">üìÖ <span data-translate="duration">Durata</span></label>
                        <div class="custom-dropdown">
                            <button type="button" class="dropdown-btn" id="duration-btn">
                                <span id="duration-selected">üóìÔ∏è <span data-translate="any-duration">Indifferente</span></span>
                                <span class="ml-auto">‚ñº</span>
                            </button>
                            <div class="dropdown-menu hidden" id="duration-menu">
                                <div class="dropdown-item" data-duration="any">üóìÔ∏è <span data-translate="any-duration">Indifferente</span></div>
                                <div class="dropdown-item" data-duration="day">üåÖ <span data-translate="day-trip">Gita giornaliera</span></div>
                                <div class="dropdown-item" data-duration="weekend">‚ö° Weekend (2-3 <span data-translate="days">giorni</span>)</div>
                                <div class="dropdown-item" data-duration="week">üìÖ <span data-translate="one-week">Una settimana</span></div>
                                <div class="dropdown-item" data-duration="two-weeks">üèñÔ∏è <span data-translate="two-weeks">Due settimane</span></div>
                                <div class="dropdown-item" data-duration="month">üå¥ <span data-translate="one-month">Un mese</span></div>
                                <div class="dropdown-item" data-duration="custom">üìÜ <span data-translate="specific-dates">Date specifiche</span></div>
                            </div>
                        </div>
                        <div id="date-picker" class="hidden mt-3 grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-xs text-gray-300"><span data-translate="departure">Partenza</span></label>
                                <input type="date" id="start-date" class="w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white">
                            </div>
                            <div>
                                <label class="text-xs text-gray-300"><span data-translate="return">Ritorno</span></label>
                                <input type="date" id="end-date" class="w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white">
                            </div>
                        </div>
                    </div>

                    <!-- VIBES SLIDER -->
                    <div class="mb-8" style="margin-top: 20px;">
                        <label class="block text-sm font-medium mb-4 text-center text-lg">‚ú® <span data-translate="vibes">Le tue vibes</span></label>
                        <div style="position: relative; width: 280px; margin: 0 auto;">
                            <div class="vibes-label" style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%);">üéí <span data-translate="adventure">AVVENTURA</span></div>
                            <div class="vibes-label" style="position: absolute; bottom: -25px; left: 50%; transform: translateX(-50%);">üòå <span data-translate="relax">RELAX</span></div>
                            <div class="vibes-label" style="position: absolute; left: -45px; top: 50%; transform: translateY(-50%);">üèñÔ∏è <span data-translate="sea">MARE</span></div>
                            <div class="vibes-label" style="position: absolute; right: -65px; top: 50%; transform: translateY(-50%);">üèîÔ∏è <span data-translate="mountain">MONTAGNA</span></div>
                            
                            <div class="vibes-slider" id="vibes-slider" style="margin: 40px auto;">
                                <div class="vibes-center"></div>
                                <div class="vibes-dot" id="vibes-dot"></div>
                            </div>
                        </div>
                    </div>

                    <!-- TRANSPORT -->
                    <div class="mb-8">
                        <label class="block text-sm font-medium mb-2">üöÄ <span data-translate="transport">Trasporto</span></label>
                        <div class="custom-dropdown">
                            <button type="button" class="dropdown-btn" id="transport-btn">
                                <span id="transport-selected">‚úàÔ∏è <span data-translate="plane">Aereo</span></span>
                                <span class="ml-auto">‚ñº</span>
                            </button>
                            <div class="dropdown-menu hidden" id="transport-menu">
                                <div class="dropdown-item" data-transport="plane">‚úàÔ∏è <span data-translate="plane">Aereo</span></div>
                                <div class="dropdown-item" data-transport="train">üöÜ <span data-translate="train">Treno</span></div>
                                <div class="dropdown-item" data-transport="car">üöó <span data-translate="car">Auto</span></div>
                                <div class="dropdown-item" data-transport="bus">üöå Bus</div>
                                <div class="dropdown-item" data-transport="ferry">‚õ¥Ô∏è <span data-translate="ferry">Nave</span></div>
                                <div class="dropdown-item" data-transport="walk">üö∂ <span data-translate="walk">A piedi</span></div>
                            </div>
                        </div>
                    </div>

                    <button id="gloob-btn" class="w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-black font-bold py-4 px-8 rounded-xl text-xl hover:from-yellow-300 hover:to-orange-400 transition-all">
                        üåç JUST GLOOB IT!
                    </button>
                </div>

                <div class="flex items-center justify-center">
                    <div class="globe-container">
                        <div id="globe" class="globe">
                            <div class="continent europa"></div>
                            <div class="continent africa"></div>
                            <div class="continent asia"></div>
                            <div class="continent america"></div>
                            <div class="continent oceania"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Spinning -->
        <div id="spin-step" class="hidden min-h-screen flex items-center justify-center">
            <div class="text-center">
                <div class="globe-container mb-6">
                    <div id="spinning-globe" class="globe spinning">
                        <div class="continent europa"></div>
                        <div class="continent africa"></div>
                        <div class="continent asia"></div>
                        <div class="continent america"></div>
                        <div class="continent oceania"></div>
                    </div>
                </div>
                <h2 class="text-4xl font-bold mb-2">Gloobing...</h2>
                <p class="text-lg text-gray-300" id="search-text">Finding your perfect match...</p>
            </div>
        </div>

        <!-- Result -->
        <div id="result-step" class="hidden container mx-auto px-4 py-8">
            <div class="max-w-4xl mx-auto">
                <div id="result-content">
                    <!-- Populated by JS -->
                </div>
                <div class="text-center mt-6">
                    <button id="regloob-btn" class="bg-gradient-to-r from-yellow-400 to-orange-500 text-black font-bold py-3 px-6 rounded-xl hover:from-yellow-300 hover:to-orange-400 transition-colors">
                        üé≤ <span data-translate="regloob">Re-Gloob!</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const GEMINI_API_KEY = 'AIzaSyB3FtGA9NJ8FB5GNCPrAWwAzUkhy4kTZwo';
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';

        // App state
        let selectedTransport = 'plane';
        let selectedDuration = 'any';
        let selectedCurrency = 'CHF';
        let selectedLanguage = 'it';
        let budgetType = 'flight-hotel';
        let accommodationType = 'hotel';
        let vibesPosition = { x: 50, y: 50 };
        let currentResult = null;
        let userLocation = null;
        let departureCity = null;

        // Currency conversion rates (simplified)
        const currencyRates = {
            EUR: 1,
            CHF: 0.95,
            USD: 1.08,
            GBP: 0.86
        };

        // Translations
        const translations = {
            it: {
                'budget': 'Budget totale',
                'currency': 'Valuta',
                'people': 'Persone',
                'person': 'persona',
                'gloob-type': 'Tipo di Gloob',
                'package-type': 'Tipo pacchetto',
                'all-inclusive': 'Viaggio + Hotel + Pasti ed extra',
                'flight-hotel': 'Viaggio + Hotel',
                'accommodation-type': 'Tipo alloggio',
                'duration': 'Durata',
                'any-duration': 'Indifferente',
                'day-trip': 'Gita giornaliera',
                'days': 'giorni',
                'one-week': 'Una settimana',
                'two-weeks': 'Due settimane',
                'one-month': 'Un mese',
                'specific-dates': 'Date specifiche',
                'departure': 'Partenza',
                'return': 'Ritorno',
                'vibes': 'Le tue vibes',
                'adventure': 'AVVENTURA',
                'relax': 'RELAX',
                'sea': 'MARE',
                'mountain': 'MONTAGNA',
                'transport': 'Trasporto',
                'plane': 'Aereo',
                'train': 'Treno',
                'car': 'Auto',
                'ferry': 'Nave',
                'walk': 'A piedi',
                'regloob': 'Re-Gloob!'
            },
            en: {
                'budget': 'Total budget',
                'currency': 'Currency',
                'people': 'People',
                'person': 'person',
                'package-type': 'Package type',
                'all-inclusive': 'All inclusive',
                'flight-hotel': 'Flight + hotel only',
                'accommodation-type': 'Accommodation type',
                'duration': 'Duration',
                'any-duration': 'Any',
                'day-trip': 'Day trip',
                'days': 'days',
                'one-week': 'One week',
                'two-weeks': 'Two weeks',
                'one-month': 'One month',
                'specific-dates': 'Specific dates',
                'departure': 'Departure',
                'return': 'Return',
                'vibes': 'Your vibes',
                'adventure': 'ADVENTURE',
                'relax': 'RELAX',
                'sea': 'SEA',
                'mountain': 'MOUNTAIN',
                'transport': 'Transport',
                'plane': 'Plane',
                'train': 'Train',
                'car': 'Car',
                'ferry': 'Ferry',
                'walk': 'Walk',
                'regloob': 'Re-Gloob!'
            },
            fr: {
                'budget': 'Budget total',
                'currency': 'Devise',
                'people': 'Personnes',
                'person': 'personne',
                'package-type': 'Type de forfait',
                'all-inclusive': 'Tout compris',
                'flight-hotel': 'Vol + h√¥tel seulement',
                'accommodation-type': 'Type d\'h√©bergement',
                'duration': 'Dur√©e',
                'any-duration': 'Indiff√©rent',
                'day-trip': 'Excursion d\'une journ√©e',
                'days': 'jours',
                'one-week': 'Une semaine',
                'two-weeks': 'Deux semaines',
                'one-month': 'Un mois',
                'specific-dates': 'Dates sp√©cifiques',
                'departure': 'D√©part',
                'return': 'Retour',
                'vibes': 'Vos vibes',
                'adventure': 'AVENTURE',
                'relax': 'D√âTENTE',
                'sea': 'MER',
                'mountain': 'MONTAGNE',
                'transport': 'Transport',
                'plane': 'Avion',
                'train': 'Train',
                'car': 'Voiture',
                'ferry': 'Ferry',
                'walk': '√Ä pied',
                'regloob': 'Re-Gloob!'
            },
            de: {
                'budget': 'Gesamtbudget',
                'currency': 'W√§hrung',
                'people': 'Personen',
                'person': 'Person',
                'package-type': 'Pakettyp',
                'all-inclusive': 'Alles inklusive',
                'flight-hotel': 'Nur Flug + Hotel',
                'accommodation-type': 'Unterkunftsart',
                'duration': 'Dauer',
                'any-duration': 'Egal',
                'day-trip': 'Tagesausflug',
                'days': 'Tage',
                'one-week': 'Eine Woche',
                'two-weeks': 'Zwei Wochen',
                'one-month': 'Ein Monat',
                'specific-dates': 'Bestimmte Daten',
                'departure': 'Abfahrt',
                'return': 'R√ºckkehr',
                'vibes': 'Deine Vibes',
                'adventure': 'ABENTEUER',
                'relax': 'ENTSPANNUNG',
                'sea': 'MEER',
                'mountain': 'BERGE',
                'transport': 'Transport',
                'plane': 'Flugzeug',
                'train': 'Zug',
                'car': 'Auto',
                'ferry': 'F√§hre',
                'walk': 'Zu Fu√ü',
                'regloob': 'Re-Gloob!'
            },
            es: {
                'budget': 'Presupuesto total',
                'currency': 'Moneda',
                'people': 'Personas',
                'person': 'persona',
                'package-type': 'Tipo de paquete',
                'all-inclusive': 'Todo incluido',
                'flight-hotel': 'Solo vuelo + hotel',
                'accommodation-type': 'Tipo de alojamiento',
                'duration': 'Duraci√≥n',
                'any-duration': 'Indiferente',
                'day-trip': 'Excursi√≥n de un d√≠a',
                'days': 'd√≠as',
                'one-week': 'Una semana',
                'two-weeks': 'Dos semanas',
                'one-month': 'Un mes',
                'specific-dates': 'Fechas espec√≠ficas',
                'departure': 'Salida',
                'return': 'Regreso',
                'vibes': 'Tus vibes',
                'adventure': 'AVENTURA',
                'relax': 'RELAX',
                'sea': 'MAR',
                'mountain': 'MONTA√ëA',
                'transport': 'Transporte',
                'plane': 'Avi√≥n',
                'train': 'Tren',
                'car': 'Coche',
                'ferry': 'Ferry',
                'walk': 'A pie',
                'regloob': 'Re-Gloob!'
            }
        };

        // Set language
        function setLanguage(lang) {
            selectedLanguage = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });
            
            // Update all translations
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                if (translations[lang] && translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });
        }

        // Convert currency
        function convertCurrency(amount, from, to) {
            const amountInEUR = amount / currencyRates[from];
            return Math.round(amountInEUR * currencyRates[to]);
        }

        // Get currency symbol
        function getCurrencySymbol(currency) {
            const symbols = { EUR: '‚Ç¨', CHF: 'CHF ', USD: '$', GBP: '¬£' };
            return symbols[currency] || '‚Ç¨';
        }

        // Get random hotel photo
        function getRandomHotelPhoto() {
            const photos = [
                '1566073771259-6a8506099945',
                '1551882547-ff40c63fe5fa',
                '1564501049229-d2b0fcdc539e',
                '1571003123894-1f0594d2b5d9',
                '1590490360182-c33d57733427'
            ];
            return photos[Math.floor(Math.random() * photos.length)];
        }

        // Initialize location based on browser
        function detectLocation() {
            // Simple detection for Swiss Italian users
            const userLang = navigator.language || navigator.userLanguage;
            if (userLang.includes('it-CH')) {
                selectedCurrency = 'CHF';
                selectedLanguage = 'it';
                document.getElementById('currency').value = 'CHF';
                setLanguage('it');
            }
        }

        // Get trip duration in days
        function getDurationDays() {
            switch(selectedDuration) {
                case 'day': return 1;
                case 'weekend': return 3;
                case 'week': return 7;
                case 'two-weeks': return 14;
                case 'month': return 30;
                case 'custom':
                    const start = document.getElementById('start-date').value;
                    const end = document.getElementById('end-date').value;
                    if (start && end) {
                        const diff = new Date(end) - new Date(start);
                        return Math.ceil(diff / (1000 * 60 * 60 * 24)) + 1;
                    }
                    return 7;
                default: return 7;
            }
        }

        // Setup vibes slider
        function setupVibesSlider() {
            const slider = document.getElementById('vibes-slider');
            const dot = document.getElementById('vibes-dot');
            
            if (!slider || !dot) return;
            
            let isDragging = false;
            
            function updatePosition(clientX, clientY) {
                const sliderRect = slider.getBoundingClientRect();
                const x = Math.max(0, Math.min(100, ((clientX - sliderRect.left) / sliderRect.width) * 100));
                const y = Math.max(0, Math.min(100, ((clientY - sliderRect.top) / sliderRect.height) * 100));
                
                dot.style.left = x + '%';
                dot.style.top = y + '%';
                
                vibesPosition.x = Math.round(x);
                vibesPosition.y = Math.round(y);
                
                // Update globe hint
                updateGlobeHint();
            }
            
            // Mouse events
            dot.addEventListener('mousedown', (e) => {
                isDragging = true;
                e.preventDefault();
            });
            
            slider.addEventListener('click', (e) => {
                if (!isDragging) {
                    updatePosition(e.clientX, e.clientY);
                }
            });
            
            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    updatePosition(e.clientX, e.clientY);
                }
            });
            
            document.addEventListener('mouseup', () => {
                isDragging = false;
            });
            
            // Touch events for mobile
            dot.addEventListener('touchstart', (e) => {
                isDragging = true;
                e.preventDefault();
            });
            
            document.addEventListener('touchmove', (e) => {
                if (isDragging) {
                    const touch = e.touches[0];
                    updatePosition(touch.clientX, touch.clientY);
                }
            });
            
            document.addEventListener('touchend', () => {
                isDragging = false;
            });
        }

        // Update globe hint based on vibes
        function updateGlobeHint() {
            const globe = document.getElementById('globe');
            const existingHints = globe.querySelectorAll('.destination-hint');
            existingHints.forEach(hint => hint.remove());
            
            const energy = 100 - vibesPosition.y;
            const environment = vibesPosition.x;
            
            let hint = '';
            if (environment < 30) hint = 'üåä';
            else if (environment > 70) hint = 'üèîÔ∏è';
            else hint = 'üèûÔ∏è';
            
            if (energy < 30) hint += 'üòå';
            else if (energy > 70) hint += 'üéí';
            
            const hintElement = document.createElement('div');
            hintElement.className = 'destination-hint';
            hintElement.textContent = hint;
            globe.appendChild(hintElement);
        }

        // AI destination finder
        async function findDestination() {
            const budget = parseInt(document.getElementById('budget').value);
            const people = parseInt(document.getElementById('people').value);
            const budgetInEUR = convertCurrency(budget, selectedCurrency, 'EUR');
            
            // Get vibes description
            const energy = 100 - vibesPosition.y;
            const environment = vibesPosition.x;
            
            const vibesDesc = `${environment < 30 ? 'mare' : environment > 70 ? 'montagna' : 'colline/natura'} e ${energy < 30 ? 'relax totale' : energy > 70 ? 'avventura pura' : 'mix equilibrato'}`;
            
            // Get dates
            let dateRange = '';
            if (selectedDuration === 'custom') {
                const start = document.getElementById('start-date').value;
                const end = document.getElementById('end-date').value;
                if (start && end) {
                    dateRange = `dal ${start} al ${end}`;
                }
            } else {
                const days = getDurationDays();
                dateRange = `${days} giorni`;
            }
            
            // Budget 0 special case
            const isZeroBudget = budget === 0;
            
            const prompt = `Sei un esperto consulente viaggi. ${isZeroBudget ? 'Il cliente ha budget ZERO quindi proponi una micro-vacanza gratuita come una passeggiata in un posto bello vicino raggiungibile a piedi.' : `Il cliente vuole fare una vacanza con questi parametri:

- Budget: ${getCurrencySymbol(selectedCurrency)}${budget} ${selectedCurrency} (‚Ç¨${budgetInEUR} EUR) ${budgetType === 'complete' ? 'TUTTO INCLUSO (viaggio, hotel, pasti, attivit√†)' : 'SOLO VOLO E HOTEL'}
- Persone: ${people}
- Durata: ${dateRange}
- Vibes: ${vibesDesc}
- Trasporto preferito: ${selectedTransport}
- Tipo alloggio: ${accommodationType === 'bnb' ? 'B&B' : 'Hotel'}
- Partenza da: ${departureCity || 'Svizzera italiana'}
${userLocation ? `- Posizione attuale: lat ${userLocation.lat}, lon ${userLocation.lon}` : ''}

IMPORTANTE: 
1. Il budget deve coprire TUTTE le spese per TUTTE le ${people} persone
2. Proponi UNA destinazione specifica e realistica per questo budget
3. Crea un programma DETTAGLIATO giorno per giorno per TUTTI i giorni
4. Includi una citazione famosa sul luogo`}

Rispondi in formato JSON con TUTTI i giorni del viaggio:
{
  "destination": "Nome destinazione",
  "country": "Paese",
  "emoji": "üåü",
  "description": "Una frase evocativa che descrive la magia del luogo",
  "quote": {
    "text": "Una citazione famosa sul luogo",
    "author": "Autore della citazione"
  },
  "distance": "100 km",
  "duration": "${dateRange}",
  "transport": {
    "type": "${selectedTransport}",
    "details": "Come arrivarci",
    "cost": ${isZeroBudget ? 0 : Math.round(budgetInEUR * 0.3)},
    "duration": "2 ore"
  },
  "accommodation": {
    "name": "${isZeroBudget ? 'Nessun pernottamento' : accommodationType === 'bnb' ? 'Caratteristico B&B del centro' : 'Nome hotel/alloggio'}",
    "type": "${isZeroBudget ? 'Gita giornaliera' : accommodationType === 'bnb' ? 'Bed & Breakfast' : 'Hotel 3 stelle'}",
    "cost": ${isZeroBudget ? 0 : Math.round(budgetInEUR * 0.4)},
    "photo": "https://images.unsplash.com/photo-${getRandomHotelPhoto()}?w=400&h=200&fit=crop"
  },
  "dailyProgram": [
    {
      "day": 1,
      "title": "Giorno 1 - Arrivo",
      "activities": [
        "09:00 - Partenza da casa",
        "11:00 - Arrivo e check-in",
        "12:30 - Pranzo locale (‚Ç¨${Math.round(15 * people)})",
        "15:00 - Visita centro storico",
        "19:30 - Cena tipica (‚Ç¨${Math.round(25 * people)})"
      ]
    },
    ${getDurationDays() > 1 ? `{
      "day": 2,
      "title": "Giorno 2 - Esplorazione",
      "activities": [
        "09:00 - Colazione in hotel",
        "10:00 - Attivit√† principale del giorno",
        "13:00 - Pranzo",
        "15:00 - Attivit√† pomeridiana",
        "20:00 - Cena"
      ]
    }` : ''}
  ],
  "costs": {
    "transport": ${isZeroBudget ? 0 : Math.round(budgetInEUR * 0.3)},
    "accommodation": ${isZeroBudget ? 0 : Math.round(budgetInEUR * 0.4)},
    "meals": ${isZeroBudget ? 0 : Math.round(budgetInEUR * 0.2)},
    "activities": ${isZeroBudget ? 0 : Math.round(budgetInEUR * 0.1)},
    "total": ${budgetInEUR},
    "currency": "${selectedCurrency}"
  }
}`;

            try {
                const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }]
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const aiResponse = data.candidates[0].content.parts[0].text;
                    const cleanResponse = aiResponse.replace(/```json\n?|\n?```/g, '').trim();
                    return JSON.parse(cleanResponse);
                } else {
                    throw new Error('API Error');
                }
            } catch (error) {
                console.error('AI Error:', error);
                return generateFallbackDestination(budgetInEUR, people, isZeroBudget);
            }
        }

        // Fallback destination generator
        function generateFallbackDestination(budget, people, isZeroBudget) {
            const days = getDurationDays();
            
            if (isZeroBudget) {
                return {
                    destination: "Sentiero dell'olivo",
                    country: "Svizzera",
                    emoji: "üö∂",
                    description: "Un percorso incantato tra ulivi centenari e vista mozzafiato sul lago",
                    quote: {
                        text: "La felicit√† √® una passeggiata nella natura",
                        author: "Friedrich Nietzsche"
                    },
                    distance: "5 km da casa",
                    duration: "Mezza giornata",
                    transport: {
                        type: "walk",
                        details: "A piedi da casa",
                        cost: 0,
                        duration: "30 minuti"
                    },
                    accommodation: {
                        name: "Ritorno a casa",
                        type: "Gita giornaliera",
                        cost: 0,
                        photo: "https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=400&h=200&fit=crop"
                    },
                    dailyProgram: [{
                        day: 1,
                        title: "Giornata di relax",
                        activities: [
                            "09:00 - Partenza da casa con zaino e pranzo al sacco",
                            "09:30 - Inizio sentiero panoramico",
                            "11:00 - Pausa caff√® vista lago",
                            "12:30 - Picnic nel prato",
                            "14:00 - Ritorno attraverso il bosco",
                            "16:00 - Rientro a casa"
                        ]
                    }],
                    costs: {
                        transport: 0,
                        accommodation: 0,
                        meals: 0,
                        activities: 0,
                        total: 0,
                        currency: selectedCurrency
                    }
                };
            }

            // Normal budget fallback
            const destinations = [
                { name: "Lago di Como", country: "Italia", emoji: "üèûÔ∏è", distance: "80 km" },
                { name: "Milano", country: "Italia", emoji: "üèôÔ∏è", distance: "90 km" },
                { name: "Zermatt", country: "Svizzera", emoji: "üèîÔ∏è", distance: "200 km" }
            ];
            
            const dest = destinations[Math.floor(Math.random() * destinations.length)];
            
            // Generate daily program for all days
            const dailyProgram = [];
            for (let i = 1; i <= days; i++) {
                dailyProgram.push({
                    day: i,
                    title: `Giorno ${i}${i === 1 ? ' - Arrivo' : i === days ? ' - Partenza' : ''}`,
                    activities: [
                        "09:00 - Colazione",
                        "10:30 - Attivit√† mattutina",
                        "13:00 - Pranzo",
                        "15:00 - Attivit√† pomeridiana",
                        "19:30 - Cena"
                    ]
                });
            }
            
            return {
                destination: dest.name,
                country: dest.country,
                emoji: dest.emoji,
                description: "Dove il tempo si ferma e l'anima respira",
                quote: {
                    text: "Il vero viaggio di scoperta non consiste nel cercare nuove terre, ma nell'avere nuovi occhi",
                    author: "Marcel Proust"
                },
                distance: dest.distance,
                duration: `${days} giorni`,
                transport: {
                    type: selectedTransport,
                    details: `${selectedTransport} diretto`,
                    cost: Math.round(budget * 0.3),
                    duration: "2 ore"
                },
                accommodation: {
                    name: accommodationType === 'bnb' ? "B&B del Centro" : "Hotel Gloober",
                    type: accommodationType === 'bnb' ? "Bed & Breakfast" : "Hotel 3 stelle",
                    cost: Math.round(budget * 0.4),
                    photo: `https://images.unsplash.com/photo-${getRandomHotelPhoto()}?w=400&h=200&fit=crop`
                },
                dailyProgram: dailyProgram,
                costs: {
                    transport: Math.round(budget * 0.3),
                    accommodation: Math.round(budget * 0.4),
                    meals: Math.round(budget * 0.2),
                    activities: Math.round(budget * 0.1),
                    total: budget,
                    currency: "EUR"
                }
            };
        }

        // Display result
        function displayResult(result) {
            const people = parseInt(document.getElementById('people').value);
            const symbol = getCurrencySymbol(result.costs.currency || selectedCurrency);
            
            const html = `
                <div class="glass-card rounded-2xl p-6 text-center mb-6">
                    <div class="text-6xl mb-4">${result.emoji}</div>
                    <h2 class="text-3xl font-bold text-yellow-400 mb-2">${result.destination}</h2>
                    <p class="text-xl text-gray-300 mb-2">${result.country}</p>
                    <p class="text-sm text-gray-400">${result.distance} ‚Ä¢ ${result.duration}</p>
                    ${result.description ? `<p class="mt-3 text-gray-200 italic">"${result.description}"</p>` : ''}
                    ${result.quote ? `<p class="mt-4 text-sm text-gray-300 italic">"${result.quote.text}" - ${result.quote.author}</p>` : ''}
                </div>

                <!-- Transport & Accommodation -->
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-white rounded-2xl p-6 text-gray-800">
                        <div class="flex items-center gap-3 mb-3">
                            <img src="https://www.easyjet.com/favicon.ico" alt="EasyJet" class="w-8 h-8">
                            <h3 class="text-xl font-bold">‚úàÔ∏è ${translations[selectedLanguage].transport}</h3>
                        </div>
                        <p class="font-medium mb-2">${result.transport.details}</p>
                        <p class="text-sm text-gray-600 mb-3">${result.transport.duration}</p>
                        <p class="text-2xl font-bold text-green-600 mb-4">${symbol}${result.transport.cost}</p>
                        ${result.transport.type === 'plane' && result.transport.link ? `
                        <a href="${result.transport.link}" target="_blank" class="book-btn w-full">
                            ‚úàÔ∏è PRENOTA VOLO
                        </a>` : ''}
                    </div>
                    
                    <div class="bg-white rounded-2xl p-6 text-gray-800">
                        ${result.accommodation.photo ? `
                        <div class="rounded-lg mb-4 h-32 bg-cover bg-center" style="background-image: url('${result.accommodation.photo}')"></div>
                        ` : ''}
                        <h3 class="text-xl font-bold mb-3">üè® Alloggio</h3>
                        <p class="font-medium mb-2">${result.accommodation.name}</p>
                        <p class="text-sm text-gray-600 mb-3">${result.accommodation.type}</p>
                        <p class="text-2xl font-bold text-green-600 mb-4">${symbol}${result.accommodation.cost}</p>
                        ${result.accommodation.cost > 0 && result.accommodation.link ? `
                        <a href="${result.accommodation.link}" target="_blank" class="book-btn w-full">
                            ${accommodationType === 'bnb' ? 'üè† PRENOTA B&B' : 'üè® PRENOTA HOTEL'}
                        </a>` : ''}
                    </div>
                </div>

                <!-- Daily Program -->
                <div class="glass-card rounded-2xl p-6 mb-6">
                    <h3 class="text-2xl font-bold mb-4 text-yellow-400">üìÖ Programma dettagliato</h3>
                    <div class="text-center mb-4">
                        <button onclick="toggleProgram()" class="bg-yellow-500/20 hover:bg-yellow-500/30 text-yellow-200 px-4 py-2 rounded-lg transition-colors">
                            <span id="program-toggle-text">Mostra programma completo</span> ‚ñº
                        </button>
                    </div>
                    <div id="daily-program" class="hidden">
                        ${result.dailyProgram.map(day => `
                            <div class="mb-6 text-left">
                                <h4 class="text-lg font-bold mb-3 text-yellow-300">${day.title}</h4>
                                <ul class="space-y-2">
                                    ${day.activities.map(activity => `
                                        <li class="flex items-start gap-2">
                                            <span class="text-yellow-400">‚Ä¢</span>
                                            <span>${activity}</span>
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <!-- Budget Summary -->
                <div class="glass-card rounded-2xl p-6 text-center">
                    <h3 class="text-xl font-bold mb-4">üí∞ Riepilogo costi (${people} ${people === 1 ? translations[selectedLanguage].person : translations[selectedLanguage].people})</h3>
                    <div class="space-y-2 mb-4 text-left max-w-md mx-auto">
                        <div class="flex justify-between">
                            <span>üöÄ ${translations[selectedLanguage].transport}:</span>
                            <span class="font-bold">${symbol}${result.costs.transport}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>üè® Alloggio:</span>
                            <span class="font-bold">${symbol}${result.costs.accommodation}</span>
                        </div>
                        ${budgetType === 'complete' ? `
                        <div class="flex justify-between">
                            <span>üçΩÔ∏è Pasti:</span>
                            <span class="font-bold">${symbol}${result.costs.meals}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>üé´ Attivit√†:</span>
                            <span class="font-bold">${symbol}${result.costs.activities}</span>
                        </div>
                        ` : ''}
                        <div class="border-t border-white/30 pt-2 flex justify-between text-lg">
                            <span>TOTALE:</span>
                            <span class="font-bold text-yellow-400">${symbol}${result.costs.total}</span>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('result-content').innerHTML = html;
        }

        // Initialize app
        function init() {
            detectLocation();
            
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('form-step').classList.remove('hidden');
                setupEvents();
                setupVibesSlider();
            }, 800);
        }

        // Setup events
        function setupEvents() {
            // Currency change
            document.getElementById('currency').addEventListener('change', (e) => {
                selectedCurrency = e.target.value;
            });

            // Duration dropdown
            const durationBtn = document.getElementById('duration-btn');
            const durationMenu = document.getElementById('duration-menu');
            const durationSelected = document.getElementById('duration-selected');
            const datePicker = document.getElementById('date-picker');
            
            durationBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                durationMenu.classList.toggle('hidden');
            });
            
            document.querySelectorAll('[data-duration]').forEach(item => {
                item.addEventListener('click', () => {
                    selectedDuration = item.dataset.duration;
                    durationSelected.innerHTML = item.innerHTML;
                    durationMenu.classList.add('hidden');
                    
                    if (selectedDuration === 'custom') {
                        datePicker.classList.remove('hidden');
                    } else {
                        datePicker.classList.add('hidden');
                    }
                });
            });

            // Transport dropdown
            const transportBtn = document.getElementById('transport-btn');
            const transportMenu = document.getElementById('transport-menu');
            const transportSelected = document.getElementById('transport-selected');
            
            transportBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                transportMenu.classList.toggle('hidden');
            });
            
            document.querySelectorAll('[data-transport]').forEach(item => {
                item.addEventListener('click', () => {
                    selectedTransport = item.dataset.transport;
                    transportSelected.innerHTML = item.innerHTML;
                    transportMenu.classList.add('hidden');
                });
            });

            // Close dropdowns on outside click
            document.addEventListener('click', () => {
                durationMenu.classList.add('hidden');
                transportMenu.classList.add('hidden');
            });

            // Gloob button
            document.getElementById('gloob-btn').addEventListener('click', startGloob);
            
            // Re-gloob button
            document.getElementById('regloob-btn').addEventListener('click', () => {
                showStep('form');
            });
        }

        // Toggle budget type
        function toggleBudgetType(type) {
            budgetType = type;
            document.getElementById('budget-type-flight-hotel').classList.toggle('active', type === 'flight-hotel');
            document.getElementById('budget-type-complete').classList.toggle('active', type === 'complete');
        }

        // Toggle accommodation type
        function toggleAccommodationType(type) {
            accommodationType = type;
            document.getElementById('accommodation-hotel').classList.toggle('active', type === 'hotel');
            document.getElementById('accommodation-bnb').classList.toggle('active', type === 'bnb');
        }

        // Show step
        function showStep(step) {
            document.getElementById('form-step').classList.add('hidden');
            document.getElementById('spin-step').classList.add('hidden');
            document.getElementById('result-step').classList.add('hidden');
            document.getElementById(step + '-step').classList.remove('hidden');
        }

        // Start gloob
        async function startGloob() {
            const budget = parseInt(document.getElementById('budget').value) || 0;
            
            // Always check location first
            if (!userLocation || !departureCity) {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        async (position) => {
                            userLocation = {
                                lat: position.coords.latitude,
                                lon: position.coords.longitude
                            };
                            // Get city name from coordinates
                            departureCity = await getCityFromCoords(position.coords.latitude, position.coords.longitude);
                            proceedWithGloob();
                        },
                        () => {
                            // If geolocation fails, ask for city
                            const city = prompt(selectedLanguage === 'it' ? 
                                'Da quale citt√† parti?' : 
                                'Which city are you departing from?');
                            if (city) {
                                departureCity = city;
                                proceedWithGloob();
                            }
                        }
                    );
                } else {
                    const city = prompt(selectedLanguage === 'it' ? 
                        'Da quale citt√† parti?' : 
                        'Which city are you departing from?');
                    if (city) {
                        departureCity = city;
                        proceedWithGloob();
                    }
                }
            } else {
                proceedWithGloob();
            }
        }

        // Get city from coordinates
        async function getCityFromCoords(lat, lon) {
            // For Swiss locations, determine nearest city
            if (lat >= 45.8 && lat <= 46.5 && lon >= 8.5 && lon <= 9.5) {
                // Ticino region
                if (lat >= 46.1) return "Bellinzona";
                if (lat >= 46.0) return "Lugano";
                return "Chiasso";
            }
            return "Milano"; // Default fallback
        }

        async function proceedWithGloob() {
            const budget = parseInt(document.getElementById('budget').value) || 0;
            
            showStep('spin');
            
            // Update spinning text
            const searchTexts = [
                'Gloobing...',
                'Analizzando le tue vibes...',
                'Cercando la destinazione perfetta...',
                'Calcolando il budget...',
                'Creando il tuo programma...'
            ];
            
            let textIndex = 0;
            const searchTextElement = document.getElementById('search-text');
            const textInterval = setInterval(() => {
                searchTextElement.textContent = searchTexts[textIndex % searchTexts.length];
                textIndex++;
            }, 800);
            
            try {
                currentResult = await findDestination();
                
                clearInterval(textInterval);
                displayResult(currentResult);
                setTimeout(() => showStep('result'), 300);
                
            } catch (error) {
                console.error('Gloob Error:', error);
                clearInterval(textInterval);
                alert('Errore! Riprova.');
                showStep('form');
            }
        }

        // Toggle program visibility
        function toggleProgram() {
            const program = document.getElementById('daily-program');
            const toggleText = document.getElementById('program-toggle-text');
            
            if (program.classList.contains('hidden')) {
                program.classList.remove('hidden');
                toggleText.textContent = 'Nascondi programma';
            } else {
                program.classList.add('hidden');
                toggleText.textContent = 'Mostra programma completo';
            }
        }

        // Make functions globally accessible
        window.setLanguage = setLanguage;
        window.toggleBudgetType = toggleBudgetType;
        window.toggleAccommodationType = toggleAccommodationType;
        window.toggleProgram = toggleProgram;

        // Start app
        init();
    </script>

</body>
</html>
