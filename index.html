<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Slide your travel vibes and discover your perfect destination">
    <title>Gloober - Slide Your Travel Vibes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #0f766e, #065f46, #064e3b);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Container principale responsive */
        .main-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Glass card responsive */
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 30px 20px;
        }
        
        @media (max-height: 800px) {
            .glass-card {
                padding: 20px 15px;
            }
            h1 {
                font-size: 3rem !important;
            }
        }
        
        /* Language selector */
        .lang-selector {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 100;
            display: flex;
            gap: 6px;
            background: rgba(0, 0, 0, 0.3);
            padding: 6px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            flex-wrap: wrap;
            max-width: 320px;
        }
        
        .lang-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            opacity: 0.6;
            transition: all 0.3s ease;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .lang-btn:hover {
            opacity: 1;
            transform: scale(1.1);
        }
        
        .lang-btn.active {
            opacity: 1;
            box-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
            border: 2px solid #fbbf24;
        }
        
        /* Stile unificato per tutti gli slider */
        .slider-container {
            width: 100%;
            height: 60px;
            margin: 15px auto;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        /* Location slider gradient */
        .location-slider {
            background: linear-gradient(to right, #60a5fa 0%, #f97316 50%, #10b981 100%);
        }
        
        /* Distance slider gradient */
        .distance-slider {
            background: linear-gradient(to right, #94a3b8 0%, #64748b 50%, #334155 100%);
        }
        
        /* Labels dentro lo slider - STILE UNIFICATO */
        .slider-inner-labels {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 25px;
            pointer-events: none;
            user-select: none;
        }
        
        .slider-inner-labels span {
            color: rgba(255, 255, 255, 0.9);
            font-size: 13px;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0,0,0,0.4);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        /* Labels laterali sempre visibili, centrale appare solo quando muovi */
        .slider-inner-labels span:first-child,
        .slider-inner-labels span:last-child {
            opacity: 0;
        }
        
        .slider-inner-labels span.visible {
            opacity: 1;
        }
        
        .slider-inner-labels .label-center {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
        }
        
        .slider-inner-labels.active span {
            opacity: 1;
        }
        
        /* Slider dot generico */
        .slider-dot {
            position: absolute;
            width: 56px;
            height: 56px;
            background: radial-gradient(circle at 30% 30%, #60a5fa, #3b82f6, #2563eb, #1e40af);
            border: 3px solid rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            top: 2px;
            cursor: grab;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3), inset 0 -2px 8px rgba(0, 0, 0, 0.2);
            transition: left 0.15s ease-out;
            will-change: left;
            z-index: 10;
        }
        
        .slider-dot:active {
            cursor: grabbing;
            transform: scale(0.95);
            transition: none;
        }
        
        /* Mood selector rettangolare */
        .mood-selector {
            position: relative;
            width: 100%;
            height: 200px;
            margin: 15px auto;
            background: linear-gradient(135deg, 
                #ec4899 0%, 
                #8b5cf6 25%, 
                #3b82f6 50%, 
                #10b981 75%, 
                #f59e0b 100%);
            border-radius: 20px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            overflow: hidden;
        }
        
        @media (max-height: 700px) {
            .mood-selector {
                height: 150px;
            }
        }
        
        .mood-labels {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            user-select: none;
        }
        
        .mood-label {
            position: absolute;
            color: rgba(255, 255, 255, 0.9);
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            text-shadow: 0 2px 4px rgba(0,0,0,0.4);
        }
        
        /* Posizioni etichette mood - tutte dentro */
        .mood-label.top { 
            top: 10px; 
            left: 50%; 
            transform: translateX(-50%); 
        }
        .mood-label.bottom { 
            bottom: 10px; 
            left: 50%; 
            transform: translateX(-50%); 
        }
        .mood-label.left { 
            left: 15px; 
            top: 50%; 
            transform: translateY(-50%); 
        }
        .mood-label.right { 
            right: 15px; 
            top: 50%; 
            transform: translateY(-50%); 
        }
        .mood-label.top-left { 
            top: 25px; 
            left: 25px; 
        }
        .mood-label.top-right { 
            top: 25px; 
            right: 25px; 
        }
        .mood-label.bottom-left { 
            bottom: 25px; 
            left: 25px; 
        }
        .mood-label.bottom-right { 
            bottom: 25px; 
            right: 25px; 
        }
        
        /* Mood labels nascosti di default */
        .mood-label {
            opacity: 0;
            transition: opacity 0.4s ease;
        }
        
        .mood-label.visible {
            opacity: 1;
        }
        
        /* Joystick globe */
        .joystick-globe {
            position: absolute;
            width: 56px;
            height: 56px;
            background: radial-gradient(circle at 30% 30%, #60a5fa, #3b82f6, #2563eb, #1e40af);
            border: 3px solid rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            cursor: grab;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4), inset 0 -2px 8px rgba(0, 0, 0, 0.2);
            transition: left 0.1s ease-out, top 0.1s ease-out;
            will-change: left, top;
            z-index: 10;
        }
        
        .joystick-globe:active {
            cursor: grabbing;
            transform: translate(-50%, -50%) scale(0.95);
            transition: none;
        }
        
        /* Globo loading - versione semplice che gira */
        @keyframes spinGlobe {
            from { 
                transform: rotateY(0deg) rotateX(10deg); 
            }
            to { 
                transform: rotateY(360deg) rotateX(10deg); 
            }
        }
        
        .loading-globe {
            width: 180px;
            height: 180px;
            margin: 0 auto;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #60a5fa, #3b82f6, #2563eb, #1e40af);
            border: 9px solid rgba(255, 255, 255, 0.9);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3), inset 0 -2px 8px rgba(0, 0, 0, 0.2);
            animation: spinGlobe 2s linear infinite;
            transform-style: preserve-3d;
        }
        
        /* Risultati */
        .narrative-text {
            background: rgba(255, 255, 255, 0.05);
            border-left: 4px solid #fbbf24;
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 0 12px 12px 0;
            font-size: 1.1rem;
            line-height: 1.8;
            font-style: italic;
        }
        
        .hidden { display: none; }
    </style>
</head>
<body class="text-white">
    <!-- Language Selector (9 lingue con italiano!) -->
    <div class="lang-selector">
        <div class="lang-btn active" data-lang="it" title="Italiano">üáÆüáπ</div>
        <div class="lang-btn" data-lang="en" title="English">üá¨üáß</div>
        <div class="lang-btn" data-lang="zh" title="‰∏≠Êñá">üá®üá≥</div>
        <div class="lang-btn" data-lang="es" title="Espa√±ol">üá™üá∏</div>
        <div class="lang-btn" data-lang="hi" title="‡§π‡§ø‡§®‡•ç‡§¶‡•Ä">üáÆüá≥</div>
        <div class="lang-btn" data-lang="ar" title="ÿßŸÑÿπÿ±ÿ®Ÿäÿ©">üá¶üá™</div>
        <div class="lang-btn" data-lang="fr" title="Fran√ßais">üá´üá∑</div>
        <div class="lang-btn" data-lang="pt" title="Portugu√™s">üáßüá∑</div>
        <div class="lang-btn" data-lang="ru" title="–†—É—Å—Å–∫–∏–π">üá∑üá∫</div>
    </div>

    <!-- STEP 1: SLIDERS -->
    <div id="slider-step">
        <div class="main-container">
            <div class="text-center mb-6">
                <h1 class="text-5xl font-bold mb-3 bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent">
                    Gloober
                </h1>
                <p class="text-lg text-gray-300" data-translate="tagline">Slide your travel vibes</p>
            </div>

            <div class="glass-card rounded-2xl">
                <!-- Location Slider -->
                <div class="mb-6">
                    <h3 class="text-md font-semibold mb-2 text-center text-gray-200" data-translate="habitatLabel">Habitat</h3>
                    <div class="slider-container location-slider" onmousedown="startLocationDrag(event)" onmousemove="dragLocation(event)" onmouseup="stopLocationDrag()" onmouseleave="stopLocationDrag()" ontouchstart="startLocationDrag(event)" ontouchmove="dragLocation(event)" ontouchend="stopLocationDrag()">
                        <div class="slider-inner-labels" id="location-labels">
                            <span>üèñÔ∏è <span data-translate="sea">MARE</span></span>
                            <span class="label-center">üé® <span data-translate="city">CITT√Ä</span></span>
                            <span>üèîÔ∏è <span data-translate="mountain">MONTAGNA</span></span>
                        </div>
                        <div class="slider-dot" id="location-dot" style="left: 50%;"></div>
                    </div>
                </div>

                <!-- Distance Slider -->
                <div class="mb-6">
                    <h3 class="text-md font-semibold mb-2 text-center text-gray-200" data-translate="rangeLabel">Range</h3>
                    <div class="slider-container distance-slider" onmousedown="startDistanceDrag(event)" onmousemove="dragDistance(event)" onmouseup="stopDistanceDrag()" onmouseleave="stopDistanceDrag()" ontouchstart="startDistanceDrag(event)" ontouchmove="dragDistance(event)" ontouchend="stopDistanceDrag()">
                        <div class="slider-inner-labels" id="distance-labels">
                            <span>üè† <span data-translate="comfort">COMFORT</span></span>
                            <span class="label-center">üåç <span data-translate="curious">CURIOUS</span></span>
                            <span>‚úàÔ∏è <span data-translate="bloom">BLOOM</span></span>
                        </div>
                        <div class="slider-dot" id="distance-dot" style="left: 50%;"></div>
                    </div>
                </div>

                <!-- Mood Selector -->
                <div class="mb-6">
                    <h3 class="text-md font-semibold mb-2 text-center text-gray-200" data-translate="vibesLabel">Vibes</h3>
                    <div class="mood-selector" id="mood-selector" 
                         onmousedown="startDragging(event)" 
                         onmousemove="dragGlobe(event)"
                         onmouseup="stopDragging()"
                         onmouseleave="stopDragging()"
                         ontouchstart="startDragging(event)"
                         ontouchmove="dragGlobe(event)"
                         ontouchend="stopDragging()">
                        <div class="mood-labels">
                            <span class="mood-label top" data-translate="movida">MOVIDA</span>
                            <span class="mood-label bottom" data-translate="zen">ZEN</span>
                            <span class="mood-label left" data-translate="gourmet">GOURMET</span>
                            <span class="mood-label right" data-translate="wild">WILD</span>
                            <span class="mood-label top-left" data-translate="design">DESIGN</span>
                            <span class="mood-label top-right" data-translate="glamour">GLAMOUR</span>
                            <span class="mood-label bottom-left" data-translate="culture">CULTURE</span>
                            <span class="mood-label bottom-right" data-translate="romantic">ROMANTIC</span>
                        </div>
                        <div class="joystick-globe" id="mood-globe"></div>
                    </div>
                </div>

                <!-- Gloob Button -->
                <div class="text-center">
                    <button onclick="gloobIt()" class="bg-gradient-to-r from-yellow-400 to-orange-500 text-black font-bold py-3 px-6 rounded-full text-lg hover:from-yellow-300 hover:to-orange-400 transition-all transform hover:scale-105">
                        <span data-translate="gloobIt">GLOOB IT!</span> üåç
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- STEP 2: LOADING -->
    <div id="loading-step" class="hidden min-h-screen flex items-center justify-center">
        <div class="text-center">
            <div style="width: 200px; height: 200px; margin: 0 auto; display: flex; align-items: center; justify-content: center; perspective: 1000px;">
                <div class="loading-globe"></div>
            </div>
            <h2 class="text-3xl font-bold mt-6" data-translate="gloobing">Gloobing...</h2>
        </div>
    </div>

    <!-- STEP 3: RESULTS -->
    <div id="result-step" class="hidden">
        <div class="container mx-auto px-4 py-8">
            <div class="max-w-4xl mx-auto">
                <!-- Destination Header -->
                <div class="glass-card rounded-2xl p-8 text-center mb-8">
                    <h2 class="text-4xl font-bold text-yellow-400 mb-3" id="destination-name">Loading...</h2>
                    <p class="text-xl italic mb-2" id="destination-tagline">...</p>
                    <p class="text-gray-300" id="destination-country">...</p>
                </div>

                <!-- Narrative -->
                <div class="mb-8">
                    <h3 class="text-2xl font-bold mb-6 text-center" data-translate="yourJourney">Il tuo viaggio</h3>
                    <div class="narrative-text glass-card rounded-xl" id="narrative-text">
                        <!-- La narrativa verr√† inserita qui -->
                    </div>
                </div>

                <!-- Immagine destinazione -->
                <div class="mb-8 text-center">
                    <img id="destination-image" class="rounded-xl shadow-2xl mx-auto max-w-full" style="max-height: 400px;" alt="Destination">
                </div>

                <!-- Citazione -->
                <div class="mb-8">
                    <blockquote class="text-center italic text-lg text-gray-300">
                        <p id="travel-quote" class="mb-2"></p>
                        <cite class="text-sm text-gray-400">‚Äî <span id="quote-author"></span></cite>
                    </blockquote>
                </div>

                <!-- Book Button -->
                <div class="text-center">
                    <button onclick="bookTrip()" class="bg-gradient-to-r from-yellow-400 to-orange-500 text-black font-bold py-4 px-8 rounded-full text-xl hover:from-yellow-300 hover:to-orange-400 transition-all transform hover:scale-105 mb-4">
                        <span data-translate="bookNow">Prenota</span> ‚Üí
                    </button>
                    <br>
                    <button onclick="location.reload()" class="text-gray-400 hover:text-white transition-all">
                        <span data-translate="tryAgain">Regloob</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Traduzioni
        const translations = {
            it: {
                tagline: "Slide your travel vibes",
                habitatLabel: "Habitat",
                rangeLabel: "Range", 
                vibesLabel: "Vibes",
                sea: "MARE",
                city: "CITT√Ä",
                mountain: "MONTAGNA",
                comfort: "COMFORT",
                curious: "CURIOUS",
                bloom: "BLOOM",
                movida: "MOVIDA",
                zen: "ZEN",
                gourmet: "GOURMET",
                wild: "WILD",
                design: "DESIGN",
                romantic: "ROMANTIC",
                culture: "CULTURE",
                glamour: "GLAMOUR",
                gloobIt: "GLOOB IT!",
                gloobing: "Gloobing...",
                yourJourney: "Il tuo viaggio",
                bookNow: "Prenota",
                tryAgain: "Regloob"
            },
            en: {
                tagline: "Slide your travel vibes",
                habitatLabel: "Habitat",
                rangeLabel: "Range",
                vibesLabel: "Vibes",
                sea: "SEA",
                city: "CITY",
                mountain: "MOUNTAIN",
                comfort: "COMFORT",
                curious: "CURIOUS",
                bloom: "BLOOM",
                movida: "PARTY",
                zen: "ZEN",
                gourmet: "GOURMET",
                wild: "WILD",
                design: "DESIGN",
                romantic: "ROMANTIC",
                culture: "CULTURE",
                glamour: "GLAMOUR",
                gloobIt: "GLOOB IT!",
                gloobing: "Gloobing...",
                yourJourney: "Your journey",
                bookNow: "Book",
                tryAgain: "Regloob"
            },
            zh: {
                tagline: "ÊªëÂä®‰Ω†ÁöÑÊóÖË°åÂøÉÊÉÖ",
                habitatLabel: "Habitat",
                rangeLabel: "Ë∑ùÁ¶ª",
                vibesLabel: "Vibes",
                sea: "Êµ∑Ëæπ",
                city: "ÂüéÂ∏Ç",
                mountain: "Â±±Âå∫",
                comfort: "ËàíÈÄÇ",
                curious: "Â•ΩÂ•á",
                bloom: "ÁªΩÊîæ",
                movida: "Ê¥æÂØπ",
                zen: "Á¶ÖÊÑè",
                gourmet: "ÁæéÈ£ü",
                wild: "ÁãÇÈáé",
                design: "ËÆæËÆ°",
                romantic: "Êµ™Êº´",
                culture: "ÊñáÂåñ",
                glamour: "È≠ÖÂäõ",
                gloobIt: "ÂºÄÂßãÊé¢Á¥¢ÔºÅ",
                gloobing: "Êé¢Á¥¢‰∏≠...",
                yourJourney: "‰Ω†ÁöÑÊóÖÁ®ã",
                bookNow: "È¢ÑËÆ¢",
                tryAgain: "ÈáçÊñ∞Êé¢Á¥¢"
            },
            es: {
                tagline: "Desliza tus vibras viajeras",
                habitatLabel: "H√°bitat",
                rangeLabel: "Alcance",
                vibesLabel: "Vibras",
                sea: "MAR",
                city: "CIUDAD",
                mountain: "MONTA√ëA",
                comfort: "COMFORT",
                curious: "CURIOUS",
                bloom: "FLORECER",
                movida: "MOVIDA",
                zen: "ZEN",
                gourmet: "GOURMET",
                wild: "SALVAJE",
                design: "DISE√ëO",
                romantic: "ROM√ÅNTICO",
                culture: "CULTURA",
                glamour: "GLAMOUR",
                gloobIt: "¬°GLOOB IT!",
                gloobing: "Gloobeando...",
                yourJourney: "Tu viaje",
                bookNow: "Reserva",
                tryAgain: "Regloob"
            },
            hi: {
                tagline: "‡§Ö‡§™‡§®‡•Ä ‡§ü‡•ç‡§∞‡•à‡§µ‡§≤ ‡§µ‡§æ‡§á‡§¨‡•ç‡§∏ ‡§∏‡•ç‡§≤‡§æ‡§á‡§° ‡§ï‡§∞‡•á‡§Ç",
                habitatLabel: "Habitat",
                rangeLabel: "Range",
                vibesLabel: "Vibes",
                sea: "‡§∏‡§Æ‡•Å‡§¶‡•ç‡§∞",
                city: "‡§∂‡§π‡§∞",
                mountain: "‡§™‡§π‡§æ‡§°‡§º",
                comfort: "COMFORT",
                curious: "CURIOUS", 
                bloom: "BLOOM",
                movida: "‡§™‡§æ‡§∞‡•ç‡§ü‡•Ä",
                zen: "‡§∂‡§æ‡§Ç‡§§‡§ø",
                gourmet: "‡§∏‡•ç‡§µ‡§æ‡§¶‡§ø‡§∑‡•ç‡§ü",
                wild: "‡§ú‡§Ç‡§ó‡§≤‡•Ä",
                design: "‡§°‡§ø‡§ú‡§º‡§æ‡§á‡§®",
                romantic: "‡§∞‡•ã‡§Æ‡§æ‡§Ç‡§ü‡§ø‡§ï",
                culture: "‡§∏‡§Ç‡§∏‡•ç‡§ï‡•É‡§§‡§ø",
                glamour: "‡§ó‡•ç‡§≤‡•à‡§Æ‡§∞",
                gloobIt: "‡§ö‡§≤‡•ã ‡§ö‡§≤‡•á‡§Ç!",
                gloobing: "‡§ñ‡•ã‡§ú ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...",
                yourJourney: "‡§Ü‡§™‡§ï‡•Ä ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ",
                bookNow: "‡§¨‡•Å‡§ï ‡§ï‡§∞‡•á‡§Ç",
                tryAgain: "‡§´‡§ø‡§∞ ‡§∏‡•á"
            },
            ar: {
                tagline: "ÿ≠ÿ±ŸÉ ÿ£ÿ¨Ÿàÿßÿ° ÿ≥ŸÅÿ±ŸÉ",
                habitatLabel: "Habitat",
                rangeLabel: "ŸÖÿØŸâ",
                vibesLabel: "Vibes",
                sea: "ÿ®ÿ≠ÿ±",
                city: "ŸÖÿØŸäŸÜÿ©",
                mountain: "ÿ¨ÿ®ÿßŸÑ",
                comfort: "ÿ±ÿßÿ≠ÿ©",
                curious: "ŸÅÿ∂ŸàŸÑ",
                bloom: "ÿßÿ≤ÿØŸáÿßÿ±",
                movida: "ÿ≠ŸÅŸÑÿ©",
                zen: "ŸáÿØŸàÿ°",
                gourmet: "ÿ∑ÿπÿßŸÖ ŸÅÿßÿÆÿ±",
                wild: "ÿ®ÿ±Ÿä",
                design: "ÿ™ÿµŸÖŸäŸÖ",
                romantic: "ÿ±ŸàŸÖÿßŸÜÿ≥Ÿä",
                culture: "ÿ´ŸÇÿßŸÅÿ©",
                glamour: "ÿ≥ÿ≠ÿ±",
                gloobIt: "ŸáŸäÿß ÿ®ŸÜÿß!",
                gloobing: "ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ®ÿ≠ÿ´...",
                yourJourney: "ÿ±ÿ≠ŸÑÿ™ŸÉ",
                bookNow: "ÿßÿ≠ÿ¨ÿ≤",
                tryAgain: "ÿ¨ÿ±ÿ® ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ"
            },
            fr: {
                tagline: "Glisse tes vibes de voyage",
                habitatLabel: "Habitat",
                rangeLabel: "Port√©e",
                vibesLabel: "Vibes",
                sea: "MER",
                city: "VILLE",
                mountain: "MONTAGNE",
                comfort: "CONFORT",
                curious: "CURIEUX",
                bloom: "√âCLOSION",
                movida: "F√äTE",
                zen: "ZEN",
                gourmet: "GOURMET",
                wild: "SAUVAGE",
                design: "DESIGN",
                romantic: "ROMANTIQUE",
                culture: "CULTURE",
                glamour: "GLAMOUR",
                gloobIt: "GLOOB IT!",
                gloobing: "Gloobing...",
                yourJourney: "Ton voyage",
                bookNow: "R√©server",
                tryAgain: "Regloob"
            },
            pt: {
                tagline: "Deslize suas vibes de viagem",
                habitatLabel: "Habitat",
                rangeLabel: "Alcance",
                vibesLabel: "Vibes",
                sea: "MAR",
                city: "CIDADE",
                mountain: "MONTANHA",
                comfort: "COMFORT",
                curious: "CURIOUS",
                bloom: "FLORESCER",
                movida: "FESTA",
                zen: "ZEN",
                gourmet: "GOURMET",
                wild: "SELVAGEM",
                design: "DESIGN",
                romantic: "ROM√ÇNTICO",
                culture: "CULTURA",
                glamour: "GLAMOUR",
                gloobIt: "GLOOB IT!",
                gloobing: "Gloobing...",
                yourJourney: "Sua viagem",
                bookNow: "Reserve",
                tryAgain: "Regloob"
            },
            ru: {
                tagline: "–°–ª–∞–π–¥–∏ —Å–≤–æ–∏ —Ç—Ä—ç–≤–µ–ª –≤–∞–π–±—ã",
                habitatLabel: "Habitat",
                rangeLabel: "–î–∞–ª—å–Ω–æ—Å—Ç—å",
                vibesLabel: "–í–∞–π–±—Å",
                sea: "–ú–û–†–ï",
                city: "–ì–û–†–û–î",
                mountain: "–ì–û–†–´",
                comfort: "–ö–û–ú–§–û–†–¢",
                curious: "–õ–Æ–ë–û–ü–´–¢–°–¢–í–û",
                bloom: "–†–ê–°–¶–í–ï–¢",
                movida: "–í–ï–ß–ï–†–ò–ù–ö–ê",
                zen: "–î–ó–ï–ù",
                gourmet: "–ì–£–†–ú–≠",
                wild: "–î–ò–ö–ò–ô",
                design: "–î–ò–ó–ê–ô–ù",
                romantic: "–†–û–ú–ê–ù–¢–ò–ö–ê",
                culture: "–ö–£–õ–¨–¢–£–†–ê",
                glamour: "–ì–õ–ê–ú–£–†",
                gloobIt: "–ü–û–ï–•–ê–õ–ò!",
                gloobing: "–ü–æ–∏—Å–∫...",
                yourJourney: "–¢–≤–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ",
                bookNow: "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å",
                tryAgain: "–ï—â–µ —Ä–∞–∑"
            }
        };

        // Database destinazioni con narrative
        const destinations = {
            // MARE + MOVIDA + COMFORT
            "sea-movida-comfort": [
                {
                    name: "Ibiza",
                    country: "Spain",
                    tagline: {
                        it: "Dove il tramonto diventa festa",
                        en: "Where sunset becomes the party",
                        es: "Donde el atardecer se convierte en fiesta",
                        fr: "O√π le coucher de soleil devient f√™te"
                    },
                    narratives: [
                        {
                            it: "Yoga all'alba a Benirr√†s, i tamburi iniziano a suonare. Salti da una caletta segreta all'altra - l'acqua √® smeraldo liquido. Pranzo in un chiringuito dove il tempo non esiste. Tramonto al Caf√© del Mar, poi la notte ti porta dove vuole: beach club, grotte misteriose, terrazze sotto le stelle. L'isola ti ha insegnato che la libert√† ha il sapore del sale.",
                            en: "Dawn yoga at Benirr√†s, drums begin their rhythm. You hop from one secret cove to another - water like liquid emerald. Lunch at a chiringuito where time doesn't exist. Sunset at Caf√© del Mar, then night takes you where it wants: beach clubs, mysterious caves, terraces under stars. The island teaches you freedom tastes like salt.",
                            es: "Yoga al amanecer en Benirr√†s, los tambores empiezan a sonar. Saltas de una cala secreta a otra - el agua es esmeralda l√≠quida. Almuerzo en un chiringuito donde el tiempo no existe. Atardecer en Caf√© del Mar, luego la noche te lleva donde quiere: beach clubs, cuevas misteriosas, terrazas bajo las estrellas. La isla te ense√±a que la libertad sabe a sal."
                        },
                        {
                            it: "Es Vedr√† emerge dalla nebbia come un'apparizione. Mercatino hippy a Las Dalias - compri un braccialetto che profuma di incenso. Paella in una baia nascosta, i piedi nella sabbia. Il pomeriggio scivola tra hammam e massaggi. Cena a Sa Caleta mentre il sole tuffa nel mare. La notte √® giovane e tu anche.",
                            en: "Es Vedr√† emerges from the mist like an apparition. Hippy market at Las Dalias - you buy a bracelet that smells of incense. Paella in a hidden bay, feet in the sand. Afternoon slides between hammam and massages. Dinner at Sa Caleta as the sun dives into the sea. The night is young and so are you.",
                            es: "Es Vedr√† emerge de la niebla como una aparici√≥n. Mercadillo hippy en Las Dalias - compras una pulsera que huele a incienso. Paella en una bah√≠a escondida, los pies en la arena. La tarde se desliza entre hammam y masajes. Cena en Sa Caleta mientras el sol se sumerge en el mar. La noche es joven y t√∫ tambi√©n."
                        },
                        {
                            it: "L'isola bianca ti accoglie con le braccia aperte. Fichi e mandorle a colazione, poi via verso l'entroterra segreto. Villaggi di calce dove il tempo scorre diverso. Un vecchio ti indica una spiaggia che non c'√® sulle mappe. Ci arrivi al tramonto - solo tu e il Mediterraneo. Le stelle stanotte sono pi√π vicine.",
                            en: "The white island welcomes you with open arms. Figs and almonds for breakfast, then off to the secret interior. Whitewashed villages where time flows differently. An old man points you to a beach not on any map. You arrive at sunset - just you and the Mediterranean. Tonight the stars are closer.",
                            es: "La isla blanca te recibe con los brazos abiertos. Higos y almendras para desayunar, luego hacia el interior secreto. Pueblos encalados donde el tiempo fluye diferente. Un anciano te se√±ala una playa que no est√° en los mapas. Llegas al atardecer - solo t√∫ y el Mediterr√°neo. Esta noche las estrellas est√°n m√°s cerca."
                        }
                    ],
            // MONTAGNA + GOURMET + COMFORT
            "mountain-gourmet-comfort": [
                {
                    name: "Val d'Aosta",
                    country: "Italy",
                    tagline: {
                        it: "Dove il gusto incontra le vette",
                        en: "Where taste meets peaks",
                        fr: "O√π le go√ªt rencontre les sommets"
                    },
                    narratives: [
                        {
                            it: "Il Monte Bianco ti saluta dalla finestra. Colazione con fontina d'alpeggio e miele di rododendro. Le terme di Pr√©-Saint-Didier - acqua calda mentre nevica sulle cime. Pranzo in una baita segreta: polenta concia e cervo al ginepro. Il pomeriggio scompare tra vigneti eroici e castelli medievali. Cena stellata con vista sul gigante bianco. La grappa alle erbe alpine chiude una giornata dove ogni boccone racconta la montagna.",
                            en: "Mont Blanc greets you from the window. Breakfast with alpine fontina and rhododendron honey. Pr√©-Saint-Didier thermal baths - hot water while snow falls on peaks. Lunch in a secret mountain hut: polenta concia and juniper venison. Afternoon disappears between heroic vineyards and medieval castles. Starred dinner overlooking the white giant. Alpine herb grappa closes a day where every bite tells the mountain's story.",
                            fr: "Le Mont Blanc vous salue depuis la fen√™tre. Petit-d√©jeuner avec fontine d'alpage et miel de rhododendron. Les thermes de Pr√©-Saint-Didier - eau chaude pendant qu'il neige sur les sommets. D√©jeuner dans un chalet secret: polenta concia et cerf au geni√®vre. L'apr√®s-midi dispara√Æt entre vignobles h√©ro√Øques et ch√¢teaux m√©di√©vaux."
                        }
                    ]
                }
            ],
            // MONTAGNA + DESIGN + CURIOUS  
            "mountain-design-curious": [
                {
                    name: "Innsbruck",
                    country: "Austria",
                    tagline: {
                        it: "Dove l'architettura scala le vette",
                        en: "Where architecture climbs peaks",
                        de: "Wo Architektur Gipfel erklimmt"
                    },
                    narratives: [
                        {
                            it: "La funivia di Zaha Hadid ti porta in cielo. Colazione al Bergisel con vista a 360 gradi. Il centro storico mescola barocco e avanguardia - il Tetto d'Oro brilla mentre entri al museo del XXI secolo. Lunch al Cloud 9, igloo di design a 3000 metri. I cristalli Swarovski raccontano storie di luce. La sera, sauna panoramica e cocktail molecular nel cuore delle Alpi. Innsbruck ti mostra che il futuro pu√≤ abitare tra le montagne.",
                            en: "Zaha Hadid's cable car takes you to heaven. Breakfast at Bergisel with 360-degree views. The old town mixes baroque and avant-garde - Golden Roof shines as you enter the 21st century museum. Lunch at Cloud 9, design igloo at 3000 meters. Swarovski crystals tell stories of light. Evening brings panoramic sauna and molecular cocktails in the heart of the Alps. Innsbruck shows you the future can live among mountains.",
                            de: "Die Seilbahn von Zaha Hadid bringt dich in den Himmel. Fr√ºhst√ºck am Bergisel mit 360-Grad-Blick. Die Altstadt mischt Barock und Avantgarde - das Goldene Dachl gl√§nzt w√§hrend du das Museum des 21. Jahrhunderts betrittst. Mittagessen im Cloud 9, Design-Iglu auf 3000 Metern."
                        }
                    ]
                }
            ],
            // MONTAGNA + MOVIDA + BLOOM
            "mountain-movida-bloom": [
                {
                    name: "Chamonix",
                    country: "France", 
                    tagline: {
                        it: "Dove l'adrenalina incontra l'altitude",
                        en: "Where adrenaline meets altitude",
                        fr: "O√π l'adr√©naline rencontre l'altitude"
                    },
                    narratives: [
                        {
                            it: "L'Aiguille du Midi ti aspetta. Prima luce sulla Mer de Glace - sci fuoripista nella polvere vergine. Pranzo al rifugio, vin brul√© e racconti di alpinisti. Il pomeriggio voli col parapendio sopra la valle. Aperitivo al Chambre Neuf - DJ set con vista sul Monte Bianco. La notte ti porta da una festa in baita all'altra, mentre le stelle alpine vegliano sui tuoi eccessi. Chamonix ti insegna che si pu√≤ ballare anche a 4000 metri.",
                            en: "Aiguille du Midi awaits. First light on Mer de Glace - off-piste skiing in virgin powder. Lunch at the refuge, mulled wine and mountaineer tales. Afternoon paragliding over the valley. Aperitif at Chambre Neuf - DJ set overlooking Mont Blanc. Night takes you from one chalet party to another, while alpine stars watch over your excesses. Chamonix teaches you can dance even at 4000 meters.",
                            fr: "L'Aiguille du Midi t'attend. Premi√®re lumi√®re sur la Mer de Glace - ski hors-piste dans la poudreuse vierge. D√©jeuner au refuge, vin chaud et r√©cits d'alpinistes. L'apr√®s-midi tu voles en parapente au-dessus de la vall√©e. Ap√©ro au Chambre Neuf - DJ set avec vue sur le Mont Blanc."
                        }
                    ]
                }
            ]
                },
                {
                    name: "Mykonos",
                    country: "Greece",
                    tagline: {
                        it: "Dove gli dei fanno festa",
                        en: "Where gods come to party",
                        es: "Donde los dioses vienen de fiesta",
                        fr: "O√π les dieux font la f√™te"
                    },
                    narratives: [
                        {
                            it: "Il sole ti sveglia attraverso le persiane bianche. Colazione con fichi e miele vista mare, poi ti perdi nei vicoli del borgo fino a Paradise Beach. L'acqua √® cristallo puro. Nel pomeriggio scopri una taverna nascosta dove il padrone ti racconta storie di dei e pescatori. Al tramonto sei a Little Venice, i piedi a mollo, un cocktail che sa di estate infinita. La notte inizia dolce e finisce con l'alba - balli a piedi nudi sulla sabbia mentre il cielo si tinge di rosa. Domani non sarai pi√π la stessa persona.",
                            en: "Sun wakes you through white shutters. Breakfast of figs and honey with sea view, then you lose yourself in village alleys until Paradise Beach. Water like pure crystal. Afternoon brings a hidden taverna where the owner tells tales of gods and fishermen. Sunset finds you in Little Venice, feet in water, cocktail tasting of endless summer. Night starts sweet and ends with dawn - barefoot dancing on sand as sky turns pink. Tomorrow you won't be the same person.",
                            es: "El sol te despierta a trav√©s de las persianas blancas. Desayuno con higos y miel con vista al mar, luego te pierdes en los callejones hasta Paradise Beach. El agua es cristal puro. Por la tarde descubres una taberna escondida donde el due√±o cuenta historias de dioses y pescadores. Al atardecer est√°s en Little Venice, los pies en el agua, un c√≥ctel que sabe a verano infinito. La noche empieza dulce y termina con el alba - bailas descalzo en la arena mientras el cielo se ti√±e de rosa."
                        }
                    ]
                }
            ],
            // CITT√Ä + CULTURE + CURIOUS
            "city-culture-curious": [
                {
                    name: "Kyoto",
                    country: "Japan",
                    tagline: {
                        en: "Where tradition whispers through time",
                        zh: "‰º†ÁªüÂú®Êó∂ÂÖâ‰∏≠‰ΩéËØ≠",
                        es: "Donde la tradici√≥n susurra a trav√©s del tiempo"
                    },
                    narratives: [
                        {
                            it: "Nebbia sui templi. Ti alzi prima dell'alba per attraversare i mille torii rossi di Fushimi Inari in solitudine. Il t√® matcha in una casa tradizionale ti centra l'anima. Cammini nel bamb√π di Arashiyama - il vento sussurra segreti antichi. Un monaco ti sorride al tempio d'oro. La sera ti trovi in un onsen nascosto, l'acqua calda scioglie ogni resistenza. Kyoto ti ha mostrato che il silenzio pu√≤ essere pi√π forte di qualsiasi parola. Torni diverso, pi√π lento, pi√π profondo.",
                            en: "Mist over temples. You rise before dawn to walk through Fushimi Inari's thousand torii gates in solitude. Matcha tea in a traditional house centers your soul. Walking through Arashiyama bamboo - wind whispers ancient secrets. A monk smiles at the golden temple. Evening finds you in a hidden onsen, hot water melting all resistance. Kyoto shows you silence can be louder than any words. You return different, slower, deeper.",
                            zh: "ÂØ∫Â∫ôÁ¨ºÁΩ©Âú®ËñÑÈõæ‰∏≠„ÄÇ‰Ω†Âú®ÈªéÊòéÂâçËµ∑Â∫äÔºåÁã¨Ëá™Á©øËøá‰ºèËßÅÁ®ªËç∑ÁöÑÂçÉÊú¨È∏üÂ±Ö„ÄÇÂú®‰º†ÁªüËå∂ÂÆ§ÂìÅÂ∞ùÊäπËå∂ÔºåÁÅµÈ≠ÇÂæóÂà∞ÂáÄÂåñ„ÄÇÊº´Ê≠•Â≤öÂ±±Á´πÊûóÔºåÈ£éÂ£∞ËØâËØ¥ÁùÄÂè§ËÄÅÁöÑÁßòÂØÜ„ÄÇÈáëÈòÅÂØ∫ÁöÑÂÉß‰∫∫ÂØπ‰Ω†ÂæÆÁ¨ë„ÄÇÂ§úÊôö‰Ω†Ê≥°Âú®ÈöêÁßòÁöÑÊ∏©Ê≥âÈáåÔºåÁÉ≠Ê∞¥ËûçÂåñ‰∫ÜÊâÄÊúâÁöÑÊäµÊäó„ÄÇ‰∫¨ÈÉΩÊïô‰ºö‰Ω†ÔºåÊ≤âÈªòÂèØ‰ª•ÊØî‰ªª‰ΩïË®ÄËØ≠Êõ¥ÊúâÂäõÈáè„ÄÇ‰Ω†ÂΩíÊù•Êó∂Â∑≤ÊòØÂè¶‰∏Ä‰∏™‰∫∫ÔºåÊõ¥ÁºìÊÖ¢ÔºåÊõ¥Ê∑±Ê≤â„ÄÇ"
                        }
                    ]
                }
            ],
            // MONTAGNA + WILD + BLOOM
            "mountain-wild-bloom": [
                {
                    name: "Patagonia",
                    country: "Chile/Argentina",
                    tagline: {
                        it: "Dove finisce il mondo e inizia l'avventura",
                        en: "Where the world ends and adventure begins",
                        es: "Donde termina el mundo y comienza la aventura",
                        pt: "Onde o mundo termina e a aventura come√ßa"
                    },
                    narratives: [
                        {
                            it: "Ti svegli e il mondo √® infinito. Ghiacciai che scricchiolano, condor che planano sopra la tua testa. Cavalchi con i gaucho attraverso la pampa sconfinata - il vento ti sculpisce il viso. Torres del Paine si staglia contro un cielo impossibile. La notte √® un planetario naturale, la Via Lattea cos√¨ vicina che potresti toccarla. Attorno al fuoco, con l'asado che sfrigola, capisci che esistono ancora posti dove la Terra respira selvaggia. L'avventura ti ha cambiato il DNA.",
                            en: "You wake and the world is infinite. Glaciers creaking, condors soaring overhead. Riding with gauchos across endless pampas - wind sculpts your face. Torres del Paine stands against an impossible sky. Night is a natural planetarium, Milky Way so close you could touch it. Around the fire, asado sizzling, you understand there are still places where Earth breathes wild. Adventure has changed your DNA.",
                            es: "Te despiertas y el mundo es infinito. Glaciares que crujen, c√≥ndores planeando sobre tu cabeza. Cabalgando con los gauchos por la pampa sin fin - el viento esculpe tu rostro. Torres del Paine se alza contra un cielo imposible. La noche es un planetario natural, la V√≠a L√°ctea tan cerca que podr√≠as tocarla. Alrededor del fuego, con el asado chisporroteando, entiendes que a√∫n existen lugares donde la Tierra respira salvaje."
                        }
                    ]
                }
            ],
            // MONTAGNA + ZEN + COMFORT
            "mountain-zen-comfort": [
                {
                    name: "Dolomiti",
                    country: "Italy",
                    tagline: {
                        it: "Dove le vette toccano l'anima",
                        en: "Where peaks touch the soul",
                        de: "Wo Gipfel die Seele ber√ºhren"
                    },
                    narratives: [
                        {
                            it: "Le Dolomiti si tingono di rosa all'alba. Colazione con vista sulle Tre Cime di Lavaredo - caff√® e strudel mentre il mondo si sveglia. Sentieri che profumano di pino e resina. Un rifugio nascosto dove il tempo si ferma per un bombardino. Il lago di Braies riflette il cielo come uno specchio d'acqua perfetto. La sera, nella spa dell'hotel, l'acqua calda ti culla mentre fuori nevica piano. Le montagne ti hanno insegnato che la pace ha il colore del silenzio bianco.",
                            en: "The Dolomites blush pink at dawn. Breakfast overlooking Tre Cime di Lavaredo - coffee and strudel as the world awakens. Trails scented with pine and resin. A hidden refuge where time stops for bombardino. Lake Braies reflects the sky like a perfect mirror. Evening in the hotel spa, warm water cradles you while snow falls softly outside. The mountains teach you peace has the color of white silence.",
                            de: "Die Dolomiten err√∂ten rosa im Morgengrauen. Fr√ºhst√ºck mit Blick auf die Drei Zinnen - Kaffee und Strudel w√§hrend die Welt erwacht. Wege duften nach Kiefer und Harz. Eine versteckte H√ºtte wo die Zeit f√ºr einen Bombardino steht. Der Pragser Wildsee spiegelt den Himmel wie ein perfekter Spiegel. Abends im Hotel-Spa, warmes Wasser wiegt dich w√§hrend drau√üen leise Schnee f√§llt."
                        }
                    ]
                }
            ],
            // MONTAGNA + ROMANTIC + CURIOUS
            "mountain-romantic-curious": [
                {
                    name: "Swiss Alps",
                    country: "Switzerland",
                    tagline: {
                        it: "Dove l'amore trova la sua altezza",
                        en: "Where love finds its altitude",
                        fr: "O√π l'amour trouve son altitude"
                    },
                    narratives: [
                        {
                            it: "Il treno panoramico ti porta tra cime innevate e villaggi da fiaba. Zermatt ti accoglie con il Cervino che domina ogni vista. Fonduta a lume di candela in uno chalet nascosto. La mattina dopo, la funivia ti porta in paradiso - colazione a 3000 metri con vista su quattro nazioni. Passeggiata mano nella mano sui sentieri fioriti. Le terme di Leukerbad al tramonto, l'acqua calda che fuma nell'aria fredda. La Svizzera ti ha mostrato che l'amore cresce con l'altitudine.",
                            en: "The panoramic train carries you between snowy peaks and fairytale villages. Zermatt welcomes you with the Matterhorn dominating every view. Candlelit fondue in a hidden chalet. Next morning, cable car takes you to paradise - breakfast at 3000 meters overlooking four nations. Hand in hand walks on flowered trails. Leukerbad thermal baths at sunset, hot water steaming in cold air. Switzerland shows you love grows with altitude.",
                            fr: "Le train panoramique vous transporte entre sommets enneig√©s et villages de conte de f√©es. Zermatt vous accueille avec le Cervin dominant chaque vue. Fondue aux chandelles dans un chalet cach√©. Le lendemain, le t√©l√©ph√©rique vous emm√®ne au paradis - petit d√©jeuner √† 3000 m√®tres avec vue sur quatre nations. Promenades main dans la main sur les sentiers fleuris. Les thermes de Lo√®che-les-Bains au coucher du soleil."
                        }
                    ]
                }
            ]
        };

        // Citazioni di viaggio
        const travelQuotes = {
            it: [
                { text: "Il vero viaggio di scoperta non consiste nel cercare nuove terre, ma nell'avere nuovi occhi.", author: "Marcel Proust" },
                { text: "Si viaggia non per cambiare luogo, ma idea.", author: "Hippolyte Taine" },
                { text: "Il mondo √® un libro e chi non viaggia ne legge solo una pagina.", author: "Sant'Agostino" },
                { text: "Viaggiare √® vivere.", author: "Hans Christian Andersen" },
                { text: "Non si viaggia per fuggire dalla vita, ma perch√© la vita non ci sfugga.", author: "Anonimo" }
            ],
            en: [
                { text: "The real voyage of discovery consists not in seeking new landscapes, but in having new eyes.", author: "Marcel Proust" },
                { text: "We travel not to escape life, but for life not to escape us.", author: "Anonymous" },
                { text: "The world is a book and those who do not travel read only one page.", author: "Saint Augustine" },
                { text: "To travel is to live.", author: "Hans Christian Andersen" },
                { text: "Travel makes one modest. You see what a tiny place you occupy in the world.", author: "Gustave Flaubert" }
            ],
            es: [
                { text: "Viajar es un ejercicio con consecuencias fatales para los prejuicios.", author: "Mark Twain" },
                { text: "El mundo es un libro y aquellos que no viajan leen s√≥lo una p√°gina.", author: "San Agust√≠n" },
                { text: "Viajar es vivir.", author: "Hans Christian Andersen" }
            ]
        };

        // Immagini per destinazioni (usando Unsplash per demo)
        const destinationImages = {
            "Ibiza": "https://images.unsplash.com/photo-1514282401047-d79a71a590e8?w=1200",
            "Mykonos": "https://images.unsplash.com/photo-1601581875039-e899893d520c?w=1200",
            "Kyoto": "https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?w=1200",
            "Patagonia": "https://images.unsplash.com/photo-1501594907352-04cda38ebc29?w=1200",
            "Dolomiti": "https://images.unsplash.com/photo-1557456170-0cf4f4d0d362?w=1200",
            "Swiss Alps": "https://images.unsplash.com/photo-1531366936337-7c912a4589a7?w=1200",
            "Val d'Aosta": "https://images.unsplash.com/photo-1609137144813-7d9921338f24?w=1200",
            "Innsbruck": "https://images.unsplash.com/photo-1567430462357-e5df6a2c8bd0?w=1200",
            "Chamonix": "https://images.unsplash.com/photo-1581888227599-779811939961?w=1200"
        };
        let currentLang = 'it';
        let locationValue = 50;
        let distanceValue = 50;
        let moodX = 50;
        let moodY = 50;
        let isDraggingLocation = false;
        let isDraggingDistance = false;
        let isDragging = false;
        let userLat = null;
        let userLon = null;

        // Inizializzazione
        window.onload = function() {
            // Setup language buttons
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', () => changeLanguage(btn.dataset.lang));
            });
            
            // Detect browser language
            const browserLang = navigator.language.substring(0, 2);
            if (translations[browserLang]) {
                changeLanguage(browserLang);
            }
            
            // Get user location
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    userLat = position.coords.latitude;
                    userLon = position.coords.longitude;
                });
            }
        };

        // Funzione per aggiornare visibilit√† etichette slider
        function updateLabelVisibility(type, value) {
            const labels = document.getElementById(`${type}-labels`);
            const spans = labels.querySelectorAll('span');
            
            // Rimuovi tutte le classi visible
            spans.forEach(span => span.classList.remove('visible'));
            
            // Mostra etichette in base alla posizione
            if (value < 25) {
                // Zona sinistra - mostra solo prima etichetta
                spans[0].classList.add('visible');
            } else if (value > 75) {
                // Zona destra - mostra solo ultima etichetta
                spans[2].classList.add('visible');
            } else if (value > 40 && value < 60) {
                // Zona centrale - mostra solo etichetta centrale
                const centerLabel = labels.querySelector('.label-center');
                if (centerLabel) centerLabel.classList.add('visible');
            } else if (value <= 40) {
                // Transizione sinistra-centro
                spans[0].classList.add('visible');
                const centerLabel = labels.querySelector('.label-center');
                if (centerLabel) centerLabel.classList.add('visible');
            } else {
                // Transizione centro-destra
                spans[2].classList.add('visible');
                const centerLabel = labels.querySelector('.label-center');
                if (centerLabel) centerLabel.classList.add('visible');
            }
        }

        // Funzione per aggiornare etichette mood
        function updateMoodLabels(x, y) {
            const labels = document.querySelectorAll('.mood-label');
            
            // Reset tutte
            labels.forEach(label => label.classList.remove('visible'));
            
            // Calcola quale zona siamo
            const threshold = 30; // distanza per mostrare etichetta
            
            labels.forEach(label => {
                let labelX = 50, labelY = 50;
                
                if (label.classList.contains('top')) labelY = 10;
                if (label.classList.contains('bottom')) labelY = 90;
                if (label.classList.contains('left')) labelX = 10;
                if (label.classList.contains('right')) labelX = 90;
                if (label.classList.contains('top-left')) { labelX = 20; labelY = 20; }
                if (label.classList.contains('top-right')) { labelX = 80; labelY = 20; }
                if (label.classList.contains('bottom-left')) { labelX = 20; labelY = 80; }
                if (label.classList.contains('bottom-right')) { labelX = 80; labelY = 80; }
                
                const distance = Math.sqrt(Math.pow(x - labelX, 2) + Math.pow(y - labelY, 2));
                
                if (distance < threshold) {
                    label.classList.add('visible');
                }
            });
        }

        // Cambio lingua
        function changeLanguage(lang) {
            currentLang = lang;
            
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });
            
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.dataset.translate;
                if (translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });
            
            // RTL per arabo
            document.dir = lang === 'ar' ? 'rtl' : 'ltr';
        }

        // Location slider - movimento fluido
        function startLocationDrag(event) {
            isDraggingLocation = true;
            dragLocation(event);
        }

        function dragLocation(event) {
            if (!isDraggingLocation) return;
            
            event.preventDefault();
            const slider = event.currentTarget;
            const rect = slider.getBoundingClientRect();
            
            let x;
            if (event.type.includes('touch')) {
                x = event.touches[0].clientX - rect.left;
            } else {
                x = event.clientX - rect.left;
            }
            
            const percentage = (x / rect.width) * 100;
            locationValue = Math.max(0, Math.min(100, percentage));
            
            const dot = document.getElementById('location-dot');
            dot.style.left = locationValue + '%';
            
            // Mostra le etichette con fade in
            const labels = document.getElementById('location-labels');
            labels.classList.add('active');
            
            // Gestisci visibilit√† label centrale
            updateLabelVisibility('location', locationValue);
        }

        function stopLocationDrag() {
            isDraggingLocation = false;
        }

        // Distance slider - movimento fluido
        function startDistanceDrag(event) {
            isDraggingDistance = true;
            dragDistance(event);
        }

        function dragDistance(event) {
            if (!isDraggingDistance) return;
            
            event.preventDefault();
            const slider = event.currentTarget;
            const rect = slider.getBoundingClientRect();
            
            let x;
            if (event.type.includes('touch')) {
                x = event.touches[0].clientX - rect.left;
            } else {
                x = event.clientX - rect.left;
            }
            
            const percentage = (x / rect.width) * 100;
            distanceValue = Math.max(0, Math.min(100, percentage));
            
            const dot = document.getElementById('distance-dot');
            dot.style.left = distanceValue + '%';
            
            // Mostra le etichette con fade in
            const labels = document.getElementById('distance-labels');
            labels.classList.add('active');
            
            // Gestisci visibilit√† label centrale
            updateLabelVisibility('distance', distanceValue);
        }

        function stopDistanceDrag() {
            isDraggingDistance = false;
        }

        // Mood joystick
        function startDragging(event) {
            isDragging = true;
            dragGlobe(event);
        }

        function dragGlobe(event) {
            if (!isDragging) return;
            
            const selector = document.getElementById('mood-selector');
            const rect = selector.getBoundingClientRect();
            
            let x, y;
            if (event.type.includes('touch')) {
                x = event.touches[0].clientX - rect.left;
                y = event.touches[0].clientY - rect.top;
            } else {
                x = event.clientX - rect.left;
                y = event.clientY - rect.top;
            }
            
            // Converti in percentuale
            moodX = (x / rect.width) * 100;
            moodY = (y / rect.height) * 100;
            
            // Limita ai bordi
            moodX = Math.max(10, Math.min(90, moodX));
            moodY = Math.max(10, Math.min(90, moodY));
            
            // Muovi il globo
            const globe = document.getElementById('mood-globe');
            globe.style.left = moodX + '%';
            globe.style.top = moodY + '%';
            
            // Mostra etichette mood in base alla posizione
            updateMoodLabels(moodX, moodY);
        }

        function stopDragging() {
            isDragging = false;
        }

        // GLOOB IT!
        function gloobIt() {
            // Nascondi slider, mostra loading
            document.getElementById('slider-step').classList.add('hidden');
            document.getElementById('loading-step').classList.remove('hidden');
            
            setTimeout(() => {
                document.getElementById('loading-step').classList.add('hidden');
                document.getElementById('result-step').classList.remove('hidden');
                showResults();
            }, 2000);
        }

        // Mostra risultati
        function showResults() {
            // Determina categoria location
            let locationType;
            if (locationValue < 33) locationType = 'sea';
            else if (locationValue < 66) locationType = 'city';
            else locationType = 'mountain';
            
            // Determina categoria distanza
            let distanceType;
            if (distanceValue < 33) distanceType = 'comfort';
            else if (distanceValue < 66) distanceType = 'curious';
            else distanceType = 'bloom';
            
            // Determina mood basato su posizione X,Y
            let moodType;
            if (moodY < 33) { // Top zone
                if (moodX < 33) moodType = 'design';
                else if (moodX < 66) moodType = 'movida';
                else moodType = 'glamour';
            } else if (moodY < 66) { // Middle zone
                if (moodX < 50) moodType = 'gourmet';
                else moodType = 'wild';
            } else { // Bottom zone
                if (moodX < 33) moodType = 'culture';
                else if (moodX < 66) moodType = 'zen';
                else moodType = 'romantic';
            }
            
            // Costruisci chiave
            const key = `${locationType}-${moodType}-${distanceType}`;
            
            console.log('Searching for:', key); // Debug
            
            // Cerca destinazione esatta
            let possibleDestinations = destinations[key];
            
            // Se non trova combinazione esatta, cerca alternative intelligenti
            if (!possibleDestinations || possibleDestinations.length === 0) {
                // Prima prova con stesso location e mood, ma diverso distance
                for (let dist of ['comfort', 'curious', 'bloom']) {
                    const altKey = `${locationType}-${moodType}-${dist}`;
                    if (destinations[altKey] && destinations[altKey].length > 0) {
                        possibleDestinations = destinations[altKey];
                        console.log('Found alternative:', altKey);
                        break;
                    }
                }
            }
            
            // Se ancora non trova, prova con stesso location
            if (!possibleDestinations || possibleDestinations.length === 0) {
                for (let key in destinations) {
                    if (key.startsWith(locationType + '-')) {
                        possibleDestinations = destinations[key];
                        console.log('Found location match:', key);
                        break;
                    }
                }
            }
            
            // Solo se proprio non trova niente con quella location, usa fallback
            if (!possibleDestinations || possibleDestinations.length === 0) {
                console.log('Using emergency fallback');
                possibleDestinations = destinations["city-culture-curious"] || [];
            }
            
            // Scegli random
            const destination = possibleDestinations[Math.floor(Math.random() * possibleDestinations.length)];
            
            if (!destination) {
                // Destinazione di emergenza
                showEmergencyDestination();
                return;
            }
            
            // Mostra destinazione
            document.getElementById('destination-name').textContent = destination.name;
            document.getElementById('destination-country').textContent = destination.country;
            document.getElementById('destination-tagline').textContent = 
                destination.tagline[currentLang] || destination.tagline.en || destination.tagline.it;
            
            // Scegli narrativa random
            const narratives = destination.narratives;
            const randomNarrative = narratives[Math.floor(Math.random() * narratives.length)];
            const narrativeText = randomNarrative[currentLang] || randomNarrative.en || randomNarrative.it;
            
            document.getElementById('narrative-text').textContent = narrativeText;
            
            // Mostra immagine
            const image = document.getElementById('destination-image');
            if (destinationImages[destination.name]) {
                image.src = destinationImages[destination.name];
                image.style.display = 'block';
            } else {
                image.style.display = 'none';
            }
            
            // Mostra citazione random
            const quotes = travelQuotes[currentLang] || travelQuotes.en || travelQuotes.it;
            const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
            document.getElementById('travel-quote').textContent = randomQuote.text;
            document.getElementById('quote-author').textContent = randomQuote.author;
        }

        // Destinazione di emergenza
        function showEmergencyDestination() {
            document.getElementById('destination-name').textContent = "Mystery Destination";
            document.getElementById('destination-country').textContent = "Somewhere Amazing";
            document.getElementById('destination-tagline').textContent = "Every journey begins with a single step";
            document.getElementById('narrative-text').textContent = "L'avventura ti aspetta. Ogni viaggio √® una storia da scrivere, ogni destinazione un capitolo nuovo. Parti con il cuore aperto e tornerai con l'anima pi√π ricca.";
            
            // Nascondi immagine per mystery destination
            document.getElementById('destination-image').style.display = 'none';
            
            // Citazione di default
            const quotes = travelQuotes[currentLang] || travelQuotes.en || travelQuotes.it;
            const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
            document.getElementById('travel-quote').textContent = randomQuote.text;
            document.getElementById('quote-author').textContent = randomQuote.author;
        }

        // Prenota
        function bookTrip() {
            window.open('https://trip.tpk.lu/DCFSQxzu', '_blank');
        }
    </script>
</body>
</html>
