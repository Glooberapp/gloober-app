<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gloober - Travel Destination Finder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #0f766e, #065f46, #064e3b);
            min-height: 100vh;
        }

        .globe-container {
            position: relative;
            width: 320px;
            height: 320px;
            margin: 0 auto;
        }
        
        .globe {
            width: 320px;
            height: 320px;
            border-radius: 50%;
            background: linear-gradient(135deg, #60a5fa, #3b82f6, #2563eb);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
            border: 4px solid rgba(255, 255, 255, 0.2);
            transition: transform 1s ease-out;
        }
        
        .spinning {
            animation: spin 3s linear;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(540deg); }
        }
        
        .continent {
            position: absolute;
            background: linear-gradient(135deg, #10b981, #059669, #047857);
            border-radius: 6px;
            opacity: 0.9;
            box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        .europa { top: 80px; left: 96px; width: 32px; height: 24px; transform: rotate(12deg); border-radius: 8px 15px 6px 20px; }
        .europa2 { top: 96px; left: 112px; width: 16px; height: 12px; background: #059669; border-radius: 4px 8px 12px 6px; }
        .africa { top: 112px; left: 80px; width: 48px; height: 80px; transform: rotate(6deg); border-radius: 15px 8px 20px 25px; }
        .africa2 { top: 128px; left: 88px; width: 32px; height: 48px; background: #059669; opacity: 0.8; border-radius: 12px 6px 18px 20px; }
        .asia { top: 64px; right: 64px; width: 64px; height: 48px; transform: rotate(-12deg); border-radius: 25px 15px 8px 30px; }
        .asia2 { top: 72px; right: 48px; width: 40px; height: 32px; background: #059669; border-radius: 18px 12px 6px 20px; }
        .asia3 { top: 104px; right: 80px; width: 24px; height: 16px; background: #047857; border-radius: 8px 12px 4px 15px; }
        .north-america { top: 48px; left: 32px; width: 56px; height: 64px; transform: rotate(45deg); border-radius: 20px 12px 15px 25px; }
        .north-america2 { top: 64px; left: 24px; width: 32px; height: 40px; background: #059669; border-radius: 15px 8px 12px 18px; }
        .south-america { bottom: 64px; left: 48px; width: 32px; height: 80px; transform: rotate(12deg); border-radius: 12px 8px 20px 15px; }
        .south-america2 { bottom: 80px; left: 56px; width: 20px; height: 48px; background: #059669; border-radius: 8px 6px 15px 12px; }
        .australia { bottom: 80px; right: 80px; width: 40px; height: 24px; transform: rotate(-6deg); border-radius: 20px 12px 8px 15px; }
        
        .cloud { position: absolute; background: rgba(255, 255, 255, 0.15); border-radius: 50%; filter: blur(2px); }
        .cloud1 { top: 32px; left: 32px; width: 48px; height: 48px; }
        .cloud2 { top: 128px; right: 48px; width: 32px; height: 32px; }
        .cloud3 { bottom: 96px; left: 64px; width: 40px; height: 40px; }
        
        .grid-lines { position: absolute; inset: 0; }
        .equator { position: absolute; top: 50%; left: 0; width: 100%; height: 2px; background: rgba(255, 255, 255, 0.15); }
        .meridian { position: absolute; left: 50%; top: 0; width: 2px; height: 100%; background: rgba(255, 255, 255, 0.15); }
        .tropic1 { position: absolute; top: 80px; left: 0; width: 100%; height: 2px; background: rgba(255, 255, 255, 0.1); transform: rotate(2deg); }
        .tropic2 { position: absolute; bottom: 80px; left: 0; width: 100%; height: 2px; background: rgba(255, 255, 255, 0.1); transform: rotate(-2deg); }
        
        .pin {
            position: absolute; top: 80px; right: 64px; width: 24px; height: 24px; background: #ef4444; border-radius: 50%;
            border: 2px solid white; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3); animation: bounce 2s infinite;
            display: block; z-index: 10;
        }
        
        .pin::before {
            content: ''; position: absolute; top: -4px; left: -4px; width: 8px; height: 8px; background: #fca5a5;
            border-radius: 50%; animation: ping 2s infinite;
        }
        
        .pin-pole { position: absolute; top: 104px; right: 75px; width: 4px; height: 16px; background: #ef4444; display: block; z-index: 9; }
        
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
            40%, 43% { transform: translate3d(0,-8px,0); }
            70% { transform: translate3d(0,-4px,0); }
            90% { transform: translate3d(0,-2px,0); }
        }
        
        @keyframes ping { 75%, 100% { transform: scale(2); opacity: 0; } }
        
        .ocean-texture { position: absolute; inset: 0; }
        .bubble { position: absolute; background: #bfdbfe; border-radius: 50%; opacity: 0.3; animation: pulse 2s infinite; }
        .bubble1 { top: 40px; left: 40px; width: 8px; height: 8px; }
        .bubble2 { top: 160px; right: 32px; width: 4px; height: 4px; animation-delay: 0.5s; }
        .bubble3 { bottom: 48px; left: 80px; width: 6px; height: 6px; animation-delay: 1s; }
        
        @keyframes pulse { 0%, 100% { opacity: 0.3; } 50% { opacity: 0.6; } }
        
        .hidden { display: none; }
        .glass-card { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.2); }
        
        .custom-dropdown { position: relative; }
        .dropdown-content {
            position: absolute; top: 100%; left: 0; right: 0; 
            background: rgba(6, 95, 70, 0.95); backdrop-filter: blur(16px);
            border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 12px; 
            margin-top: 4px; z-index: 50; max-height: 200px; overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        .dropdown-item {
            padding: 14px 16px; color: white; cursor: pointer; 
            transition: all 0.2s; display: flex; align-items: center; gap: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .dropdown-item:hover { 
            background: rgba(255, 255, 255, 0.15); 
            transform: translateX(4px);
        }
        .dropdown-item:first-child { border-radius: 10px 10px 0 0; }
        .dropdown-item:last-child { border-radius: 0 0 10px 10px; border-bottom: none; }
        
        .preference-btn {
            transition: all 0.3s ease;
            transform: scale(1);
            cursor: pointer;
            min-height: 50px;
            touch-action: manipulation;
        }
        
        .preference-btn:hover {
            transform: scale(1.05);
        }
        
        .preference-btn.selected {
            background: linear-gradient(135deg, #fbbf24, #f59e0b) !important;
            color: #000 !important;
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(251, 191, 36, 0.4);
        }
        
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(8px);
            display: flex; align-items: center; justify-content: center; z-index: 100;
        }
        .modal-content {
            background: rgba(15, 118, 110, 0.95); backdrop-filter: blur(16px); 
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px; padding: 32px; max-width: 400px; width: 90%; text-align: center;
        }
        
        .date-picker {
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            padding: 12px;
            border-radius: 12px;
            font-size: 16px;
        }
        
        .date-picker:focus {
            outline: none;
            border-color: #fbbf24;
            box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.2);
        }
        
        .airline-logo {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #1f2937;
        }
        
        .hotel-image {
            width: 100%;
            height: 120px;
            border-radius: 12px;
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 12px;
        }
    </style>
</head>
<body class="text-white min-h-screen">
    <!-- Modal geolocalizzazione -->
    <div id="location-modal" class="modal hidden">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4">üìç Da dove parti?</h2>
            <p class="text-gray-300 mb-6">Per offrirti le migliori opzioni di viaggio</p>
            
            <button id="geolocation-btn" class="w-full bg-blue-500 text-white font-bold py-3 px-6 rounded-xl mb-4 hover:bg-blue-600 transition-colors">
                üåç Usa la mia posizione
            </button>
            
            <div class="text-gray-400 mb-4">oppure</div>
            
            <input type="text" id="manual-location" placeholder="Inserisci citt√† (es. Milano)" 
                   class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white focus:ring-2 focus:ring-yellow-400 outline-none mb-4">
            
            <button id="manual-location-btn" class="w-full bg-yellow-500 text-black font-bold py-3 px-6 rounded-xl hover:bg-yellow-400 transition-colors">
                ‚úÖ Conferma
            </button>
        </div>
    </div>

    <div id="app">
        <!-- Loading Screen -->
        <div id="loading" class="min-h-screen flex items-center justify-center">
            <div class="text-center">
                <div class="text-6xl mb-4">üåç</div>
                <h1 class="text-4xl font-bold mb-2">Loading Gloober 2.0...</h1>
                <p class="text-xl">Just gloob it! üöÄ</p>
            </div>
        </div>

        <!-- Main App -->
        <div id="main-app" class="hidden">
            <!-- Step 1: Configuration -->
            <div id="step1" class="container mx-auto px-4 py-8">
                <div class="text-center mb-8">
                    <h1 class="text-6xl font-bold mb-4 bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent">
                        Gloober 2.0
                    </h1>
                    <p class="text-xl text-gray-300">Gloob your new destination! üåç</p>
                </div>

                <div class="grid lg:grid-cols-2 gap-12 items-center max-w-6xl mx-auto">
                    <div class="glass-card rounded-3xl p-8">
                        <h2 class="text-2xl font-bold mb-6">Gloob your new destination!</h2>
                        
                        <div class="mb-6">
                            <label class="block text-sm font-medium mb-2">üí∞ Budget totale (‚Ç¨)</label>
                            <input type="number" id="budget" value="800" min="200" max="5000" step="50" 
                                   class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white text-xl font-bold focus:ring-2 focus:ring-yellow-400 outline-none">
                        </div>

                        <div class="mb-6">
                            <label class="block text-sm font-medium mb-2">üë• Quante persone?</label>
                            <select id="people" class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white focus:ring-2 focus:ring-yellow-400 outline-none">
                                <option value="1">1 persona</option>
                                <option value="2" selected>2 persone</option>
                                <option value="3">3 persone</option>
                                <option value="4">4 persone</option>
                            </select>
                        </div>

                        <div class="mb-6">
                            <label class="block text-sm font-medium mb-2">‚ú® Stile di viaggio</label>
                            <input type="range" id="luxury" value="40" min="0" max="100" 
                                   class="w-full h-3 bg-gradient-to-r from-green-500 via-yellow-500 to-purple-500 rounded-lg appearance-none cursor-pointer">
                            <div class="flex justify-between text-xs mt-2">
                                <span class="text-green-400 font-bold">CHEAP</span>
                                <span class="text-yellow-400 font-bold">MID</span>
                                <span class="text-purple-400 font-bold">LUXURY</span>
                            </div>
                        </div>

                        <div class="mb-6">
                            <label class="block text-sm font-medium mb-2">üî• Popolarit√† destinazione</label>
                            <input type="range" id="popularity" value="50" min="0" max="100" 
                                   class="w-full h-3 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 rounded-lg appearance-none cursor-pointer">
                            <div class="flex justify-between text-xs mt-2">
                                <span class="text-blue-400 font-bold">üë§ NASCOSTA</span>
                                <span class="text-purple-400 font-bold">üîç SCOPERTA</span>
                                <span class="text-pink-400 font-bold">üåü FAMOSA</span>
                            </div>
                        </div>

                        <div class="mb-6">
                            <label class="block text-sm font-medium mb-2">üè® Tipo alloggio</label>
                            <div class="custom-dropdown">
                                <button id="accommodation-btn" class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white focus:ring-2 focus:ring-yellow-400 outline-none flex items-center justify-between">
                                    <span id="accommodation-selected">üè® Hotel (Booking.com)</span>
                                    <span>‚ñº</span>
                                </button>
                                <div id="accommodation-dropdown" class="dropdown-content hidden">
                                    <div class="dropdown-item" data-accommodation="hotel">üè® Hotel (Booking.com)</div>
                                    <div class="dropdown-item" data-accommodation="bnb">üè† B&B/Casa (Airbnb)</div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-6">
                            <label class="block text-sm font-medium mb-2">üöÄ Come viaggi?</label>
                            <div class="custom-dropdown">
                                <button id="transport-btn" class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white focus:ring-2 focus:ring-yellow-400 outline-none flex items-center justify-between">
                                    <span id="transport-selected">‚úàÔ∏è Aereo</span>
                                    <span>‚ñº</span>
                                </button>
                                <div id="transport-dropdown" class="dropdown-content hidden">
                                    <div class="dropdown-item" data-transport="plane">‚úàÔ∏è Aereo</div>
                                    <div class="dropdown-item" data-transport="car-rental">üöó Auto a noleggio</div>
                                    <div class="dropdown-item" data-transport="car-own">üöô Auto privata</div>
                                    <div class="dropdown-item" data-transport="train">üöÜ Treno</div>
                                    <div class="dropdown-item" data-transport="bus">üöå Bus</div>
                                    <div class="dropdown-item" data-transport="ferry">‚õ¥Ô∏è Nave/Traghetto</div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-6">
                            <label class="block text-sm font-medium mb-2">üìÖ Quando?</label>
                            <select id="when" class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white focus:ring-2 focus:ring-yellow-400 outline-none">
                                <option value="flexible">üé≤ Flessibile (sorprendimi!)</option>
                                <option value="weekend">üìÖ Weekend</option>
                                <option value="week">üìÖ Una settimana</option>
                                <option value="month">üìÖ Un mese</option>
                                <option value="custom">üìÖ Date personalizzate</option>
                            </select>
                        </div>

                        <!-- Date Picker (hidden by default) -->
                        <div id="date-picker-section" class="mb-6 hidden">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">üõ´ Partenza</label>
                                    <input type="date" id="departure-date" class="date-picker w-full">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">üõ¨ Ritorno</label>
                                    <input type="date" id="return-date" class="date-picker w-full">
                                </div>
                            </div>
                        </div>

                        <div class="mb-8">
                            <label class="block text-sm font-medium mb-3">üéØ Preferenza (scegli una)</label>
                            <div class="grid grid-cols-2 gap-3">
                                <button data-pref="sea" class="preference-btn p-4 rounded-xl text-sm font-bold transition-all bg-white/10 hover:bg-white/20">üèñÔ∏è Mare</button>
                                <button data-pref="mountain" class="preference-btn p-4 rounded-xl text-sm font-bold transition-all bg-white/10 hover:bg-white/20">üèîÔ∏è Montagna</button>
                                <button data-pref="art" class="preference-btn p-4 rounded-xl text-sm font-bold transition-all bg-white/10 hover:bg-white/20">üé® Arte</button>
                                <button data-pref="romantic" class="preference-btn p-4 rounded-xl text-sm font-bold transition-all bg-white/10 hover:bg-white/20">üíï Romantico</button>
                                <button data-pref="adventure" class="preference-btn p-4 rounded-xl text-sm font-bold transition-all bg-white/10 hover:bg-white/20">üéí Avventura</button>
                                <button data-pref="food" class="preference-btn p-4 rounded-xl text-sm font-bold transition-all bg-white/10 hover:bg-white/20">üçù Food</button>
                                <button data-pref="nightlife" class="preference-btn p-4 rounded-xl text-sm font-bold transition-all bg-white/10 hover:bg-white/20">üåÉ Vita Notturna</button>
                                <button data-pref="culture" class="preference-btn p-4 rounded-xl text-sm font-bold transition-all bg-white/10 hover:bg-white/20">üèõÔ∏è Cultura</button>
                            </div>
                        </div>

                        <button id="gloob-btn" class="w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-black font-bold py-4 px-8 rounded-xl text-xl hover:from-yellow-300 hover:to-orange-400 transition-all flex items-center justify-center gap-3">
                            üåç JUST GLOOB IT!
                        </button>
                    </div>

                    <div class="flex items-center justify-center">
                        <div class="globe-container">
                            <div id="globe" class="globe">
                                <div class="continent europa"></div>
                                <div class="continent europa2"></div>
                                <div class="continent africa"></div>
                                <div class="continent africa2"></div>
                                <div class="continent asia"></div>
                                <div class="continent asia2"></div>
                                <div class="continent asia3"></div>
                                <div class="continent north-america"></div>
                                <div class="continent north-america2"></div>
                                <div class="continent south-america"></div>
                                <div class="continent south-america2"></div>
                                <div class="continent australia"></div>
                                <div class="cloud cloud1"></div>
                                <div class="cloud cloud2"></div>
                                <div class="cloud cloud3"></div>
                                <div class="grid-lines">
                                    <div class="equator"></div>
                                    <div class="meridian"></div>
                                    <div class="tropic1"></div>
                                    <div class="tropic2"></div>
                                </div>
                                <div class="ocean-texture">
                                    <div class="bubble bubble1"></div>
                                    <div class="bubble bubble2"></div>
                                    <div class="bubble bubble3"></div>
                                </div>
                            </div>
                            <div class="pin"></div>
                            <div class="pin-pole"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Spinning -->
            <div id="step2" class="hidden min-h-screen flex items-center justify-center">
                <div class="text-center">
                    <div class="globe-container mb-8">
                        <div id="spinning-globe" class="globe">
                            <div class="continent europa"></div>
                            <div class="continent europa2"></div>
                            <div class="continent africa"></div>
                            <div class="continent africa2"></div>
                            <div class="continent asia"></div>
                            <div class="continent asia2"></div>
                            <div class="continent asia3"></div>
                            <div class="continent north-america"></div>
                            <div class="continent north-america2"></div>
                            <div class="continent south-america"></div>
                            <div class="continent south-america2"></div>
                            <div class="continent australia"></div>
                            <div class="cloud cloud1"></div>
                            <div class="cloud cloud2"></div>
                            <div class="cloud cloud3"></div>
                            <div class="grid-lines">
                                <div class="equator"></div>
                                <div class="meridian"></div>
                                <div class="tropic1"></div>
                                <div class="tropic2"></div>
                            </div>
                            <div class="ocean-texture">
                                <div class="bubble bubble1"></div>
                                <div class="bubble bubble2"></div>
                                <div class="bubble bubble3"></div>
                            </div>
                        </div>
                    </div>
                    <h2 class="text-4xl font-bold mb-4">üåç Gloobbing...</h2>
                    <p class="text-xl text-gray-300" id="searching-text">Cercando la destinazione perfetta!</p>
                </div>
            </div>

            <!-- Step 3: Result -->
            <div id="step3" class="hidden container mx-auto px-4 py-8">
                <div class="max-w-4xl mx-auto">
                    <div class="text-center mb-8">
                        <h1 class="text-5xl font-bold mb-4">üéâ La tua destinazione!</h1>
                    </div>

                    <div id="result-content" class="glass-card rounded-3xl p-8 mb-8">
                        <!-- Result will be populated by JavaScript -->
                    </div>

                    <div class="text-center">
                        <button id="book-btn" class="bg-green-500 text-white font-bold py-4 px-12 rounded-xl text-xl mr-4 hover:bg-green-600 transition-colors">
                            ‚úàÔ∏è PRENOTA!
                        </button>
                        <button id="regloob-btn" class="bg-gray-600 text-white font-bold py-4 px-8 rounded-xl text-xl hover:bg-gray-700 transition-colors">
                            üé≤ Regloob
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div><script>
        const destinations = {
            cheap: [
                { 
                    name: 'Giethoorn', country: 'Paesi Bassi', price: 280, image: 'üõ∂', 
                    description: 'Villaggio senza strade con canali romantici', days: 3, 
                    popularity: 25, tags: ['romantic', 'culture', 'adventure'], 
                    transports: ['plane', 'train', 'car-rental', 'car-own'],
                    airport_from: 'Milano Malpensa (MXP)', airport_to: 'Amsterdam (AMS)',
                    hotel: { name: 'B&B De Jonge', stars: 3, amenities: ['Vista Canali', 'Bici Incluse'], rating: 9.2, image: 'üè†' }, 
                    flights: { departure: '09:30', arrival: '11:45', return_departure: '18:20', return_arrival: '20:35', 
                               airline: 'KLM', airline_logo: 'KL', duration: '2h 15m', stops: 'Diretto' },
                    quote: { text: "In Giethoorn il silenzio ha un suono diverso.", author: "Local saying" }, 
                    tip: "Noleggia una barca elettrica per esplorare i canali!" 
                },
                { 
                    name: 'Kotor', country: 'Montenegro', price: 250, image: '‚õ∞Ô∏è', 
                    description: 'Fiordi balcanici e mura medievali', days: 4, 
                    popularity: 35, tags: ['sea', 'mountain', 'culture'], 
                    transports: ['plane', 'car-rental', 'bus'],
                    airport_from: 'Milano Malpensa (MXP)', airport_to: 'Podgorica (TGD)',
                    hotel: { name: 'Hotel Vardar', stars: 3, amenities: ['Vista Fiordi', 'Centro Storico'], rating: 8.9, image: 'üèîÔ∏è' }, 
                    flights: { departure: '11:20', arrival: '14:35', return_departure: '15:40', return_arrival: '18:55', 
                               airline: 'Air Serbia', airline_logo: 'JU', duration: '2h 15m', stops: '1 Stop' },
                    quote: { text: "Kotor √® dove le montagne abbracciano il mare.", author: "Local proverb" }, 
                    tip: "Sali le mura per il tramonto pi√π bello dei Balcani!" 
                },
                { 
                    name: 'Praga', country: 'Repubblica Ceca', price: 300, image: 'üç∫', 
                    description: 'Castello medievale e birra artigianale', days: 4, 
                    popularity: 85, tags: ['art', 'food', 'culture', 'nightlife'], 
                    transports: ['plane', 'train', 'bus', 'car-rental'],
                    airport_from: 'Milano Malpensa (MXP)', airport_to: 'Praga (PRG)',
                    hotel: { name: 'Hostel One Home', stars: 2, amenities: ['Design Moderno', 'Centro Storico'], rating: 9.4, image: 'üè∞' }, 
                    flights: { departure: '14:20', arrival: '16:05', return_departure: '17:30', return_arrival: '19:15', 
                               airline: 'Czech Airlines', airline_logo: 'OK', duration: '1h 45m', stops: 'Diretto' },
                    quote: { text: "Praga non ti lascia andare. Questa piccola madre ha gli artigli.", author: "Franz Kafka" }, 
                    tip: "Bevi birra nei pub sotterranei medievali!" 
                },
                { 
                    name: 'Split', country: 'Croazia', price: 280, image: 'üèñÔ∏è', 
                    description: 'Palazzo di Diocleziano e spiagge cristalline', days: 4, 
                    popularity: 70, tags: ['sea', 'culture', 'adventure'], 
                    transports: ['plane', 'ferry', 'car-rental', 'bus'],
                    airport_from: 'Milano Malpensa (MXP)', airport_to: 'Split (SPU)',
                    hotel: { name: 'Villa Dalmacija', stars: 3, amenities: ['Vista Mare', 'Centro Storico'], rating: 9.0, image: 'üåä' }, 
                    flights: { departure: '13:45', arrival: '15:20', return_departure: '16:00', return_arrival: '17:35', 
                               airline: 'Croatia Airlines', airline_logo: 'OU', duration: '1h 35m', stops: 'Diretto' },
                    quote: { text: "Il mare lancia il suo incantesimo.", author: "Jacques Cousteau" }, 
                    tip: "Dormi nel Palazzo di Diocleziano!" 
                },
                { 
                    name: 'Porto', country: 'Portogallo', price: 290, image: 'üç∑', 
                    description: 'Vino Porto e azulejos colorati', days: 4, 
                    popularity: 75, tags: ['food', 'culture', 'romantic'], 
                    transports: ['plane', 'train', 'car-rental'],
                    airport_from: 'Milano Malpensa (MXP)', airport_to: 'Porto (OPO)',
                    hotel: { name: 'Pestana Vintage Porto', stars: 4, amenities: ['Centro Storico', 'Rooftop'], rating: 8.7, image: 'üèõÔ∏è' }, 
                    flights: { departure: '10:15', arrival: '12:30', return_departure: '19:45', return_arrival: '23:59', 
                               airline: 'TAP Air Portugal', airline_logo: 'TP', duration: '2h 15m', stops: 'Diretto' },
                    quote: { text: "Porto √® una citt√† che si beve.", author: "Local saying" }, 
                    tip: "Visita le cantine di Vila Nova de Gaia!" 
                }
            ],
            
            mid: [
                { 
                    name: 'Barcellona', country: 'Spagna', price: 480, image: 'üèñÔ∏è', 
                    description: 'Gaud√≠, tapas e Mare Mediterraneo', days: 4, 
                    popularity: 95, tags: ['sea', 'art', 'food', 'nightlife'], 
                    transports: ['plane', 'train', 'car-rental'],
                    airport_from: 'Milano Malpensa (MXP)', airport_to: 'Barcellona (BCN)',
                    hotel: { name: 'Hotel Casa Fuster', stars: 4, amenities: ['Palazzo Modernista', 'Rooftop Bar'], rating: 8.8, image: 'üè®' }, 
                    flights: { departure: '11:30', arrival: '13:45', return_departure: '18:15', return_arrival: '20:30', 
                               airline: 'Vueling', airline_logo: 'VY', duration: '2h 15m', stops: 'Diretto' },
                    quote: { text: "Barcellona √® una citt√† che non dorme mai.", author: "Salvador Dal√≠" }, 
                    tip: "Visita Park G√ºell al tramonto!" 
                },
                { 
                    name: 'Vienna', country: 'Austria', price: 580, image: 'üéº', 
                    description: 'Musica classica e caff√® imperiali', days: 4, 
                    popularity: 80, tags: ['art', 'culture', 'romantic', 'food'], 
                    transports: ['plane', 'train', 'car-rental'],
                    airport_from: 'Milano Malpensa (MXP)', airport_to: 'Vienna (VIE)',
                    hotel: { name: 'Hotel Am Ring', stars: 4, amenities: ['Centro Storico', 'Caffetteria'], rating: 8.7, image: 'üé≠' }, 
                    flights: { departure: '12:20', arrival: '14:05', return_departure: '16:40', return_arrival: '18:25', 
                               airline: 'Austrian Airlines', airline_logo: 'OS', duration: '1h 45m', stops: 'Diretto' },
                    quote: { text: "Vienna √® la citt√† dei sogni.", author: "Sigmund Freud" }, 
                    tip: "Prova la Sachertorte originale al Caf√© Sacher!" 
                },
                { 
                    name: 'Amsterdam', country: 'Paesi Bassi', price: 520, image: 'üö≤', 
                    description: 'Canali, musei e libert√†', days: 3, 
                    popularity: 90, tags: ['culture', 'art', 'nightlife'], 
                    transports: ['plane', 'train', 'car-rental'],
                    airport_from: 'Milano Malpensa (MXP)', airport_to: 'Amsterdam (AMS)',
                    hotel: { name: 'Lloyd Hotel', stars: 4, amenities: ['Design Unico', 'Vista Canali'], rating: 8.5, image: 'üèõÔ∏è' }, 
                    flights: { departure: '09:45', arrival: '12:00', return_departure: '17:30', return_arrival: '19:45', 
                               airline: 'KLM', airline_logo: 'KL', duration: '2h 15m', stops: 'Diretto' },
                    quote: { text: "Amsterdam √® la Venezia del Nord.", author: "Local saying" }, 
                    tip: "Noleggia una bici e perdi i turisti!" 
                }
            ],

            luxury: [
                { 
                    name: 'Santorini', country: 'Grecia', price: 1200, image: 'üåÖ', 
                    description: 'Tramonto cicladico e resort esclusivi', days: 3, 
                    popularity: 90, tags: ['sea', 'romantic'], 
                    transports: ['plane', 'ferry'],
                    airport_from: 'Milano Malpensa (MXP)', airport_to: 'Santorini (JTR)',
                    hotel: { name: 'Grace Hotel Santorini', stars: 5, amenities: ['Infinity Pool', 'Vista Caldera'], rating: 9.6, image: 'üèñÔ∏è' }, 
                    flights: { departure: '09:15', arrival: '13:40', return_departure: '15:50', return_arrival: '18:15', 
                               airline: 'Aegean Airlines', airline_logo: 'A3', duration: '3h 25m', stops: '1 Stop' },
                    quote: { text: "Santorini √® dove il cielo incontra il mare.", author: "Homer" }, 
                    tip: "Cena al tramonto a Oia!" 
                },
                { 
                    name: 'Monaco', country: 'Monte Carlo', price: 1500, image: 'üé∞', 
                    description: 'Lusso, yacht e Grand Prix', days: 2, 
                    popularity: 85, tags: ['nightlife', 'romantic'], 
                    transports: ['plane', 'car-rental', 'train'],
                    airport_from: 'Milano Malpensa (MXP)', airport_to: 'Nizza (NCE)',
                    hotel: { name: 'Hotel Hermitage', stars: 5, amenities: ['Spa', 'Vista Mare'], rating: 9.3, image: 'üèñÔ∏è' }, 
                    flights: { departure: '14:30', arrival: '15:45', return_departure: '20:15', return_arrival: '21:30', 
                               airline: 'Air France', airline_logo: 'AF', duration: '1h 15m', stops: 'Diretto' },
                    quote: { text: "Monaco √® il sogno di ogni giocatore.", author: "Grace Kelly" }, 
                    tip: "Aperitivo al Caf√© de Paris!" 
                }
            ]
        };

        let currentStep = 1;
        let selectedPreference = null;
        let selectedTransport = 'plane';
        let selectedAccommodation = 'hotel';
        let currentResult = null;
        let userLocation = null;function init() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        userLocation = {
                            type: 'coords',
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            city: 'La tua posizione'
                        };
                    },
                    error => {},
                    { timeout: 5000 }
                );
            }

            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                setupEventListeners();
            }, 1000);
        }

        function setupEventListeners() {
            document.querySelectorAll('.preference-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const pref = btn.dataset.pref;
                    
                    document.querySelectorAll('.preference-btn').forEach(b => {
                        b.classList.remove('selected');
                    });
                    
                    if (selectedPreference === pref) {
                        selectedPreference = null;
                    } else {
                        selectedPreference = pref;
                        btn.classList.add('selected');
                    }
                });
            });

            const accommodationBtn = document.getElementById('accommodation-btn');
            const accommodationDropdown = document.getElementById('accommodation-dropdown');
            const accommodationSelected = document.getElementById('accommodation-selected');

            accommodationBtn.addEventListener('click', () => {
                accommodationDropdown.classList.toggle('hidden');
            });

            document.querySelectorAll('[data-accommodation]').forEach(item => {
                item.addEventListener('click', () => {
                    selectedAccommodation = item.dataset.accommodation;
                    accommodationSelected.textContent = item.textContent;
                    accommodationDropdown.classList.add('hidden');
                });
            });

            const transportBtn = document.getElementById('transport-btn');
            const transportDropdown = document.getElementById('transport-dropdown');
            const transportSelected = document.getElementById('transport-selected');

            transportBtn.addEventListener('click', () => {
                transportDropdown.classList.toggle('hidden');
            });

            document.querySelectorAll('[data-transport]').forEach(item => {
                item.addEventListener('click', () => {
                    selectedTransport = item.dataset.transport;
                    transportSelected.textContent = item.textContent;
                    transportDropdown.classList.add('hidden');
                });
            });

            const whenSelect = document.getElementById('when');
            const datePickerSection = document.getElementById('date-picker-section');

            whenSelect.addEventListener('change', () => {
                if (whenSelect.value === 'custom') {
                    datePickerSection.classList.remove('hidden');
                    const today = new Date();
                    const departure = new Date(today);
                    departure.setDate(today.getDate() + 7);
                    const returnDate = new Date(departure);
                    returnDate.setDate(departure.getDate() + 3);
                    
                    document.getElementById('departure-date').value = departure.toISOString().split('T')[0];
                    document.getElementById('return-date').value = returnDate.toISOString().split('T')[0];
                } else {
                    datePickerSection.classList.add('hidden');
                }
            });

            document.addEventListener('click', (e) => {
                if (!accommodationBtn.contains(e.target) && !accommodationDropdown.contains(e.target)) {
                    accommodationDropdown.classList.add('hidden');
                }
                if (!transportBtn.contains(e.target) && !transportDropdown.contains(e.target)) {
                    transportDropdown.classList.add('hidden');
                }
            });

            document.getElementById('gloob-btn').addEventListener('click', () => {
                const budget = parseInt(document.getElementById('budget').value);
                if (budget < 200) {
                    alert('Budget minimo: ‚Ç¨200');
                    return;
                }
                
                if (!userLocation) {
                    showLocationModal();
                } else {
                    startSpin();
                }
            });

            document.getElementById('geolocation-btn').addEventListener('click', () => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        position => {
                            userLocation = {
                                type: 'coords',
                                latitude: position.coords.latitude,
                                longitude: position.coords.longitude,
                                city: 'La tua posizione'
                            };
                            hideLocationModal();
                            startSpin();
                        },
                        error => {
                            alert('Impossibile ottenere la posizione. Inserisci manualmente.');
                        }
                    );
                } else {
                    alert('Geolocalizzazione non supportata.');
                }
            });

            document.getElementById('manual-location-btn').addEventListener('click', () => {
                const city = document.getElementById('manual-location').value.trim();
                if (city) {
                    userLocation = { type: 'manual', city: city };
                    hideLocationModal();
                    startSpin();
                } else {
                    alert('Inserisci una citt√† valida.');
                }
            });

            document.getElementById('regloob-btn').addEventListener('click', () => {
                showStep(1);
                selectedPreference = null;
                document.querySelectorAll('.preference-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
            });

            document.getElementById('book-btn').addEventListener('click', () => {
                if (currentResult) bookTrip();
            });
        }function showLocationModal() {
            document.getElementById('location-modal').classList.remove('hidden');
        }

        function hideLocationModal() {
            document.getElementById('location-modal').classList.add('hidden');
        }

        function showStep(step) {
            document.getElementById('step1').classList.add('hidden');
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.add('hidden');
            document.getElementById(`step${step}`).classList.remove('hidden');
            currentStep = step;
        }

        function startSpin() {
            showStep(2);
            const budget = parseInt(document.getElementById('budget').value);
            const people = parseInt(document.getElementById('people').value);
            
            document.getElementById('searching-text').textContent = 
                `Cercando destinazione per ${people} persone con ‚Ç¨${budget} da ${userLocation.city}!`;
            
            document.getElementById('spinning-globe').classList.add('spinning');
            
            setTimeout(() => {
                document.getElementById('spinning-globe').classList.remove('spinning');
                generateResult();
                setTimeout(() => showStep(3), 500);
            }, 3000);
        }

        function generateResult() {
            const budget = parseInt(document.getElementById('budget').value);
            const people = parseInt(document.getElementById('people').value);
            const luxuryLevel = parseInt(document.getElementById('luxury').value);
            const popularityLevel = parseInt(document.getElementById('popularity').value);
            
            let category = 'cheap';
            if (luxuryLevel >= 35 && luxuryLevel < 70) category = 'mid';
            else if (luxuryLevel >= 70) category = 'luxury';
            
            let validDestinations = destinations[category].filter(d => {
                const withinBudget = d.price <= (budget / people);
                const hasTransport = d.transports.includes(selectedTransport);
                const popularityMatch = Math.abs(d.popularity - popularityLevel) <= 30;
                return withinBudget && hasTransport && popularityMatch;
            });
            
            if (validDestinations.length === 0) {
                validDestinations = destinations[category].filter(d => 
                    d.price <= (budget / people) && d.transports.includes(selectedTransport)
                );
            }
            
            if (selectedPreference) {
                const perfectMatch = validDestinations.filter(destination => {
                    return destination.tags && destination.tags.includes(selectedPreference);
                });
                
                if (perfectMatch.length > 0) {
                    validDestinations = perfectMatch;
                }
            }
            
            const randomDest = validDestinations.length > 0 
                ? validDestinations[Math.floor(Math.random() * validDestinations.length)]
                : destinations.cheap[0];
            
            let startDate, endDate;
            if (document.getElementById('when').value === 'custom') {
                startDate = new Date(document.getElementById('departure-date').value);
                endDate = new Date(document.getElementById('return-date').value);
            } else {
                startDate = new Date();
                startDate.setDate(startDate.getDate() + Math.floor(Math.random() * 30) + 1);
                endDate = new Date(startDate);
                endDate.setDate(endDate.getDate() + randomDest.days - 1);
            }
            
            currentResult = {
                ...randomDest,
                startDate,
                endDate,
                totalPrice: randomDest.price * people,
                pricePerPerson: randomDest.price,
                selectedTransport,
                selectedAccommodation
            };
            
            displayResult();
        }

        function getPopularityText(popularity) {
            if (popularity <= 30) return "üë§ Gemma nascosta";
            if (popularity <= 60) return "üîç Destinazione scoperta";
            if (popularity <= 80) return "üåü Molto popolare";
            return "üåü Iconica mondiale";
        }

        function getTransportEmoji(transport) {
            const emojis = {
                'plane': '‚úàÔ∏è', 'train': 'üöÜ', 'bus': 'üöå', 
                'car-rental': 'üöó', 'car-own': 'üöô', 'ferry': '‚õ¥Ô∏è'
            };
            return emojis[transport] || 'üöÄ';
        }

        function getAccommodationText(accommodation) {
            return accommodation === 'hotel' ? 'Hotel (Booking.com)' : 'B&B/Casa (Airbnb)';
        }function displayResult() {
            const result = currentResult;
            const people = parseInt(document.getElementById('people').value);
            const stars = '‚≠ê'.repeat(result.hotel.stars);
            const popularityText = getPopularityText(result.popularity);
            const transportEmoji = getTransportEmoji(result.selectedTransport);
            const accommodationText = getAccommodationText(result.selectedAccommodation);
            
            const resultHTML = `
                <div class="text-center mb-6">
                    <div class="text-8xl mb-4">${result.image}</div>
                    <h2 class="text-4xl font-bold text-yellow-400">${result.name}</h2>
                    <p class="text-2xl text-gray-300">${result.country}</p>
                    <p class="text-lg text-gray-400 mt-2">${result.description}</p>
                    
                    <div class="mt-4 p-3 bg-purple-600/20 rounded-lg border border-purple-400/30">
                        <p class="text-sm text-purple-200">
                            üî• <span class="font-bold text-white">${popularityText}</span> ‚Ä¢ ${transportEmoji} <span class="font-bold text-white">Via ${selectedTransport === 'plane' ? 'aereo' : selectedTransport === 'train' ? 'treno' : selectedTransport === 'car-rental' ? 'auto noleggio' : selectedTransport === 'car-own' ? 'auto privata' : selectedTransport === 'bus' ? 'bus' : 'nave'}</span>
                        </p>
                        <p class="text-xs text-purple-300 mt-1">üìç ${result.airport_from} ‚Üí ${result.airport_to}</p>
                        <p class="text-xs text-purple-300">üè® ${accommodationText}</p>
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-white/90 backdrop-blur-lg rounded-2xl p-6 shadow-lg">
                        <h3 class="text-xl font-bold mb-4 text-gray-800 flex items-center gap-2">
                            ${transportEmoji} Volo
                            <div class="airline-logo">${result.flights.airline_logo}</div>
                        </h3>
                        <div class="space-y-3 text-gray-900">
                            <div class="flex justify-between">
                                <span>Compagnia:</span>
                                <span class="font-bold">${result.flights.airline}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Partenza:</span>
                                <span class="font-bold">${result.flights.departure}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Arrivo:</span>
                                <span class="font-bold">${result.flights.arrival}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Durata:</span>
                                <span class="font-bold">${result.flights.duration}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Scali:</span>
                                <span class="font-bold">${result.flights.stops}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white/90 backdrop-blur-lg rounded-2xl p-6 shadow-lg">
                        <h3 class="text-xl font-bold mb-4 text-gray-800">üè® ${result.selectedAccommodation === 'hotel' ? 'Hotel' : 'Alloggio'}</h3>
                        <div class="hotel-image">${result.hotel.image}</div>
                        <div class="text-gray-900">
                            <h4 class="font-bold text-lg">${result.hotel.name}</h4>
                            <div class="flex items-center gap-1 mt-1">
                                <span class="text-yellow-500">${stars}</span>
                                <span class="ml-2 text-sm bg-green-500 text-white px-2 py-1 rounded">${result.hotel.rating}/10</span>
                            </div>
                            <div class="mt-3 space-y-1">
                                ${result.hotel.amenities.map(amenity => `
                                    <div class="flex items-center gap-2 text-sm">
                                        <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                        ${amenity}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-6 border border-amber-200">
                        <h3 class="text-lg font-bold mb-3 text-amber-800">üí≠ Ispirazione</h3>
                        <blockquote class="italic text-gray-700 text-center mb-3">"${result.quote?.text}"</blockquote>
                        <p class="text-sm text-amber-700 text-center font-medium">‚Äî ${result.quote?.author}</p>
                    </div>
                    
                    <div class="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-6 border border-emerald-200">
                        <h3 class="text-lg font-bold mb-3 text-emerald-800">üíé Travel Tip</h3>
                        <p class="text-gray-700 text-sm">${result.tip}</p>
                    </div>
                </div>

                <div class="text-center">
                    <p class="text-3xl font-bold text-yellow-400 mb-2">‚Ç¨${result.totalPrice} totale</p>
                    <p class="text-lg text-gray-300 mb-4">‚Ç¨${result.pricePerPerson} per persona</p>
                    
                    <div class="bg-teal-600/20 rounded-lg p-4 border border-teal-400/30">
                        <h3 class="text-lg font-bold text-teal-200 mb-2">üìÖ Date del viaggio</h3>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <span class="text-teal-300">Partenza:</span>
                                <div class="font-bold text-white">${result.startDate.toLocaleDateString('it-IT', { weekday: 'long', day: 'numeric', month: 'long' })}</div>
                            </div>
                            <div>
                                <span class="text-teal-300">Ritorno:</span>
                                <div class="font-bold text-white">${result.endDate.toLocaleDateString('it-IT', { weekday: 'long', day: 'numeric', month: 'long' })}</div>
                            </div>
                        </div>
                        <p class="text-xs text-teal-200 mt-2">Durata: ${Math.ceil((result.endDate - result.startDate) / (1000 * 60 * 60 * 24))} giorni</p>
                    </div>
                </div>
            `;
            
            document.getElementById('result-content').innerHTML = resultHTML;
        }function bookTrip() {
            const result = currentResult;
            const people = parseInt(document.getElementById('people').value);
            const checkin = result.startDate.toISOString().split('T')[0];
            const checkout = result.endDate.toISOString().split('T')[0];
            
            const accommodationUrl = result.selectedAccommodation === 'hotel' 
                ? `https://booking.com/searchresults.html?ss=${encodeURIComponent(result.name)}&checkin=${checkin}&checkout=${checkout}&group_adults=${people}`
                : `https://airbnb.com/s/${encodeURIComponent(result.name)}?checkin=${checkin}&checkout=${checkout}&adults=${people}`;
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2 class="text-2xl font-bold mb-6">üé´ Prenota il viaggio</h2>
                    
                    <div class="space-y-4">
                        <button onclick="window.open('${accommodationUrl}', '_blank')" 
                                class="w-full bg-blue-500 text-white font-bold py-4 px-6 rounded-xl hover:bg-blue-600 transition-colors">
                            üè® Prenota ${result.selectedAccommodation === 'hotel' ? 'Hotel' : 'Alloggio'}
                        </button>
                        
                        <button onclick="window.open('https://skyscanner.com/transport/flights/mila/${result.name.toLowerCase()}/${checkin.replace(/-/g, '')}/${checkout.replace(/-/g, '')}/?adults=${people}', '_blank')" 
                                class="w-full bg-green-500 text-white font-bold py-4 px-6 rounded-xl hover:bg-green-600 transition-colors">
                            ${getTransportEmoji(result.selectedTransport)} Prenota ${selectedTransport === 'plane' ? 'Volo' : 'Trasporto'}
                        </button>
                        
                        <button onclick="window.open('https://booking.com/searchresults.html?ss=${encodeURIComponent(result.name)}&checkin=${checkin}&checkout=${checkout}&group_adults=${people}', '_blank')" 
                                class="w-full bg-yellow-500 text-black font-bold py-4 px-6 rounded-xl hover:bg-yellow-400 transition-colors">
                            üîç Esplora opzioni
                        </button>
                    </div>
                    
                    <button onclick="this.parentElement.parentElement.remove()" 
                            class="w-full bg-gray-600 text-white font-bold py-3 px-6 rounded-xl mt-6 hover:bg-gray-700 transition-colors">
                        ‚úï Chiudi
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        init();
    </script>
</body>
</html>
